<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<style type="text/css">
		body {
			background-color: #264880;
			background-image: url("http://www.livejournal.com/palimg/component/bg.gif/p0f1e800");
			background-repeat: repeat;
			background-position: center;
			background-attachment: scroll;
		
			margin-top: 0px; margin-left: 0px;
			margin-right: 0px;
			font-family: Tahoma, sans-serif;
			font-size: 12px;
			color: #232f6d;
		}
		
		td, tr {
			font-family: Tahoma, sans-serif;
			font-size: 12px;
			color: #232f6d;
			line-height: 22px;
		}
		
		a {
			color: #2d3679;
			text-decoration: none;
		}
		
		a:visited {
			color: #555555;
		}
		
		a:hover { text-decoration: underline;}
		
		.subject { font-weight: bold; }
		.small { margin-top: 3px;}
	
	
		.userTitle {
			font-size: 20px;
			text-weight: bolder;
			line-height: 17px;
		}
		
		.userSubTitle { 
			font-size: 13px;
			color: #000078;
			line-height: 22px;
		}
		
		.header-item {
			padding-left: 15px;
			position: relative;
			top: 5px;
		}
		
		.dkLine { background-color: #666666; }
		.ltLine { background-color: #bbbbbb; }
		.medLine { background-color: #999999; }
		.divLine { background-color: #000000; }
		.tabBg { background-color: #00545c; color: #ffffff;}
		
		.entryDate {
			font-size: 12px;
		}
		
		.entryHolderBg {
			background-color: #ffeddd;
			color: #000000;
			padding-top: 7px;
			padding-right: 7px;
			padding-left: 7px;
			padding-bottom: 7px;
		}
		
		.entry {
			padding-top: 7px;
			padding-right: 7px;
			padding-left: 7px;
			padding-bottom: 7px;
			background-color: #ffffff;
			font-size: 13px;
			color: #000000;
		}
		
		.entryHeader {
			font-size: 13px;
			font-weight: bold;
		}
		
		.entryComments {
			font-size: 12px;
			margin-top: 8px;
			margin-left: 8px;
			color: #232f6d;
		}
		
		.entryDash {
			background-color: #000000;
			width: 100%;
			height: 1px;
		}
		
		.sideHeader {
			font-size: 12px;
			color: #ffffff;
		}
		
		.comp { margin-bottom: 3px; }

		.compBg { background-color: #ffeddd; }

		.compContent {
			padding-left: 6px;
			padding-right: 6px;
			padding-bottom: 6px;
			padding-top: 3px;
			line-height: 18px;
			color: #000000;
		}
		
		.compFont {
			color: #ffeddd;
		}

		.compList {
			line-height: 20px;
			padding-left: 6px;
		}
		
		.userPic { border-color: #8bc4ff; }
		
		.shortLine {
			width: 20px;
			background-color: #ffffff;
			margin-bottom: 1px;
		}
		</style>
		<title>kmamail<% /!!UseJournal %></title>
	</head>
	<body marginwidth="0" marginheight="0" topmargin="0" leftmargin="0">
		<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
				alt="" border="0" /></div>
		<table cellspacing="0" cellpadding="0" border="0" width="100%">
			<tr>
				<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="3" height="1"
						alt="" border="0" /></td>
				<!-- USER HEADER -->
				<td valign="top" width="99%">
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="tabBg"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="userTitle">

									kmamail
<% /!!UseJournal %>

								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-bottom-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="tabBg"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-bottom-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:35:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Установка FreeBSD 4.8</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<ol style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li><h2>Качаем дистрибутив</h2><p>В первую очередь необходимо определится с какого источника будем брать дистрибутив.<span class="Apple-converted-space">&nbsp;</span><br />Идем самым ресурсоемким путем - качаем образ с интернета :) (для жителей крайнего севера)</p><p><a href="ftp://ftp1.ru.freebsd.org" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">ftp://ftp1.ru.freebsd.org</a><span class="Apple-converted-space">&nbsp;</span><br /><a href="ftp://ftp2.ru.freebsd.org" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">ftp://ftp2.ru.freebsd.org</a><span class="Apple-converted-space">&nbsp;</span><br /><a href="ftp://ftp3.ru.freebsd.org" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">ftp://ftp3.ru.freebsd.org</a><span class="Apple-converted-space">&nbsp;</span><br /><a href="ftp://ftp4.ru.freebsd.org" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">ftp://ftp4.ru.freebsd.org</a></p><p>Качаем 4.8 Release (почему именно он - будет много вопросов напишу, а пока поверим что это оптимальный вариант на начало лета 2003 года)<span class="Apple-converted-space">&nbsp;</span><br /><b>/pub/FreeBSD/ISO-IMAGES-i386/4.8/4.8-RELEASE-i386-disc1.iso</b><span class="Apple-converted-space">&nbsp;</span><br />Забираю только первый диск (с моим ограничением по трафику нехватало еще второй забрать для того чтобы меня с работы выгнали :D ) Первого диска достаточно для того чтобы поставить полноценную систему. На втором диске содержатся дополнительные порты, которые в дальнейшем можно будет скачать непосредственно из дерева портов (порт - это программа, типа MS Office или CorelDRW в случае MS Windows). С помощью программы Alcohol 120% записываем диск. Беглый осмотр диска показывает, что от версии к версии колличество портов помещающихся на первом диске сокращается и как правило там нет ничего что бы могло пригодится.</p></li><li><h2>Преследуемые цели:</h2><p><b>Необходимые на сервере службы:</b></p><ol><li>NAT</li><li>Firewall (на безе встроенного ipfw)</li><li>Почта для домена (sendmail)</li><li>Сервер HTTP (apache)</li><li>FTP доступ (ftpd)</li><li>Доступ к разделу Share для Windows клиентов а так же печать одного из сетевых принтеров (samba)</li><li>DNS primary для домена.</li></ol><p><b>Исходные данные</b><span class="Apple-converted-space">&nbsp;</span>(реальные адреса изменены из соображения конфеденциальности):</p><ol><li>IP Адрес сервера во внутренюю сеть 192.168.10.1</li><li>IP Адрес интерфейса в интернет (выдается провайдером) 195.195.95.5</li><li>IP Адрес шлюза (выдается провайдером) 195.195.95.100</li><li>IP Адрес DNS1, DNS2 (выдается провайдером) 195.195.95.50, 195.190.90.9</li><li>Доменное имя сервера myd.ru</li></ol></li><li><h2>Подготавливаем компьютер.</h2><p>Чем проще будет конфигурация - тем лучше.<span class="Apple-converted-space">&nbsp;</span><br />Мне нравится черно-белая консоль, а по этому ни каких X-Win, никакой графики, а значит видеокарта любая самая простая S3 Trio 8Mb. Процессор в зависимости от поставленных задач и работающих процессов. Мне достался Intel P2 266 (тоже неплохо), для минимальных целей хватило бы 486 машинки. Памяти (оперативной) чем больше тем лучше поставил 256 думаю хватит пока :) , Жесткий диск 20Gb будет использоватся на 50%. Мышь не нужна (мне :) )</p></li></ol><h2 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Итак. Приступаем к установке.</h2><ol style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li>Устанавливаем загрузочный диск<span class="Apple-converted-space">&nbsp;</span><b>FreeBSD 4.8 Release</b><span class="Apple-converted-space">&nbsp;</span>Загружаемся до менюшки из трех пунктов. Если железо выбрано самое элементарное, то используем 1<span class="Apple-converted-space">&nbsp;</span><b>Skip kernel configuration and continue with installation</b><span class="Apple-converted-space">&nbsp;</span>пункт меню все драйверы подцепятся автоматически. (Особенно важен драйвер сетевой карты, чтобы на этапе установки прописать настройки сети, можно конечно потом, но для начала так удобнее у меня Realtek 10/100).</li><li>По окончанию всех инициализаций перед вами появится цветное меню из которого мы выбираем 2 пункт<span class="Apple-converted-space">&nbsp;</span><b>Standard</b><span class="Apple-converted-space">&nbsp;</span>для инсталяции в полном режиме со всеми предупреждениями и вопросами.</li><li>Если диск чистый на предложение создать слайс нажимаем &quot;A&quot; = Use Enter Disk затем &quot;Q&quot; = Finish. Этим самым указав инсталяции использовать весь диск для FreeBSD</li><li>Далее предлагается создать БУт менеджер или отказатся от него - мы отказываемся - у нас один диск весь под ФРЮ 2 пункт меню Standard</li><li>Следующий этап самый ответственный - создание разделов на диске - просто создавайте в зависимости от найденых рекомендаций. Если у кого то возникнет возражение по поводу оптимальности моего способа создания разделов пусть пишет свою статью :D Ну а для сомневающихся всегда есть кнопка &quot;A&quot; - Автоматически создать разделы :D.<span class="Apple-converted-space">&nbsp;</span><br />Немного помучаясь вы должны получить такую табличку (128Mb надо писать при вводе - &quot;128Mb&quot;):<table border="1" width="50%"><tbody><tr><td><b>part</b></td><td><b>Mount</b></td><td><b>Size</b></td><td><b>Newfs</b></td></tr><tr><td>ad1s1a</td><td>/</td><td>128Mb</td><td>UFS Y</td></tr><tr><td>ad1s1b</td><td>swap</td><td>1000Mb</td><td>SWAP</td></tr><tr><td>ad1s1e</td><td>/var</td><td>3000Mb</td><td>UFS+S Y</td></tr><tr><td>ad1s1f</td><td>/tmp</td><td>1000Mb</td><td>UFS+S Y</td></tr><tr><td>ad1s1g</td><td>/usr</td><td>7000Mb</td><td>UFS+S Y</td></tr><tr><td>ad1s1h</td><td>/arhive</td><td>6964Mb</td><td>UFS+S Y</td></tr></tbody></table><p>Последний раздел будем использовать для Samba чтобы второй сервер мог писать туда свои архивы :) и скрипты могли передавать информацию для бухгалтерии.<span class="Apple-converted-space">&nbsp;</span><br />&quot;Q&quot; - Finish</p></li><li>Пункт Choose Distributions предлагает выбрать а что же мы будем копировать на винт в ходе установки - копируем всё кроме Х-ов - 4 - Developer - для продолжения - 1 - Exit</li><li>Указываем источник для инсталяции CD/DVD ...после непродолжительного копирования на хард..... Кстати все что начинается с этого поста можно пропустить и настроить вручную через конфиги, но уж раз пошли этим путем - доустановим...</li><li>Ethernet or PPP Выбираем свою(и) сетевую(ые) карту(ы) - в нашем случае это rl0 и rl1 (модем настроим потом)<p>Для rl0 (внешний интерфейс)<span class="Apple-converted-space">&nbsp;</span><br />host - bsd (потом автоматом допишется доменный суффикс)<span class="Apple-converted-space">&nbsp;</span><br />domain - myd.ru<span class="Apple-converted-space">&nbsp;</span><br />IPv4 Gateway - 195.195.95.100<span class="Apple-converted-space">&nbsp;</span><br />Name Server - 195.195.95.50<span class="Apple-converted-space">&nbsp;</span><br />IPv4 adress - 195.195.95.5<span class="Apple-converted-space">&nbsp;</span><br />NetMask - 255.255.255.0 (выдается провайдером вместе с IP)</p><p>Для rl1 (в локальную сеть)<span class="Apple-converted-space">&nbsp;</span><br />Первые четыре пункта должны быть уже заполнены как в предидущем случае<span class="Apple-converted-space">&nbsp;</span><br />IPv4 adress - 192.168.10.1<span class="Apple-converted-space">&nbsp;</span><br />NetMask - 255.255.255.0</p></li><li>поднимать карту при запуске - ДА</li><li>Использовать данную машину как Gateway - ДА</li><li>Хотите подредактировать (и использовать) inetd.conf - YES<span class="Apple-converted-space">&nbsp;</span><br />Находим строчку начинающуюся с #ftp stream tcp превращаем в #ftp stream tcp<span class="Apple-converted-space">&nbsp;</span><br />Выходим из редактора vi с сохранением :wq</li><li>Хотите анонимный доступ по FTP? - Нет</li><li>Сконфигурировать машину как NFS server? - NO</li><li>Сконфигурировать машину как NFS client? - NO</li><li>Повысить уровень встроенной защиты? - НЕТ</li><li>Установки системной консоли - НЕТ</li><li>Установки тайм зоны - ДА<span class="Apple-converted-space">&nbsp;</span><br />Предлагается на выбор изменить время таймера в ЦМОС или делать поправки соответственно установленной зоны - мне нравится второе (NO) 8 - Europa, 33 - Russian Federation, 2 - +00</li><li>Conformation -&gt; MSD -&gt; YES</li><li>Потдержка совместимости с линкс приложениями - абсолютно всеравно - я таких приложений не использую - NO</li><li>Система имеет мышь не USB ? - NO</li><li>Установка портов - на данном этапе не требуется - сразу жмем кнопку Install на вопрос - &quot;так ничего же не выбрано???&quot; - отвечаем ОК</li><li>Отказываемся от USB (если конечно не планируем использовать)</li><li><s>Отказываемся от редактирования групп и пользователей (потом...)</s><span class="Apple-converted-space">&nbsp;</span><br />Как оказалось впоследствии лучше на этом этапе создать хотя бы одного пользователя, у меня почему то в пост инсталяции не создала ярлык в корне /home ссылающийся на /usr/home, а залепила в корневой раздел папку home что неправельно.... как создавать пользователей и группы - смотрите ниже.</li><li>Пароль рута вводим сейчас - не помешает сразу ввести сложный, потому как после перезагрузки машина станет сразу видна в интернете. (в FreeBSD 5 версии с консоли можно зайти с пустым паролем даже если пароль введен)</li><li>менять еще что нибудь дополнительно - хватит уже - остальное потом.<p>PS: Если по дороге вы где то ошиблись - не надо судорожно нажимать reset - все настройки есть в Configure через комманду /stand/sysinstall :)</p></li><li>Exit install</li></ol><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Reboot (не забудте достать CD)</span><h2 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Первые шаги в системе после перезагрузки</h2><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Отступление для Продвинутых пользователей, изрядно подзабывших процесс установки :)<span class="Apple-converted-space">&nbsp;</span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Для тех кто столкнулся с системой впервые просьба пропустить этот абзац (для начала надо шишек набить).<span class="Apple-converted-space">&nbsp;</span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Общие рекомендации после установки. 1) Ставим cvsup-without-gui (где лежит - ниже), обновляем с его помощью исходные тексты, обновляем дерево портов, а затем уже устанавливаем необходимые программы.</span><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">После перезагрузки первое что делаем - пингуем все извесные адреса<span class="Apple-converted-space">&nbsp;</span><br /><code><b># ping 195.195.95.100</b></code><span class="Apple-converted-space">&nbsp;</span><br />закончить пинг Ctrl-C<span class="Apple-converted-space">&nbsp;</span><br />Для того, чтобы обеспечить функционирование системы на начальном уровне создадим пользователя, который заменит нам рута (root). Поскольку запись root используется в системе повсемесно - удалить ее нельзя, но оставлять этого пользователя с shell достаточно опасно.<span class="Apple-converted-space">&nbsp;</span><br /><code><b># ee /etc/master.passwd</b></code><span class="Apple-converted-space">&nbsp;</span><br />root:$1$7lfghjklkjhgfdserFCBwJ5.ZwAYg/:0:0::0:0:Charlie &amp;:/root:/bin/sh<span class="Apple-converted-space">&nbsp;</span><br />меняем на:<span class="Apple-converted-space">&nbsp;</span><br />root:*:0:0::0:0:Charlie &amp;:/nonexistent:/sbin/nologin<span class="Apple-converted-space">&nbsp;</span><br />(в FreeBSD 5 версии при компоновке pwd_mkdb ругнулся на отсутствие такого shell-а. Вообщем то это не принципиально, если вместо пароля стоит * - пришлось вернуть)<span class="Apple-converted-space">&nbsp;</span><br />Добавляем своего пользователя - например lamer<span class="Apple-converted-space">&nbsp;</span><br />lamer:*:0:0::0:0:Charlie &amp;:/root:/bin/sh<span class="Apple-converted-space">&nbsp;</span><br />(поставим bash - будет у него нормальный шелл :). А пока так)<span class="Apple-converted-space">&nbsp;</span><br /><code><b># pwd_mkdb /etc/master.passwd</b></code><span class="Apple-converted-space">&nbsp;</span><br /><code><b># passwd lamer</b></code><span class="Apple-converted-space">&nbsp;</span><br />Заносим пароль для нового рута<span class="Apple-converted-space">&nbsp;</span><br /><code><b># pwd_mkdb /etc/master.passwd</b></code><span class="Apple-converted-space">&nbsp;</span><br />В дальнейшем для административных целей используем именно его.<span class="Apple-converted-space">&nbsp;</span><br />Теперь если вы сделали все правельно - можно подключится через учетную запись - lamer по FTP к нашему серверу.<span class="Apple-converted-space">&nbsp;</span><br />Как подключатся к FTP знают нынче даже дети, так что на этом моменте заострять внимание не будем :).<span class="Apple-converted-space">&nbsp;</span><br />(если что то не пойдет - прочитайте про файлы hosts ниже по тексту)</p><h2 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Установка портов</h2><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Далее я перечислю каталоги портов, после входа в которые нужно запустить две команды<span class="Apple-converted-space">&nbsp;</span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><code style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b># make all</b></code><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; "><span class="Apple-converted-space">&nbsp;</span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><code style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b># make install</b></code><table border="1" style="font-family: 'Times New Roman'; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " width="70%"><tbody><tr><td><b>LWP для PERL</b></td><td><code>/usr/ports/www/p5-libwww</code></td></tr><tr><td><b>SUDO</b></td><td><code>/usr/ports/security/sudo</code></td></tr><tr><td><b>cvsupit</b></td><td><code>/usr/ports/net/cvsup-without-gui</code><span class="Apple-converted-space">&nbsp;</span>(очень долго, но нужно для обновления системы. 30 минут качались исходники + час - компиляция)</td></tr><tr><td><b>deco</b></td><td><code>/usr/ports/misc/deco</code></td></tr><tr><td><b>wget</b></td><td><code>/usr/ports/ftp/wget</code></td></tr><tr><td><b>bash</b></td><td><code>/usr/ports/shells/bash2</code></td></tr></tbody></table><h2 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Для полноценной работы сервера предлагается ряд вспомогательных этапов</h2><ol style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li>Заполним файлы hosts на всех компьютерах локальной сети информацией о соответствии статических адресов ИП их именам в домене:<span class="Apple-converted-space">&nbsp;</span><br /><code>127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localhost</code><span class="Apple-converted-space">&nbsp;</span><br /><code>192.168.10.1&nbsp;&nbsp;&nbsp;bsd.myd.ru bsd</code><span class="Apple-converted-space">&nbsp;</span><br /><code>192.168.10.1&nbsp;&nbsp;&nbsp;bsd.myd.ru.</code><span class="Apple-converted-space">&nbsp;</span><br /><code>192.168.10.2&nbsp;&nbsp;&nbsp;petya</code><span class="Apple-converted-space">&nbsp;</span><br /><code>192.168.10.3&nbsp;&nbsp;&nbsp;kolya</code><p>Во FreeBSD файл должен находится в /etc<span class="Apple-converted-space">&nbsp;</span><br />Windows98 - c:\windows<span class="Apple-converted-space">&nbsp;</span><br />Win2K - c:\windows\system32\drivers\etc<span class="Apple-converted-space">&nbsp;</span><br />(был один прикольный трабл - создал файл хост на Виндовой машине и записал его по ФТП на сервер БСД - через какое то время почта с моего домена перестала проходить через провайдера hot.ee - как оказалось в конце каждого имени в файле хостс стоял управляющий символ перевода строки ^M а эстонцы рассматривали мои письма как спам и отбрасывали без предупреждения - будте внимательны!!!)</p></li><li>Теперь возможно подключение к серверу из локальной сети - ftp, telnet...<span class="Apple-converted-space">&nbsp;</span><br />Рекомендую выполнить несложную настройку удаленных сервисов по SSH, описанную в<span class="Apple-converted-space">&nbsp;</span><a href="ssh.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">этой статье</a>.<span class="Apple-converted-space">&nbsp;</span><br />Если же вы хотите использовать стандартные сервисы:<span class="Apple-converted-space">&nbsp;</span><br /><code>ee /etc/inetd.conf</code><span class="Apple-converted-space">&nbsp;</span><br />Разкоментировать строчки ftp, telnet (tcp6 не трогать)</li></ol><h2 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Пересобираем ядро.</h2><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Первый раз этот этап напоминает головоломку - даже при внимательном изучении обильной инфы на эту тему голова идет кругом. Многие вещи не понятны до конца даже гуру, но при определенных мучениях понимаешь, что много не мало и на каждую машину (железо) находится свой компромис.<span class="Apple-converted-space">&nbsp;</span><br />Приведу ссылку на эту тему и не буду долго останавливатся на вопросе выбора нужных строк конфигурации ядра.<span class="Apple-converted-space">&nbsp;</span><a href="http://www.opennet.ru/docs/BSD/pascal/index.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">http://www.opennet.ru/docs/BSD/pascal/index.html</a></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Собственно -<span class="Apple-converted-space">&nbsp;</span><code>/usr/src/sys/i386/conf/myd1</code></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">machine  i386<br /><br />cpu  I586_CPU<br /><br />cpu  I686_CPU<br /><br />ident  myd1<br /><br />maxusers 512<br /><br />options  MATH_EMULATE<br /><br />options  INET<br /><br />options  FFS<br /><br />options  FFS_ROOT<br /><br />options  SOFTUPDATES<br /><br />options  MFS<br /><br />options  MD_ROOT<br /><br />options  NFS<br /><br />options  NFS_ROOT<br /><br />options  MSDOSFS<br /><br />options  CD9660<br /><br />options  CD9660_ROOT<br /><br />options  PROCFS<br /><br />options  COMPAT_43<br /><br />options  SCSI_DELAY=15000<br /><br />options  UCONSOLE<br /><br />options  USERCONFIG<br /><br />options  VISUAL_USERCONFIG<br /><br />options  KTRACE<br /><br />options  SYSVSHM<br /><br />options  SYSVMSG<br /><br />options  SYSVSEM<br /><br />options  P1003_1B<br /><br />options  _KPOSIX_PRIORITY_SCHEDULING<br /><br />options  ICMP_BANDLIM<br /><br />options  KBD_INSTALL_CDEV<br /><br />options  IPFILTER<br /><br />options  IPFILTER_LOG<br /><br />options  IPFIREWALL<br /><br />options  IPFIREWALL_VERBOSE<br /><br />options  IPFIREWALL_VERBOSE_LIMIT=10<br /><br />options  IPDIVERT<br /><br />options  TCP_DROP_SYNFIN<br /><br />device  isa<br /><br />device  eisa<br /><br />device  pci<br /><br />device  fdc0 at isa? port IO_FD1 irq 6 drq 2<br /><br />device  fd0 at fdc0 drive 0<br /><br />device  fd1 at fdc0 drive 1<br /><br />device  ata0 at isa? port IO_WD1 irq 14<br /><br />device  ata1 at isa? port IO_WD2 irq 15<br /><br />device  ata<br /><br />device  atadisk<br /><br />device  atapicd<br /><br />device  atapifd<br /><br />device  atapist<br /><br />options  ATA_STATIC_ID<br /><br />device  adv0 at isa?<br /><br />device  adw<br /><br />device  bt0 at isa?<br /><br />device  aha0 at isa?<br /><br />device  aic0 at isa?<br /><br />device  ncv<br /><br />device  nsp<br /><br />device  stg<br /><br />device  scbus<br /><br />device  atkbdc0 at isa? port IO_KBD<br /><br />device  atkbd0 at atkbdc? irq 1 flags 0x1<br /><br />device  psm0 at atkbdc? irq 12<br /><br />device  vga0 at isa?<br /><br />pseudo-device splash<br /><br />device  sc0 at isa? flags 0x100<br /><br />device  npx0 at nexus? port IO_NPX irq 13<br /><br />device  apm0    at nexus? disable flags 0x20<br /><br />device  sio0 at isa? port IO_COM1 flags 0x10 irq 4<br /><br />device  sio1 at isa? port IO_COM2 irq 3<br /><br />device  sio2 at isa? port IO_COM3 irq 5<br /><br />device  sio3 at isa? disable port IO_COM4 irq 9<br /><br />device  ppc0 at isa? irq 7<br /><br />device  ppbus<br /><br />device  lpt<br /><br />device  plip<br /><br />device  ppi<br /><br />device  miibus<br /><br />device  rl<br /><br />device  ed0 at isa? port 0x280 irq 10 iomem 0xd8000<br /><br />device  ie0 at isa? port 0x300 irq 10 iomem 0xd0000<br /><br />device  lnc0 at isa? port 0x280 irq 10 drq 0<br /><br />device  cs0 at isa? port 0x300<br /><br />device  sn0 at isa? port 0x300 irq 10<br /><br />pseudo-device loop<br /><br />pseudo-device ether<br /><br />pseudo-device sl 1<br /><br />pseudo-device ppp 1<br /><br />pseudo-device tun<br /><br />pseudo-device pty<br /><br />pseudo-device md<br /><br />pseudo-device gif<br /><br />pseudo-device faith 1<br /><br />pseudo-device bpf<br /><br />device  uhci<br /><br />device  ohci<br /><br />device  usb</pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>Теперь пересборка.</b><span class="Apple-converted-space">&nbsp;</span><br /><code><b># cd /usr/src/sys/i386/conf</b><span class="Apple-converted-space">&nbsp;</span><br /><b># config myd1</b><span class="Apple-converted-space">&nbsp;</span><br /><b># cd /usr/src/sys/compile/myd1</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make depend</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make all</b></code><span class="Apple-converted-space">&nbsp;</span>(Эта процедура занимает много времени .....)<span class="Apple-converted-space">&nbsp;</span><br /><code><b># make install</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Она переименует старое ядро в kernel.old и поместит в корневую директорию ваш новый kernel. После этого можно (и нужно) перегрузить компьютер. Если загрузка нового ядра не получилась (такое тоже возможно), вы можете загрузится со старым ядром. Для этого, в начале загрузки на подсказку Boot: надо быстро сказать kernel.old</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Не забывайте, что после запуска с новым ядром по умолчанию файрвол блокирует все запросы. Для удаленного доступа к системе можно временно набрать в командной строке</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b># ipfw add pass all from any to any</b></code></p><h2 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">NAT + Firewall</h2><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">На начальном этапе приводится описание &quot;оживления&quot; работы сервера а не рабочие настройки. В этом режиме файрвол не фильтрует пакеы!!! Для детальной настройки просьба ознакомится с<span class="Apple-converted-space">&nbsp;</span><a href="fw_nat.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">документом<span class="Apple-converted-space">&nbsp;</span><b>IPFW + ipnat</b></a>.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>rc.conf</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">defaultrouter=&quot;195.195.95.100&quot;<br /><br />gateway_enable=&quot;YES&quot;<br /><br />hostname=&quot;bsd.myd.ru&quot;<br /><br />ifconfig_rl0=&quot;inet 195.195.95.5 netmask 255.255.255.0&quot;<br /><br />ifconfig_rl1=&quot;inet 192.168.10.1 netmask 255.255.255.0&quot;<br /><br />inetd_enable=&quot;YES&quot;<br /><br />kern_securelevel_enable=&quot;NO&quot;<br /><br />nfs_reserved_port_only=&quot;YES&quot;<br /><br />sshd_enable=&quot;YES&quot;<br /><br />ipnat_enable=&quot;YES&quot;<br /><br />ipnat_program=&quot;/sbin/ipnat -CF -f&quot;<br /><br />ipnat_rules=&quot;/etc/ipnat.rules&quot; <br /><br />ipnat_flags=&quot;&quot;   <br /><br />firewall_enable=&quot;YES&quot;   <br /><br />firewall_script=&quot;/etc/rc.firewall&quot;  <br /><br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>rc.firewall</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">#<br /><br /># IPFW RULES<br /><br /># /etc/ipfw.rules<br /><br />#<br /><br />fwcmd=&quot;/sbin/ipfw&quot;<br /><br />${fwcmd} -q -f flush<br /><br />${fwcmd} -q add pass all from any to any<br /><br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>ipnat.rules</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">map rl0 192.168.10.0/24 -&gt; 195.195.95.5/24<br /><br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">На этом начальная настройка сервера закончена. Для детальной настройки служб переходите к следующим разделам :)</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:37:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Apache с потдержкой perl+php+ssl.</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Немного информации для ознакомления.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Почему &quot;после долгих мучений&quot; - при написании статьи я пользовался несколькими методами описанными в<span class="Apple-converted-space">&nbsp;</span><a href="http://www.opennet.ru/base/dev/apache_php_mysql.txt.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">1</a>,<span class="Apple-converted-space">&nbsp;</span><a href="http://www.opennet.ru/docs/HOWTO-RU/mini/Apache-mods.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">2</a>,<span class="Apple-converted-space">&nbsp;</span><a href="http://www.opennet.ru/base/dev/apache2_php.txt.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">3</a>,<span class="Apple-converted-space">&nbsp;</span><a href="http://matt.simerson.net/computing/www/apache.shtml" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">4</a>; но ни один из описанных методов не давал нужного результата. Пришлось анализировать и микшировать разные способы.<span class="Apple-converted-space">&nbsp;</span><br />Во первых я привык к стандартному расположению библиотек, настроечных файлов, бинарных модулей, во вторых, исходя из соображения наиболее задействованных модулей, хотелось собрать apache с не выгружаемым модулем PHP, так как это наиболее популярный язык для написания скриптов, и выгружаемым модулем perl, исходя из обратных соображений :). Была замечена грабля - apache не хочет собиратся с PHP и PERL статическими библиотеками. Решения данной проблемы я не нашел :( Вообщем смотрим что получилось.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Установка производилась на FreeBSD 5.1.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><br />Собираем Apache с потдержкой perl+php+ssl.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Качаем во временный каталог исходники:<span class="Apple-converted-space">&nbsp;</span><br /><b><code># mkdir /usr/local/src</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd /usr/local/src</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># fetch http://www.apache.org/dist/httpd/apache_1.3.28.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># fetch ftp://ftp.lexa.ru/pub/apache-rus/patches_1.3.28rusPL30.18.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br />Можно скачать сразу пропатчены apach - кому как нравится. Мы пойдем другим путем.<span class="Apple-converted-space">&nbsp;</span><br /><b><code># fetch http://perl.apache.org/dist/mod_perl-1.28.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># fetch http://www.modssl.org/source/mod_ssl-2.8.15-1.3.28.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># fetch -o FreeBSD.layout http://matt.simerson.net/computing/www/apache.layout</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">(если к моменту прочтения статьи вы захотите установить более свежий набор ищите ссылки по адресам<span class="Apple-converted-space">&nbsp;</span><br />http://ftp.epix.net/apache/dist/httpd/apache_1.3.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />ftp://ftp.lexa.ru/pub/apache-rus/patches_1.3.28rusPL30.18.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://www.modssl.org/source/mod_ssl-2.8.12-1.3.27.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://www.openssl.org/source/openssl-0.9.6g.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://perl.apache.org/dist/mod_perl-1.0-current.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://se.php.net/distributions/php-4.2.3.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Распаковываем:<span class="Apple-converted-space">&nbsp;</span><br /><b><code># tar -xzf apache_1.3.28.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># cp patches_1.3.28rusPL30.18.tar.gz apache_1.3.28/patches_1.3.28rusPL30.18.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd apache_1.3.28</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># tar -xzf patches_1.3.28rusPL30.18.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd ..</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># tar -xzf mod_perl-1.28.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># tar -xzf mod_ssl-2.8.15-1.3.28.tar.gz</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Конфигурим<span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd mod_ssl-2.8.15-1.3.28</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># ./configure --with-apache=../apache_1.3.28 --with-ssl=/usr --enable-shared=ssl --with-mm=/usr/local</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd ../mod_perl-1.28</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># perl Makefile.PL DO_HTTPD=1 USE_APACI=1 APACHE_PREFIX=/usr/local EVERYTHING=1 APACI_ARGS=&#39;--server-uid=www, --server-gid=www, --enable-module=so --enable-module=most, --enable-shared=max --disable-shared=perl, --enable-module=perl, --with-layout=../FreeBSD.layout:FreeBSD, --without-confadjust&#39;</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># make test</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd ../apache_1.3.28</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># make certificate TYPE=custom<span class="Apple-converted-space">&nbsp;</span></code></b>(Прошу!!! Не задавайте вопросов по поводу того как заполнять данные сертификата. Проявите сообразительность!)<span class="Apple-converted-space">&nbsp;</span><br /><b><code># rm /usr/local/etc/apache/httpd.conf<span class="Apple-converted-space">&nbsp;</span></code></b>(Если сервер ранее не настраивался) Если этого не сделать прийдется ручками править настройку SSL<span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd ../mod_perl-1.28</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># make install</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># cvsup -g /etc/cvsup-ports<span class="Apple-converted-space">&nbsp;</span></code></b>(учитываем, что свежие порты подразумевают использование свежего apache и соответствующих ему модулей)<span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd /usr/ports/www/mod_php4</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># make<span class="Apple-converted-space">&nbsp;</span></code></b>(В диалоге добавляем те функции работу которых будут использовать скрипты php)<span class="Apple-converted-space">&nbsp;</span><br /><b><code># make install</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ee /usr/local/etc/rc.d/startssl.pl</code></b><span class="Apple-converted-space">&nbsp;</span><br />Записываем скрипт автоподстановки пароля при запуске<span class="Apple-converted-space">&nbsp;</span><br /><code>#!/usr/bin/perl</code><span class="Apple-converted-space">&nbsp;</span><br /><code>print &quot;&lt;пароль для сертификата&gt;\n&quot;;</code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Выставляем права для скрипта<span class="Apple-converted-space">&nbsp;</span><br /><b><code># chmod +x /usr/local/etc/rc.d/startssl.pl</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ee /usr/local/etc/apache/httpd.conf</code></b><span class="Apple-converted-space">&nbsp;</span><br />Для автозаполнения пароля<span class="Apple-converted-space">&nbsp;</span><br />Строчку вида<span class="Apple-converted-space">&nbsp;</span><br /><code>SSLPassPhraseDialog builtin</code><span class="Apple-converted-space">&nbsp;</span><br />Меняем на<span class="Apple-converted-space">&nbsp;</span><br /><code>SSLPassPhraseDialog exec:/usr/local/etc/rc.d/startssl.pl</code><span class="Apple-converted-space">&nbsp;</span><br />Находим блок из множества<span class="Apple-converted-space">&nbsp;</span><br /><code>AddLanguage и AddCharset</code><span class="Apple-converted-space">&nbsp;</span><br />По окончанию блока пишем<span class="Apple-converted-space">&nbsp;</span><br /><code>AddDefaultCharset Windows-1251</code><span class="Apple-converted-space">&nbsp;</span><br />Находим<span class="Apple-converted-space">&nbsp;</span><br /><code>AddType application/x-tar .tgz</code><span class="Apple-converted-space">&nbsp;</span><br />После нее добавляем<span class="Apple-converted-space">&nbsp;</span><br /><code>AddType application/x-httpd-php .php</code><span class="Apple-converted-space">&nbsp;</span><br /><code>AddType application/x-httpd-php-source .phps</code><span class="Apple-converted-space">&nbsp;</span><br />Находим<span class="Apple-converted-space">&nbsp;</span><br /><code>#AddType text/html .shtml</code><span class="Apple-converted-space">&nbsp;</span><br /><code>#AddHandler server-parsed .shtml</code><span class="Apple-converted-space">&nbsp;</span><br />Снимаем коментарии<span class="Apple-converted-space">&nbsp;</span><br /><code>AddType text/html .shtml</code><span class="Apple-converted-space">&nbsp;</span><br /><code>AddHandler server-parsed .shtml</code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Редактируем под себя :).<span class="Apple-converted-space">&nbsp;</span><br /><b><code># /usr/local/sbin/apachectl startssl</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Будем считать, что настройка завершена :)</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:37:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Установка связки Apach+php+perl+ssl Статические библиотеки</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Немного информации для ознакомления.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Почему &quot;после долгих мучений&quot; - при написании статьи я пользовался несколькими методами описанными в<span class="Apple-converted-space">&nbsp;</span><a href="http://www.opennet.ru/base/dev/apache_php_mysql.txt.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">1</a>,<span class="Apple-converted-space">&nbsp;</span><a href="http://www.opennet.ru/docs/HOWTO-RU/mini/Apache-mods.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">2</a>,<span class="Apple-converted-space">&nbsp;</span><a href="http://www.opennet.ru/base/dev/apache2_php.txt.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">3</a>,<span class="Apple-converted-space">&nbsp;</span><a href="http://matt.simerson.net/computing/www/apache.shtml" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">4</a>; но ни один из описанных методов не давал нужного результата. Пришлось анализировать и микшировать разные способы.<span class="Apple-converted-space">&nbsp;</span><br />Во первых я привык к стандартному расположению библиотек, настроечных файлов, бинарных модулей, во вторых, исходя из соображения наиболее задействованных модулей, хотелось собрать apache с не выгружаемым модулем PHP, так как это наиболее популярный язык для написания скриптов, и выгружаемым модулем perl, исходя из обратных соображений :). Была замечена грабля - apache не хочет собиратся с PHP и PERL статическими библиотеками. Решения данной проблемы я не нашел :( Вообщем смотрим что получилось.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Установка производилась на FreeBSD 5.1. В разработке статьи активное участие принимал<span class="Apple-converted-space">&nbsp;</span><b>dimka</b><span class="Apple-converted-space">&nbsp;</span>- dimka@dimka.ee,<span class="Apple-converted-space">&nbsp;</span><br />предложеный им метод был урезан и подстроен для установки на голую систему.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># mkdir /usr/local/src<span class="Apple-converted-space">&nbsp;</span><br /># cd /usr/local/src<span class="Apple-converted-space">&nbsp;</span><br /># fetch http://www.apache.org/dist/httpd/apache_1.3.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># fetch ftp://ftp.lexa.ru/pub/apache-rus/patches_1.3.28rusPL30.18.tar.gz<span class="Apple-converted-space">&nbsp;</span></code></b><br />Можно скачать сразу пропатчены apach - кому как нравится. Мы пойдем другим путем.<span class="Apple-converted-space">&nbsp;</span><br /><b><code># fetch http://perl.apache.org/dist/mod_perl-1.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># fetch http://www.modssl.org/source/mod_ssl-2.8.15-1.3.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># fetch -o FreeBSD.layout http://matt.simerson.net/computing/www/apache.layout</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">(если к моменту прочтения статьи вы захотите установить более свежий набор ищите ссылки по адресам<span class="Apple-converted-space">&nbsp;</span><br />http://ftp.epix.net/apache/dist/httpd/apache_1.3.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />ftp://ftp.lexa.ru/pub/apache-rus/patches_1.3.28rusPL30.18.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://www.modssl.org/source/mod_ssl-2.8.12-1.3.27.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://www.openssl.org/source/openssl-0.9.6g.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://perl.apache.org/dist/mod_perl-1.0-current.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />http://se.php.net/distributions/php-4.2.3.tar.gz<span class="Apple-converted-space">&nbsp;</span><br />)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Распаковываем:<span class="Apple-converted-space">&nbsp;</span><br /><b><code># tar -xzf apache_1.3.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># cp patches_1.3.28rusPL30.18.tar.gz apache_1.3.28/patches_1.3.28rusPL30.18.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># cd apache_1.3.28<span class="Apple-converted-space">&nbsp;</span><br /># tar -xzf patches_1.3.28rusPL30.18.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># rm patches_1.3.28rusPL30.18.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># cd ..<span class="Apple-converted-space">&nbsp;</span><br /># tar -xzf mod_perl-1.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># tar -xzf mod_ssl-2.8.15-1.3.28.tar.gz<span class="Apple-converted-space">&nbsp;</span><br /># tar -jxf php-4.3.4.tar.bz2</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># cd apache_1.3.28<span class="Apple-converted-space">&nbsp;</span><br /># ./configure<span class="Apple-converted-space">&nbsp;</span><br /># cd ../php-4.3.4<span class="Apple-converted-space">&nbsp;</span><br /># ./configure --with-apache=../apache_1.3.28 --with-mysql --enable-force-cgi-redirect --enable-sockets --with-mod_charset --with-xml<span class="Apple-converted-space">&nbsp;</span><br /># make<span class="Apple-converted-space">&nbsp;</span><br /># make install<span class="Apple-converted-space">&nbsp;</span><br /># cd ../mod_perl-1.28<span class="Apple-converted-space">&nbsp;</span><br /># /usr/bin/perl Makefile.PL APACHE_SRC=../apache_1.3.28 DO_HTTPD=1 USE_APACI=1 APACHE_PREFIX=/usr/apache_ssl EVERYTHING=1<span class="Apple-converted-space">&nbsp;</span><br /># make<span class="Apple-converted-space">&nbsp;</span><br /># make install<span class="Apple-converted-space">&nbsp;</span><br /># cd ../mod_ssl-2.8.15-1.3.28<span class="Apple-converted-space">&nbsp;</span><br /># ./configure --with-apache=../apache_1.3.28 --activate-module=src/modules/php4/libphp4.a<span class="Apple-converted-space">&nbsp;</span><br /># cd ../apache_1.3.28<span class="Apple-converted-space">&nbsp;</span><br /># ./configure --with-layout=../FreeBSD.layout:FreeBSD --with-perl=/usr/bin/perl --activate-module=src/modules/php4/libphp4.a --activate-module=src/modules/perl/libperl.a --enable-module=ssl --server-uid=www --server-gid=www<span class="Apple-converted-space">&nbsp;</span><br /># make<span class="Apple-converted-space">&nbsp;</span><br /># make certificate TYPE=custom<span class="Apple-converted-space">&nbsp;</span><br /># make install</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ee /usr/local/etc/rc.d/startssl.pl</code></b><span class="Apple-converted-space">&nbsp;</span><br />Записываем скрипт автоподстановки пароля при запуске<span class="Apple-converted-space">&nbsp;</span><br />#!/usr/bin/perl<span class="Apple-converted-space">&nbsp;</span><br />print &quot;&lt;пароль для сертификата&gt;\n&quot;;</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Выставляем права для скрипта<span class="Apple-converted-space">&nbsp;</span><br /><b><code># chmod +x /usr/local/etc/rc.d/startssl.pl</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ee /usr/local/etc/apache/httpd.conf</code></b><span class="Apple-converted-space">&nbsp;</span><br />Для автозаполнения пароля<span class="Apple-converted-space">&nbsp;</span><br />Строчку вида<span class="Apple-converted-space">&nbsp;</span><br />SSLPassPhraseDialog builtin<span class="Apple-converted-space">&nbsp;</span><br />Меняем на<span class="Apple-converted-space">&nbsp;</span><br />SSLPassPhraseDialog exec:/usr/local/etc/rc.d/startssl.pl<span class="Apple-converted-space">&nbsp;</span><br />Находим блок из множества<span class="Apple-converted-space">&nbsp;</span><br />AddLanguage и AddCharset<span class="Apple-converted-space">&nbsp;</span><br />По окончанию блока пишем<span class="Apple-converted-space">&nbsp;</span><br />AddDefaultCharset Windows-1251<span class="Apple-converted-space">&nbsp;</span><br />Находим<span class="Apple-converted-space">&nbsp;</span><br />AddType application/x-tar .tgz<span class="Apple-converted-space">&nbsp;</span><br />После нее добавляем<span class="Apple-converted-space">&nbsp;</span><br />AddType application/x-httpd-php .php<span class="Apple-converted-space">&nbsp;</span><br />AddType application/x-httpd-php-source .phps<span class="Apple-converted-space">&nbsp;</span><br />Находим<span class="Apple-converted-space">&nbsp;</span><br />#AddType text/html .shtml<span class="Apple-converted-space">&nbsp;</span><br />#AddHandler server-parsed .shtml<span class="Apple-converted-space">&nbsp;</span><br />Снимаем коментарии<span class="Apple-converted-space">&nbsp;</span><br />AddType text/html .shtml<span class="Apple-converted-space">&nbsp;</span><br />AddHandler server-parsed .shtml</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Редактируем под себя :). (А надо то по минимуму всего поправить ServerAdmin, и ServerName)<span class="Apple-converted-space">&nbsp;</span><br /><b><code># /usr/local/sbin/apachectl startssl</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Проверяем наличие статических библиотек<span class="Apple-converted-space">&nbsp;</span><br /><b><code># /usr/local/sbin/httpd -l</code></b><span class="Apple-converted-space">&nbsp;</span><br />Compiled-in modules:<span class="Apple-converted-space">&nbsp;</span><br />http_core.c<span class="Apple-converted-space">&nbsp;</span><br />mod_env.c<span class="Apple-converted-space">&nbsp;</span><br />mod_log_config.c<span class="Apple-converted-space">&nbsp;</span><br />mod_mime.c<span class="Apple-converted-space">&nbsp;</span><br />mod_negotiation.c<span class="Apple-converted-space">&nbsp;</span><br />mod_status.c<span class="Apple-converted-space">&nbsp;</span><br />mod_include.c<span class="Apple-converted-space">&nbsp;</span><br />mod_autoindex.c<span class="Apple-converted-space">&nbsp;</span><br />mod_dir.c<span class="Apple-converted-space">&nbsp;</span><br />mod_cgi.c<span class="Apple-converted-space">&nbsp;</span><br />mod_asis.c<span class="Apple-converted-space">&nbsp;</span><br />mod_imap.c<span class="Apple-converted-space">&nbsp;</span><br />mod_actions.c<span class="Apple-converted-space">&nbsp;</span><br />mod_userdir.c<span class="Apple-converted-space">&nbsp;</span><br />mod_alias.c<span class="Apple-converted-space">&nbsp;</span><br />mod_access.c<span class="Apple-converted-space">&nbsp;</span><br />mod_auth.c<span class="Apple-converted-space">&nbsp;</span><br />mod_setenvif.c<span class="Apple-converted-space">&nbsp;</span><br />mod_ssl.c<span class="Apple-converted-space">&nbsp;</span><br />mod_php4.c<span class="Apple-converted-space">&nbsp;</span><br />mod_perl.c<span class="Apple-converted-space">&nbsp;</span><br />suexec: disabled; invalid wrapper /usr/local/sbin/suexec</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Будем считать, что настройка завершена :)</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:41:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        IPFW + natd</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">та статья родилась в следствии возникновения постоянных вопросов, связанных с использованием классической схемы работы сервера доступа в Интернет на базе компьютера с двумя сетевыми картами. Можно уже писать ФАК :. Опыт показывает, что посетители странички не всегда читают все статьи, считая свой опыт, в каком то вопросе исчерпывающим. Иногда это происходит из-за нехватки времени - хочется, чтобы все работало и сразу. Постараюсь как то упорядочить то что уже написано и акцентировать внимание на сложных моментах, которые являются ключевыми.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Задание:</p><ul style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li>Построить сервер доступа для локальной сети в сеть Интернет на FreeBSD с использованием встроенного сетевого экрана<span class="Apple-converted-space">&nbsp;</span><b>ipfw</b><span class="Apple-converted-space">&nbsp;</span>и демона трансляции адресов<span class="Apple-converted-space">&nbsp;</span><b>natd</b>.</li><li>Принудительно завернуть всех пользователей http и др. на прокси-сервер squid.</li><li>Предоставить отдельным пользователям (IP адресам) выход по превелигированным портам.</li><li>Предоставить отдельному пользователю (IP адресу) прямой выход в Интернет минуя прокси-сервер squid.</li><li>Обеспечить беспрепятственную работу почты, DNS.</li><li>Запретить доступ из Интернета для служб FTP, telnet, SSH, Squid.</li><li>Настроить грамотную фильтрацию протокола ICMP.</li></ul><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Исходные данные (реальные адреса изменены из соображения конфиденциальности):</p><ul style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li>IP Адрес сервера во внутреннюю сеть<span class="Apple-converted-space">&nbsp;</span><b>192.168.10.1</b></li><li>IP Адрес интерфейса в Интернет (выдается провайдером)<span class="Apple-converted-space">&nbsp;</span><b>195.195.95.5</b></li><li>IP Адрес шлюза (выдается провайдером)<span class="Apple-converted-space">&nbsp;</span><b>195.195.95.100</b></li><li>IP Адрес DNS1, DNS2 (выдается провайдером)<span class="Apple-converted-space">&nbsp;</span><b>195.195.95.50, 195.190.90.9</b></li><li>Доменное имя сервера<span class="Apple-converted-space">&nbsp;</span><b>myd.ru</b></li></ul><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Необходимые изменения в ядре:</p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">оptions  IPFIREWALL<br />options  IPFIREWALL_VERBOSE<br />options  IPFIREWALL_VERBOSE_LIMIT=10<br />options  IPFIREWALL_FORWARD<br />options  IPDIVERT<br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Небольшие пояснения, относящиеся к собираемым опциям</p><ul style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li>Включает поддержку ipfw на уровне ядра</li><li>Логировать пакеты по правилу ipfw - log</li><li>Ограничение записей попадающих в лог файл</li><li>Включение опции принудительного перенаправления пакетов (для принудительного перенаправления на squid)</li><li>Обработка пакетов внешней программой непосредственно из правил файрвола (в нашем случае демон natd)</li></ul><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Как пересобрать ядро можно почитать<span class="Apple-converted-space">&nbsp;</span><a href="install.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">&quot;Начальная установка&quot;</a></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Необходимые строки в rc.conf</p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">defaultrouter=&quot;195.195.95.100&quot;    #Смотри задание<br />gateway_enable=&quot;YES&quot;     #Обьявляемся шлюзом<br />hostname=&quot;bsd.myd.ru&quot;     #Смотри задание<br />ifconfig_rl0=&quot;inet 195.195.95.5 netmask 255.255.255.0&quot; #Внешний интерфейс<br />ifconfig_rl1=&quot;inet 192.168.10.1 netmask 255.255.255.0&quot; #Внутренний интерфейс<br />firewall_enable=&quot;YES&quot;     #Запускаем при старте работу ipfw<br />firewall_script=&quot;/etc/rc.firewall&quot;   #Скрипт с правилами ipfw<br />natd_enable=&quot;YES&quot;     #Разрешаем использовать natd<br />natd_interface=&quot;rl0&quot;     #Оъявляем интерфейс для трансляции внутренних адресов во внешний<br />natd_flags=&quot;-f /etc/natd.conf&quot;    #Опции для NAT опишем в отдельном файле<br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>/etc/natd.conf</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">same_ports yes<br />use_sockets yes<br />unregistered_only yes<br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>/etc/rc.firewall</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">#Обьявляем переменную для облегчения написания правил. Ключик -q подавляет вывод сообщений ipfw на консоль<br />fwcmd=&quot;/sbin/ipfw -q&quot;<br /><br /># Данные по внешней сети<br />LanOut=&quot;rl0&quot;<br />IPOut=&quot;195.195.95.5&quot;<br />NetOut=&quot;24&quot;<br />MaskOut=&quot;255.255.255.0&quot;<br /><br /># Данные по локальной сети<br />LanIn=&quot;rl1&quot;<br />IPIn=&quot;192.168.10.1&quot;<br />NetInIP=&quot;192.168.10.0&quot;<br />NetInMask=&quot;24&quot;<br />MaskIn=&quot;255.255.255.0&quot;<br /><br /># Привелигированные адрес (доступ избранным)<br /># Смотри примечание<br />MyIP1=&quot;192.168.10.97&quot;<br />MyIP2=&quot;192.168.10.98&quot;<br />MyIP3=&quot;192.168.10.99&quot;<br /><br /># Первый ДНС адрес наш. Ниже он ни где не используется, но можно указать фильтрацию UDP 53 если вы хотите, чтобы<br /># доступ к вашей зоне имел только ограниченный круг серверов. Лучший выход из положения использовать для службы DNS<br /># окружение chroot - jail - sandbox - называйте как хотите :)<br />dns1=&quot;192.168.10.1&quot;<br />dns2=&quot;195.195.95.50&quot;<br />dns3=&quot;195.190.90.9&quot;<br /><br /># Сбросить все правила которые устанавливались ранее<br />${fwcmd} -f flush<br /><br /># Пропускать все пакеты сгенерированные сервером (кажется что lo0 настолько понятно, что не знаешь как еще обьяснить :))<br /># Без этого вообще ничего работать не будет :)<br />${fwcmd} add pass all from any to any via lo0<br /><br /># Stop private networks (RFC1918) from entering the outside interface.<br /># Как видим из названия - это адреса, которым не место во внешней сети и появление их из Интернета на интерфейс,<br /># смотрящий в Инет - недопустимо - смело отбрасываем :)<br />${fwcmd} add deny ip from 192.168.0.0/16 to any in via ${LanOut}<br />${fwcmd} add deny ip from 172.16.0.0/12 to any in via ${LanOut}<br />${fwcmd} add deny ip from 10.0.0.0/8 to any in via ${LanOut}<br /><br /># Принудительно заворачивать всех внутренних пользователей обращающихся к любым адресам по протоколам http,https,ftp<br /># на squid (смотри примечание 1 и 2)<br /># Правило fwd должно быть выше правила divert иначе оно не будет работать<br />${fwcmd} add fwd 127.0.0.1,3128 tcp from ${NetInIP}/${NetInMask} to any http,https,ftp via ${LanIn}<br /><br /># Отправляем пакеты из внутренней сети наружу и с наружи для внутренней сети на обработку NAT<br />${fwcmd} add divert natd ip from ${NetInIP}/${NetInMask} to any out via ${LanOut}<br />${fwcmd} add divert natd ip from any to ${IPOut} in via ${LanOut}<br /><br /># Это и следующее правила значительно облегчают жизнь файрволу :)<br /># Пропускаем все соединения с установленным битом RST или ACK<br /># По другому - пропускаем установленные соединения соединение<br />${fwcmd} add pass tcp from any to any established<br /># Разрешаем все пакеты выходящие из внешнего интерфейса с внешнего IP<br />${fwcmd} add pass ip from ${IPOut} to any out xmit ${LanOut}<br /><br /># Избранным беспрепятственный доступ (все открывать неразумно)<br />${fwcmd} add pass tcp from ${MyIP1} to any 20,21,22,23,80,443,4000<br />${fwcmd} add pass tcp from any 20,21,22,23,80,443,4000 to ${MyIP1}<br />${fwcmd} add pass tcp from ${MyIP2} to any 20,21,22,23,80,443,4000<br />${fwcmd} add pass tcp from any 20,21,22,23,80,443,4000 to ${MyIP2}<br />${fwcmd} add pass tcp from ${MyIP3} to any 20,21,22,23,80,443,4000<br />${fwcmd} add pass tcp from any 20,21,22,23,80,443,4000 to ${MyIP3}<br /><br /># Запрещаем - FTP, терминал, Squid - снаружи<br />${fwcmd} add deny tcp from any to any 20,21,22,23,3128 in via ${LanOut}<br /># Запрещаем - www, FTP, терминал  - изнутри<br />${fwcmd} add deny tcp from any to any 20,21,22,23,80,443 in via ${LanIn}<br />${fwcmd} add deny tcp from any to any 8000-8104    in via ${LanIn}<br /><br /># Разрешаем почту, DNS<br />${fwcmd} add pass tcp from any to any 25,110 via ${LanOut}<br />${fwcmd} add pass tcp from any 25,110 to any via ${LanOut}<br />${fwcmd} add pass udp from any to any 53 via ${LanOut}<br />${fwcmd} add pass udp from any 53 to any via ${LanOut}<br /><br />${fwcmd} add pass all from any to any via ${LanIn}<br /><br /># Доступен сервер www из внешнего мира<br />${fwcmd} add pass tcp from ${IPOut} 80 to any via ${LanOut}<br />${fwcmd} add pass tcp from any to ${IPOut} 80 via ${LanOut}<br /><br />#ICMP<br />${fwcmd} add allow icmp from any to ${IPOut} in  via ${LanOut} icmptype 0,3,4,11,12<br />${fwcmd} add allow icmp from any to ${NetInIP}/${NetInMask} in  via ${LanOut} icmptype 0,3,4,11,12<br />${fwcmd} add allow icmp from ${IPOut} to any out via ${LanOut} icmptype 3,8,12<br />${fwcmd} add allow icmp from ${IPOut} to any out via ${LanOut} frag<br /><br />${fwcmd} add deny log all from any to any via ${LanOut}<br /><br />${fwcmd} add deny log ip from any to any<br /></pre><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">ПРИМЕЧАНИЕ:</span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">1) Относится к привелигированным адресам. Исходя из обсуждения на opennet и основываясь на личном опыте могу сказать, что в ipfw (первая версия) нельзя указывать группы адресов в отличии от ipfw2 или ipnat. Всё это к тому, что если вы захотите установить принудительное заворачивание на squid шестым по счету правилом, то у вас возникнет проблема пропуска напрямую более чем одного IP, имеются кое какие мысли как это обойти, но времени проверить нет, по этому в данный момент остановимся на этом утверждении. Итак - чтобы пропустить в интернет миную статистику squid одного из избранных необходимо заменить шестое по счету правило на -</span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><code style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>${fwcmd} add fwd 127.0.0.1,3128 tcp from not ${MyIP1} to any http,https,ftp via ${LanIn}</b></code><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">другого пока не знаю :) Просьба не тыкать в меня методами, которые описаны в мане без проверки - пишите рабочий скрипт, проверю помещу сюда :)</span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Если возникнет непреодолимое желание форвардить группы - компилите ipfw2 с ходу ссылку не скажу - попадется добавлю сюда. В FreeBSD 5.x ipfw2 вкомпилирован.</span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Ни что не мешает вам выкинуть строчки с форвардингом и прописывать юзерам использовать прокси в браузерах. Я так и сделал :) этот метод хорош когда внутренняя сеть невелика.</span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">2) Для того, чтобы пользователи могли работать в случае принудительного проксирования - В squid.conf должны присутствовать строки:</span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">http_port 3128<br />httpd_accel_host virtual<br />httpd_accel_port 80<br />httpd_accel_with_proxy on<br />httpd_accel_uses_host_header on<br /></pre><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Кому что не понятно - пишите в книгу, дополню.</span>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:41:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        IPFW + ipnat</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Один из сложных моментов настройки - создание правил файрвола. Рекомендую изучить<span class="Apple-converted-space">&nbsp;</span><a href="http://www.hub.ru/modules.php?name=Sections&amp;sop=viewarticle&amp;artid=24&amp;page=4" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">статью Кузмича</a><span class="Apple-converted-space">&nbsp;</span>только не надо копировать правила которые написаны для примера. Эта статья хороша своими обьяснениями работы ключей и пр.<span class="Apple-converted-space">&nbsp;</span><br />Писать постоянные правила файрвол<span class="Apple-converted-space">&nbsp;</span><b>нужно</b><span class="Apple-converted-space">&nbsp;</span>только при полном понимании работы ipfw в противном случае или что то не будет работать (чаще всего) или хакеры через день сломают вашу машину.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Итак рабочие файлы файрвола и нат (подставлялись на место рабочих в момент написания. Учтите, что работа natd отличается от работы ipnat. :))</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>rc.conf</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">defaultrouter=&quot;195.195.95.100&quot;<br />gateway_enable=&quot;YES&quot;<br />hostname=&quot;bsd.myd.ru&quot;<br />ifconfig_rl0=&quot;inet 195.195.95.5 netmask 255.255.255.0&quot;<br />ifconfig_rl1=&quot;inet 192.168.10.1 netmask 255.255.255.0&quot;<br />inetd_enable=&quot;YES&quot;<br />kern_securelevel_enable=&quot;NO&quot;<br />lpd_enable=&quot;YES&quot;<br />nfs_reserved_port_only=&quot;YES&quot;<br />sendmail_enable=&quot;YES&quot;<br />sshd_enable=&quot;YES&quot;<br /># Секцию ниже нужно убрать если DNS для зоны не настроен<br />named_enable=&quot;YES&quot;  <br />named_program=&quot;named&quot;  <br />named_flags=&quot;-u bind -g bind&quot;<br />#<br />ipnat_enable=&quot;YES&quot;<br />ipnat_program=&quot;/sbin/ipnat -CF -f&quot;<br />ipnat_rules=&quot;/etc/ipnat.rules&quot; <br />ipnat_flags=&quot;&quot;   <br />firewall_enable=&quot;YES&quot;   <br />firewall_script=&quot;/etc/rc.firewall&quot;  <br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>rc.firewall</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">#<br /># IPFW RULES<br /># /etc/ipfw.rules<br />#<br /><br />fwcmd=&quot;/sbin/ipfw&quot;<br /><br />LanOut=&quot;rl0&quot;<br />IPOut=&quot;195.195.95.5&quot;<br />NetOut=&quot;24&quot;<br />MaskOut=&quot;255.255.255.0&quot;<br /><br />LanIn=&quot;rl1&quot;<br />IPIn=&quot;192.168.10.1&quot;<br />NetInIP=&quot;192.168.10.0&quot;<br />NetInMask=&quot;24&quot;<br />MaskIn=&quot;255.255.255.0&quot;<br /><br />MyIP1=&quot;192.168.10.97&quot;<br />MyIP2=&quot;192.168.10.98&quot;<br />MyIP3=&quot;192.168.10.99&quot;<br /><br />dns1=&quot;192.168.10.1&quot;<br />dns2=&quot;195.195.95.50&quot;<br />dns3=&quot;195.190.90.9&quot;<br /><br />${fwcmd} -q -f flush<br /><br /># <br />${fwcmd} -q add pass all from any to any via lo0<br />${fwcmd} -q add pass all from any to any via ppp0<br /><br /># Пропускаем все соединения с установленным битом RST или ACK<br />${fwcmd} -q add pass tcp from any to any established<br /># Разрешаем все пакеты выходящие из внешнего интерфейса с внешнего IP<br />${fwcmd} -q add pass ip from ${IPOut} to any out xmit ${LanOut}<br /><br /># Stop private networks (RFC1918) from entering the outside interface.<br />${fwcmd} -q add deny ip from 192.168.0.0/16 to any in via ${LanOut}<br />${fwcmd} -q add deny ip from 172.16.0.0/12 to any in via ${LanOut}<br />${fwcmd} -q add deny ip from 10.0.0.0/8 to any in via ${LanOut}<br /><br /># NAT<br />#${fwcmd} -q add divert natd ip from any to any via ${LanOut}<br /><br /># www, ftp... только по заданным интерфейсам - остальные через squid<br />${fwcmd} -q add pass tcp from ${MyIP1} to any 20,21,22,23,80,443<br />${fwcmd} -q add pass tcp from any 20,21,22,23,80,443 to ${MyIP1}<br />${fwcmd} -q add pass tcp from ${MyIP2} to any 20,21,22,23,80,443<br />${fwcmd} -q add pass tcp from any 20,21,22,23,80,443 to ${MyIP2}<br />${fwcmd} -q add pass tcp from ${MyIP3} to any 20,21,22,23,80,443<br />${fwcmd} -q add pass tcp from any 20,21,22,23,80,443 to ${MyIP3}<br /><br /># Запрещаем - FTP, терминал, Squid - снаружи<br />${fwcmd} -q add deny tcp from any to any 20,21,22,23,3128 in via ${LanOut}<br /># Запрещаем - www, FTP, терминал  - изнутри<br />${fwcmd} -q add deny tcp from any to any 20,21,22,23,80,443 in via ${LanIn}<br />${fwcmd} -q add deny tcp from any to any 8000-8104    in via ${LanIn}<br /><br /># Разрешаем почту, DNS<br />${fwcmd} -q add pass tcp from any to any 25,110 via ${LanOut}<br />${fwcmd} -q add pass tcp from any 25,110 to any via ${LanOut}<br />${fwcmd} -q add pass udp from any to any 53 via ${LanOut}<br />${fwcmd} -q add pass udp from any 53 to any via ${LanOut}<br /><br />${fwcmd} -q add pass all from any to any via ${LanIn}<br /><br /># Доступен сервер www из внешнего мира<br />${fwcmd} -q add pass tcp from ${IPOut} 80 to any via ${LanOut}<br />${fwcmd} -q add pass tcp from any to ${IPOut} 80 via ${LanOut}<br /><br />#ICMP<br />${fwcmd} -q add allow icmp from any to ${IPOut} in  via ${LanOut} icmptype 0,3,4,11,12<br />${fwcmd} -q add allow icmp from any to ${NetInIP}/${NetInMask} in  via ${LanOut} icmptype 0,3,4,11,12<br />${fwcmd} -q add allow icmp from ${IPOut} to any out via ${LanOut} icmptype 3,8,12 <br />${fwcmd} -q add allow icmp from ${IPOut} to any out via ${LanOut} frag <br />${fwcmd} -q add deny   log icmp from any to any in  via ${LanOut}<br />${fwcmd} -q add reject log icmp from any to any out via ${LanOut}<br /><br />${fwcmd} -q add deny log all from any to any<br /></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>ipnat.rules</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">map rl0 0/0 -&gt; 0/32 proxy port ftp ftp/tcp<br />map rl0 192.168.10.0/24 -&gt; 195.195.95.5/24 proxy port ftp ftp/tcp<br />map rl0 192.168.10.0/24 -&gt; 195.195.95.5/24</pre>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:43:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        IPFW, recv и xmit при прохождении через via</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Рекомендую изучить<span class="Apple-converted-space">&nbsp;</span><b>man ipfw</b><span class="Apple-converted-space">&nbsp;</span>:)<span class="Apple-converted-space">&nbsp;</span><br />Поговорим о вещах которые вызывают затруднение у новичков при настройке ipfw</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>in</b><span class="Apple-converted-space">&nbsp;</span>и<span class="Apple-converted-space">&nbsp;</span><b>out</b><span class="Apple-converted-space">&nbsp;</span>относятся к направлению движения пакета (подразумевается относительно операционной системы на которой установлен ipfw)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>recv, xmit, via</b><span class="Apple-converted-space">&nbsp;</span>- это относится к интерфейсу</p><ul><li style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">recv - интерфейс получил пакет</li><li style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">xmit - передал пакет</li><li style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">via - через интерфейс неважно в какую сторону<p><b>in recv rl0</b><span class="Apple-converted-space">&nbsp;</span>- входящий пакет, полученный с интерфейса rl0<span class="Apple-converted-space">&nbsp;</span><br /><b>out recv rl0</b><span class="Apple-converted-space">&nbsp;</span>- исходящий пакет, полученный rl0 интерфейсом<span class="Apple-converted-space">&nbsp;</span><br /><b>out xmit rl0</b><span class="Apple-converted-space">&nbsp;</span>- исходящий пакет, отправленный rl0 интерфейсом</p><p><b>in xmit rl0</b><span class="Apple-converted-space">&nbsp;</span>- входящий пакет, отправленный rl0 интерфейсом - неверное утверждени. При испольнении вызовет ошибку.</p><p><b>out recv rl0 xmit rl1</b><span class="Apple-converted-space">&nbsp;</span>- исходящий пакет, полученный через rl0 и отправленный через rl1.</p><p><b>out xmit = out via</b><span class="Apple-converted-space">&nbsp;</span><br /><b>in recv = in via</b></p><p>Вот пример работы правил на внешнем интерфейсе:<span class="Apple-converted-space">&nbsp;</span><br />Работаем через<span class="Apple-converted-space">&nbsp;</span><b>ipfw+ipnat</b><span class="Apple-converted-space">&nbsp;</span>(будет время дополню для связки ipfw+natd)<span class="Apple-converted-space">&nbsp;</span><br />Исходные данные для примера:<span class="Apple-converted-space">&nbsp;</span><br /><b>195.195.95.15</b><span class="Apple-converted-space">&nbsp;</span>- Внешний интерфейс на котором висит НАТ<span class="Apple-converted-space">&nbsp;</span><br /><b>80.15.235.143:80</b><span class="Apple-converted-space">&nbsp;</span>- www.microsoft.com<span class="Apple-converted-space">&nbsp;</span><br /><b>192.168.10.98</b><span class="Apple-converted-space">&nbsp;</span>- Локальный компьютер для теста</p><h2>Работа правила out xmit rl0</h2><br /><code><b># ipfw add 90 pass log tcp from any to any out xmit rl0</b></code><span class="Apple-converted-space">&nbsp;</span><br />Смотрим лог<span class="Apple-converted-space">&nbsp;</span><br /><code>Aug 23 11:30:50 myd.ru /kernel: ipfw: 90 Accept TCP 195.195.95.15:4244 80.15.235.143:80 out via rl0</code><span class="Apple-converted-space">&nbsp;</span><br />Вывод - правило out xmit rl0 пропускает пакеты обработанные натом во внешнюю сеть (в ИНТЕРНЕТ)<span class="Apple-converted-space">&nbsp;</span><br /><code><b># ipfw del 90</b></code><h2>Работа правила out recv rl0</h2><br /><code><b>ipfw add 90 pass log tcp from any to any out recv rl0</b></code><span class="Apple-converted-space">&nbsp;</span><br />Смотрим лог<span class="Apple-converted-space">&nbsp;</span><br /><code>Aug 23 11:33:30 myd.ru /kernel: ipfw: 90 Accept TCP 80.15.235.143:80 192.168.10.98:3182 out via rl1</code><span class="Apple-converted-space">&nbsp;</span><br /><b>Вывод</b><span class="Apple-converted-space">&nbsp;</span>- правило out recv rl0 пропускает пакеты (ответ на наш запрос) с внешнего сервера во внутреннюю сеть после возврата исходных заговолков, перепеисанных НАТом при отправке. Это правило самое интересное и по этому чаще встречается в реальных правилах файрволов. Мы пропускаем исходящие пакеты (относительно нашего шлюза) - тоесть пакет для нашей локальной сети, полученный rl0 интерфейсом, а значит правило касается всех интерфейсов работающих на выход (относительно нашего шлюза). Тогда сколько бы нибыло локальных сетей подключено к нашему шлюзу все пакеты адресованные им были бы пропущены с помощью этого правила - rl1, rl2, rl3 ...<span class="Apple-converted-space">&nbsp;</span><br /><b>Будте бдительны!</b><span class="Apple-converted-space">&nbsp;</span><br />Именно исходя из этого чаще всего встречаются правила типа<span class="Apple-converted-space">&nbsp;</span><b>out recv rl0 xmit rl1</b><span class="Apple-converted-space">&nbsp;</span>- с указание конкретного интерфейса для выхода из системы<span class="Apple-converted-space">&nbsp;</span><br /><code><b># ipfw del 90</b></code><h2>Работа правила in recv rl0</h2><br /><code><b># ipfw add 90 pass log tcp from any to any in recv rl0</b></code><span class="Apple-converted-space">&nbsp;</span><br />Смотрим лог<span class="Apple-converted-space">&nbsp;</span><br /><code>Aug 23 11:36:05 myd.ru /kernel: ipfw: 90 Accept TCP 80.15.235.143:80 192.168.10.98:3182 in via rl0</code><span class="Apple-converted-space">&nbsp;</span><br /><code><b># ipfw del 90</b></code><p>Хочу заметить, что в случае использования<span class="Apple-converted-space">&nbsp;</span><b>natd</b><span class="Apple-converted-space">&nbsp;</span>результат будет другой.</p><p><b>natd</b><span class="Apple-converted-space">&nbsp;</span>от<span class="Apple-converted-space">&nbsp;</span><b>ipnat</b><span class="Apple-converted-space">&nbsp;</span>отличается в первую очередь моментом переписывания заголовков.</p><p><b>natd</b><span class="Apple-converted-space">&nbsp;</span>- переписывает заголовок в момент передачи ему пакета из файрвол, а ipnat делает это автоматически при поступлении пакета на внешний интерфейс.<span class="Apple-converted-space">&nbsp;</span><br />Отсюда следует, что правило<span class="Apple-converted-space">&nbsp;</span><b>divert</b><span class="Apple-converted-space">&nbsp;</span>в случае<span class="Apple-converted-space">&nbsp;</span><b>natd</b><span class="Apple-converted-space">&nbsp;</span>необходимо размещать выше любого правила<span class="Apple-converted-space">&nbsp;</span><b>out xmit via rl0</b><span class="Apple-converted-space">&nbsp;</span>или<span class="Apple-converted-space">&nbsp;</span><b>out via rl0</b>, где<span class="Apple-converted-space">&nbsp;</span><b>rl0</b><span class="Apple-converted-space">&nbsp;</span>- интерфейс смотрящий в инет.</p><p>Пример (<b>natd</b>):</p><p>Правильно -<span class="Apple-converted-space">&nbsp;</span><br /><code>${fwcmd} -q add divert natd ip from any to any via ${LanOut}</code><span class="Apple-converted-space">&nbsp;</span><br /><code>${fwcmd} -q add pass ip from ${IPOut} to any out xmit ${LanOut}</code></p><p>Неправильно - потому, что пакет еще не поступил на внешний интерфейс - первое правило работать не будет<span class="Apple-converted-space">&nbsp;</span><br /><code>${fwcmd} -q add pass ip from ${IPOut} to any out xmit ${LanOut}</code><span class="Apple-converted-space">&nbsp;</span><br /><code>${fwcmd} -q add divert natd ip from any to any via ${LanOut}</code></p></li></ul>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:50:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Установка связки Squid + squidGuard</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Устанавливать squid и squidGuard будем из портов.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b># cd /usr/ports/www/squid</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make all</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make install</b><span class="Apple-converted-space">&nbsp;</span><br /><b># cd /usr/ports/www/squidguard</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make all</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make install</b><span class="Apple-converted-space">&nbsp;</span><br />Если не выставить права на папки при запуске сразу получим сообщения об ошибке. Squid по умолчанию использует идентификатор группы squid и запускается именно из под него. Если вы решите, что необходимо использовать другого юзера для работы squid - выставляем права для него.<span class="Apple-converted-space">&nbsp;</span><br /><b># chown squid:squid /usr/local/squid</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chown squid:squid /usr/local/squid/logs</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chown squid:squid /usr/local/squid/cache</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Раскоментируем в файле<span class="Apple-converted-space">&nbsp;</span><b>/usr/local/etc/squid/squid.conf</b><span class="Apple-converted-space">&nbsp;</span>следующие строчки</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b>http_port 3128</b><span class="Apple-converted-space">&nbsp;</span><br /><b>redirect_program /usr/local/bin/squidGuard</b><span class="Apple-converted-space">&nbsp;</span><br /><b>redirect_children 20</b><span class="Apple-converted-space">&nbsp;</span>(тут указываем количество пользователей которые одновременно работают с кешем)<span class="Apple-converted-space">&nbsp;</span><br /><b>cache_store_log none</b><span class="Apple-converted-space">&nbsp;</span><br /><b>logfile_rotate 3</b><span class="Apple-converted-space">&nbsp;</span><br /><b>emulate_httpd_log on</b><span class="Apple-converted-space">&nbsp;</span>(в противном случае в логе отображается абсолютное время. Вид лога меняется, так что если у Вас не работает именно Ваш анализатор лога - попробуйте изменить эту опцию)<span class="Apple-converted-space">&nbsp;</span><br /><b>ftp_user anonymous@bestoff.com</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Находим секцию<span class="Apple-converted-space">&nbsp;</span><br /><code># ACCESS CONTROLS</code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">В ней подсекцию<span class="Apple-converted-space">&nbsp;</span><br /><code># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Раскоментируем 2 строчки<span class="Apple-converted-space">&nbsp;</span><br /><code><b>acl our_networks src 192.168.0.0/24</b><span class="Apple-converted-space">&nbsp;</span><br /><b>http_access allow our_networks</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Создаем начальную базу кеша</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b># /usr/local/sbin/squid -z</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Настраиваем<span class="Apple-converted-space">&nbsp;</span><b>squidGuard</b>. Данный процесс хорошо описан в статье (http://unixgems.jinr.ru/~lavr/squidguard.html)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">К настройкам в этой статье добавим свои базы<span class="Apple-converted-space">&nbsp;</span><br /><b><b>/var/db/squidGuard/good</b></b><span class="Apple-converted-space">&nbsp;</span><br /><b><b>/var/db/squidGuard/fack</b></b><span class="Apple-converted-space">&nbsp;</span><br />Готовый пример<span class="Apple-converted-space">&nbsp;</span><b>/usr/local/etc/squid/squidGuard</b></p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">#<br />dbhome /var/db/squidGuard<br />logdir /usr/local/squid/logs<br /># Определение временных промежутков:<br /># s = sun, m = mon, t =tue, w = wed, h = thu, f = fri, a = sat<br /># leisure-time - нерабочее время<br />time leisure-time {   <br /> weekly * 00:00-11:00 18:00-24:00 13:00-14:00 # ночь+утро, вечер+ночь, обед <br /> weekly sat 15:00-18:00          # + суббота  с 17:00 до 19:00 (если у вас короткий день)<br /> weekly sun 00:00-24:00    # + выходные<br />}<br /># Исходные адреса<br /># Все адреса не попавшие в исключения<br />source all {<br />     ip 192.168.10.100-192.168.10.120<br />}<br /># Адреса без ограничений<br />source noblock {<br />     ip 192.168.10.97<br />     ip 192.168.10.98<br />     ip 192.168.10.99<br />}<br /># Адреса со стандартными ограничениями<br />source elita {<br />     ip 192.168.10.91<br />     ip 192.168.10.92<br />}<br /># Адрес машины руководителя (разрешим все в рабочее время)<br />source elita {<br />     ip 192.168.10.93<br />}<br /># Классы ограничений<br />dest good {<br /> domainlist good/domains<br /> urllist good/urls<br />}<br />dest fack {<br /> domainlist fack/domains<br /> urllist fack/urls<br /> expressionlist fack/expressions<br />}<br />dest ads {<br /> domainlist ads/domains<br /> urllist ads/urls<br />}<br />dest aggressive {<br /> domainlist aggressive/domains<br /> urllist aggressive/urls<br />}<br />dest audio-video {<br /> domainlist audio-video/domains<br /> urllist audio-video/urls<br />}<br />dest drugs {<br /> domainlist drugs/domains<br /> urllist drugs/urls<br />}<br />dest gambling {<br /> domainlist gambling/domains<br /> urllist gambling/urls<br />}<br />dest hacking {<br /> domainlist hacking/domains<br /> urllist hacking/urls<br />}<br />dest mail {<br /> domainlist mail/domains<br />}<br />dest porn {<br /> domainlist porn/domains<br /> urllist proxy/urls<br />}<br />dest proxy {<br /> domainlist proxy/domains<br /> urllist proxy/urls<br />}<br />dest violence {<br /> domainlist violence/domains<br /> urllist violence/urls<br />}<br />dest warez {<br /> domainlist warez/domains<br /> urllist warez/urls<br />}<br /><br />acl {<br />     noblock { pass all <br />     }<br />     elita {<br />         pass !ads !fack good !aggressive !audio-video !drugs !gambling !hacking !mail !porn !proxy !violence !warez !in-addr all<br />         redirect http://www.myd.ru/block.html<br />         log /usr/local/squid/logs/SG_def.log<br />     }<br />     director within leisure-time {<br />         pass !ads !fack good none<br />         redirect http://www.myd.ru/block.html<br />         log /usr/local/squid/logs/SG_def.log<br />     } else {<br />  pass all<br />     }<br /><br />     all {<br />         pass !ads !fack good none<br />         redirect http://www.myd.ru/block.html<br />         log /usr/local/squid/logs/SG_def.log<br />     }<br /><br />     default {<br />         pass none<br />         redirect http://www.myd.ru/block.html<br />         log /usr/local/squid/logs/SG_def.log<br />     }<br />}</pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Теперь создадим базы good и fack, которые мы описали выше в конфигурации</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b># cd /var/db/squidGuard</b><span class="Apple-converted-space">&nbsp;</span><br /><b># mkdir good</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chown nobody:nogroup good</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chmod 550 good</b><span class="Apple-converted-space">&nbsp;</span><br /><b># mkdir fack</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chown nobody:nogroup fack</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chmod 550 fack</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code>В папках создаем файлы наших баз<span class="Apple-converted-space">&nbsp;</span><br /><b># ee domains</b><span class="Apple-converted-space">&nbsp;</span>(доменные имена)<span class="Apple-converted-space">&nbsp;</span><br /><b># chown nobody:nogroup domains</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chmod 640 domains</b><span class="Apple-converted-space">&nbsp;</span><br /><b># ee urls</b><span class="Apple-converted-space">&nbsp;</span>(страницы)<span class="Apple-converted-space">&nbsp;</span><br /><b># chown nobody:nogroup urls</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chmod 640 urls</b><span class="Apple-converted-space">&nbsp;</span><br /><b># ee expressions</b><span class="Apple-converted-space">&nbsp;</span>(ключевые слова.)<span class="Apple-converted-space">&nbsp;</span><br /><b># chown nobody:nogroup expressions</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chmod 640 expressions</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Создаем базу для<span class="Apple-converted-space">&nbsp;</span><b>squidGuard</b><span class="Apple-converted-space">&nbsp;</span>(обновляются файлы db)<span class="Apple-converted-space">&nbsp;</span><br /><code><b># squidGuard -C all</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Если висит - идем /usr/local/squid/logs/cache.log - смотрим почему.<span class="Apple-converted-space">&nbsp;</span><br />Еще одна фишка - если фалы с расширением db не существуют - тогда squidGuard создаст их под тем пользователем из под которого была запущена команда. При запуске squid начинает ругатся - не могу открыть... и начинает работать без фильтра!!! А значит всем всё можно!!! Будте бдительны. В нашем случае это базы в папках goog и fack :)<span class="Apple-converted-space">&nbsp;</span><br /><code><b># chown nobody:nogroup /var/db/squidGuard/domains.db</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chmod 640 /var/db/squidGuard/domains.db</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chown nobody:nogroup /var/db/squidGuard/urls.db</b><span class="Apple-converted-space">&nbsp;</span><br /><b># chmod 640 /var/db/squidGuard/urls.db</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Устанавливаем анализатор лог файла access.log<span class="Apple-converted-space">&nbsp;</span><br />Качаем SAGR с сайта разработчика http://web.onda.com.br/orso/sarg.html<span class="Apple-converted-space">&nbsp;</span><br /><code><b># cd /usr/ports/distfiles</b><span class="Apple-converted-space">&nbsp;</span><br /><b># wget http://web.onda.com.br/orso/sarg-1.4.1.tar.gz</b><span class="Apple-converted-space">&nbsp;</span><br /><b># tar xzvf sarg-1.4.1.tar.gz</b><span class="Apple-converted-space">&nbsp;</span><br /><b># cd sarg-1.4.1</b><span class="Apple-converted-space">&nbsp;</span><br /><b># ./configure</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make</b><span class="Apple-converted-space">&nbsp;</span><br /><b># make install</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Меняем конфигурацию анализатора.<span class="Apple-converted-space">&nbsp;</span><br /><code><b># ee /usr/local/sarg/sarg.conf</b><span class="Apple-converted-space">&nbsp;</span><br /><b>access_log /usr/local/squid/logs/access.log.0</b><span class="Apple-converted-space">&nbsp;</span><br /><b>output_dir /usr/local/sarg/out</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Чтобы по окончанию месяца можно было смотреть статистику прописываем в<span class="Apple-converted-space">&nbsp;</span><b>/var/cron/tabs/root</b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b>10 1 1 * * /usr/local/sbin/squid -k rotate</b></code><span class="Apple-converted-space">&nbsp;</span><br />Каждый месяц 1 числа в 1:10 запускать ротацию логов.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">На этом настройка связки squid+squidGuard закончена.</p>
												<p>
												   
												   <strong>Tags:</strong> 
													freebsd <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:51:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Обеспечиваем жизнедеятельность Sendmail 8.12.8</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Сибираем sendmail поновой. Исходя из того что нам необходимо :)<span class="Apple-converted-space">&nbsp;</span><br />Просьба не смеятся над следуюшим методом закачки исходников... (когда не знаешь где находится tar архив - это самый быстрый метод :))<span class="Apple-converted-space">&nbsp;</span><br /><code><b># cd /usr/ports/mail/sendmail</b></code><span class="Apple-converted-space">&nbsp;</span><br /><code><b># make all</b></code><span class="Apple-converted-space">&nbsp;</span>(когда закачается архив топчем Ctrl+C - прерываем установку)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Устанавливаем<span class="Apple-converted-space">&nbsp;</span><b>Sendmail 8.12.8</b><span class="Apple-converted-space">&nbsp;</span><br /><code><b># cd /usr/ports/distfiles</b><span class="Apple-converted-space">&nbsp;</span><br /><b># tar -xvzf sendmail.8.12.8.tar.gz</b><span class="Apple-converted-space">&nbsp;</span><br /><b># cd /usr/ports/distfiles/sendmail-8.12.8</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Собираем sendmail<span class="Apple-converted-space">&nbsp;</span><br /><code><b># sh Build<span class="Apple-converted-space">&nbsp;</span><br /># sh Build install<span class="Apple-converted-space">&nbsp;</span><br /># cd /usr/ports/distfiles/sendmail-8.12.8/mailstats<span class="Apple-converted-space">&nbsp;</span><br /># sh Build install<span class="Apple-converted-space">&nbsp;</span><br /># cd /usr/ports/distfiles/sendmail-8.12.8/makemap<span class="Apple-converted-space">&nbsp;</span><br /># sh Build install<span class="Apple-converted-space">&nbsp;</span><br /># cd /usr/ports/distfiles/sendmail-8.12.8/praliases<span class="Apple-converted-space">&nbsp;</span><br /># sh Build install<span class="Apple-converted-space">&nbsp;</span><br /># cd /usr/ports/distfiles/sendmail-8.12.8<span class="Apple-converted-space">&nbsp;</span><br /># install -d -m 755 /var/spool/mqueue</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Собираем<span class="Apple-converted-space">&nbsp;</span><b>sendmail.cf<span class="Apple-converted-space">&nbsp;</span><br /><code># cd /usr/ports/distfiles/sendmail-8.12.8/cf/cf<span class="Apple-converted-space">&nbsp;</span><br /># ee sendmail.mc</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">В файл s<b>endmail.mc</b><span class="Apple-converted-space">&nbsp;</span>пишем (это пример)</p><pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">divert(-1)<br />divert(0)<br />VERSIONID(`2003/08/08 v1.0&#39;)<br />OSTYPE(freebsd4)dnl<br />DOMAIN(generic)<br /><br />FEATURE(access_db, `hash -T<tmpf> /etc/mail/access&#39;)<br />dnl AntiSpam<br />FEATURE(blacklist_recipients)dnl<br />FEATURE(dnsbl)dnl<br />FEATURE(local_lmtp)<br />FEATURE(mailertable, `hash -o /etc/mail/mailertable&#39;)<br />FEATURE(relay_based_on_MX)<br />FEATURE(virtusertable, `hash -o /etc/mail/virtusertable&#39;)<br /><br />FEATURE(`no_default_msa&#39;)dnl turn off default entry for MSA<br />DAEMON_OPTIONS(`Port=25, Name=MSA, M=E&#39;)dnl<br /><br />define(`confCW_FILE&#39;, `-o /etc/mail/local-host-names&#39;)<br /><br />define(`confMAX_MESSAGE_SIZE&#39;, `1500000&#39;)<br />define(`confMAX_MIME_HEADER_LENGTH&#39;, `256/128&#39;)<br />define(`confNO_RCPT_ACTION&#39;, `add-to-undisclosed&#39;)<br />define(`confPRIVACY_FLAGS&#39;, `authwarnings,noexpn,novrfy&#39;)<br />MAILER(`local&#39;)<br />MAILER(`smtp&#39;)</tmpf></pre><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b># sh Build sendmail.cf</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">инсталлируем<span class="Apple-converted-space">&nbsp;</span><b>sendmail.cf</b><span class="Apple-converted-space">&nbsp;</span>и<span class="Apple-converted-space">&nbsp;</span><b>submit.cf</b><span class="Apple-converted-space">&nbsp;</span>в<span class="Apple-converted-space">&nbsp;</span><b>/etc/mail</b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># sh Build install-cf</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># cd /etc/mail</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">В файл access пишем 192.168.10.98 RELAY</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>makemap hash access.db &lt; access</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Тут же создаем файл<span class="Apple-converted-space">&nbsp;</span><b>local-host-names</b><span class="Apple-converted-space">&nbsp;</span><br />myd.ru<span class="Apple-converted-space">&nbsp;</span><br />localhost</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Собираем<span class="Apple-converted-space">&nbsp;</span><b>popa3d</b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd /usr/ports/mail/popa3d<span class="Apple-converted-space">&nbsp;</span><br /># make all<span class="Apple-converted-space">&nbsp;</span><br /># make install</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Правим строчку в<span class="Apple-converted-space">&nbsp;</span><b>/etc/inetd.conf</b><span class="Apple-converted-space">&nbsp;</span><br /><code>pop3 stream tcp nowait root /usr/local/libexec/popa3d popa3d</code></p>
												<p>
												   
												   <strong>Tags:</strong> 
													freebsd <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:52:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Быстрая настройка удаленной консоли SSH и SFTP из Windows на FreeBSD</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Задача - коннектится к серверу FreeBSD по протоколу SSH с Windows машины.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><font color="blue">Внимание!!! Описываемый метод позволяет получать доступ к серверу без использования ключей аутентификации. Поэтому полная защищенность НЕ ГАРАНТИРОВАНА!!! Рекомендуется использовать данный метод для доступа к серверу из локальной сети. Для более подробного ознакомления с SSH рекомендую обратится к трудам<span class="Apple-converted-space">&nbsp;</span><a href="http://unix1.jinr.ru/~lavr" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">Андрея Лаврентьева</a></font>.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Забираем клиента Windows<span class="Apple-converted-space">&nbsp;</span><a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">Отсюда забираем последнюю версию putty.exe</a></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Меняем на сервере FreeBSD файлы<span class="Apple-converted-space">&nbsp;</span><br /><b>/etc/rc.conf</b><span class="Apple-converted-space">&nbsp;</span><br />Добавляем строчку:<span class="Apple-converted-space">&nbsp;</span><br /><i>sshd_enable=&quot;YES&quot;</i><span class="Apple-converted-space">&nbsp;</span><br /><b>/etc/ssh/sshd_config</b><span class="Apple-converted-space">&nbsp;</span><br />Оставляем<span class="Apple-converted-space">&nbsp;</span><br /><i>LoginGraceTime 600<span class="Apple-converted-space">&nbsp;</span><br />PermitRootLogin yes<span class="Apple-converted-space">&nbsp;</span><br />UseLogin yes</i><span class="Apple-converted-space">&nbsp;</span><br />Остальное заремить</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Файрвол должен пропускать соединения с 22 портом</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Перегружаем сервер (можно<span class="Apple-converted-space">&nbsp;</span><b>ps aux|grep sshd</b><span class="Apple-converted-space">&nbsp;</span>и<span class="Apple-converted-space">&nbsp;</span><b>kill &lt;номер процесса&gt;</b>)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Запускаем на локальной машине с Windows Putty прописываем IP сервера и указываем соединение SSH</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Не забываем, что в /etc/inetd.conf надо закоментировать строчку<span class="Apple-converted-space">&nbsp;</span><code>#telnet stream tcp nowait root /usr/libexec/telnetd telnetd</code><span class="Apple-converted-space">&nbsp;</span><br />и прочие удаленные консоли.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Теперь обезопасим (с теми же оговорками что и раньше) подключение к серверу по ftp.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Забираем клиента Windows для sftp<span class="Apple-converted-space">&nbsp;</span><a href="URL=http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">Отсюда забираем последнюю версию psftp.exe и plink.exe</a></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Меняем на сервере FreeBSD файлы<span class="Apple-converted-space">&nbsp;</span><br /><b>/etc/ssh/sshd_config</b><span class="Apple-converted-space">&nbsp;</span><br />Добавляем в конец строчку<span class="Apple-converted-space">&nbsp;</span><br /><code>Subsystem sftp /usr/local/libexec/sftp-server</code><span class="Apple-converted-space">&nbsp;</span>(если такой программы на вашем сервере не оказалось - считайте что вы попали на установку OpenSSH :D)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">К хорошему привыкаешь быстро и отказатся от FAR менеджера просто невозможно, по этому качаем плагин для работы с сервером через FAR<span class="Apple-converted-space">&nbsp;</span><a href="http://www.geocities.com/farscp/" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">тут HOME страничка плагина</a></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Теперь остается скопировать файлы плагина в папку FAR\Plugin\SCP и использовать пункт scp в меню появляющемся при нажатии Alt+F1 (F2).</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Не забываем, что в<span class="Apple-converted-space">&nbsp;</span><b>/etc/inetd.conf</b><span class="Apple-converted-space">&nbsp;</span>надо закоментировать строчку<span class="Apple-converted-space">&nbsp;</span><br /><code>#ftp stream tcp nowait root /usr/libexec/ftpd ftpd -l</code></p>
												<p>
												   
												   <strong>Tags:</strong> 
													freebsd <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:52:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Команды, приёмы работы, мелочи FreeBSD</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">При каждодневном общении с UNIX системами замечаешь что существуют полезные мелочи, которые порой существенно облегчают работу с системой. Эта тема будет содержать комманды с пояснениями их работы и разные полезные методы.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Начнем с азов.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ls</code></b><span class="Apple-converted-space">&nbsp;</span>- вывод на экран содержимого текущего каталога. Ключ -l (ls -l) выводит полную информацию содержащую права доступа время создания размер и т.д.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># pwd</code></b><span class="Apple-converted-space">&nbsp;</span>- показать текущий каталог</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># cp &lt;файл источник&gt; &lt;выходной файл&gt;</code></b><span class="Apple-converted-space">&nbsp;</span>- копирование файлов. Пример<span class="Apple-converted-space">&nbsp;</span><code><b># cp /home/pool/file /home/pool/file1</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># chmod &lt;набор прав&gt; &lt;файл или каталог&gt;</code></b><span class="Apple-converted-space">&nbsp;</span>- изменение прав доступа к файлам и каталогам. Можно использовать маску.</p><ol start="0" style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li><code>--- Ничего не разрешено</code></li><li><code>--x Нельзя читать и писать, разрешено исполнять</code></li><li><code>-w- Нельзя читать и исполнять, разрешено писать</code></li><li><code>-wx Нельзя читать, разрешено писать и исполнять</code></li><li><code>r-- Разрешено читать, нельзя писать и исполнять</code></li><li><code>r-x Разрешено читать и исполнять, нельзя писать</code></li><li><code>rw- Разрешено читать и писать, нельзя исполнять</code></li><li><code>rwx Разрешено все</code></li></ol><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Пример:<span class="Apple-converted-space">&nbsp;</span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code># chmod 755 rimin.conf</code></b><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># chown &lt;владелец&gt;:&lt;группа&gt; &lt;файл&gt;</code></b><span class="Apple-converted-space">&nbsp;</span>- изменение владельца игруппы<span class="Apple-converted-space">&nbsp;</span><br />Пример:<span class="Apple-converted-space">&nbsp;</span><b><code># chown mail:mailuser help.con</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># mkdir</code></b><span class="Apple-converted-space">&nbsp;</span>- создание директории (пример:<span class="Apple-converted-space">&nbsp;</span><code><b># mkdir ddf</b></code><span class="Apple-converted-space">&nbsp;</span>- создаст в текущем каталоге директорию ddf)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># mount_msdos /dev/fd0 /mnt</code></b><span class="Apple-converted-space">&nbsp;</span>- смонтировать флопи формата ДОС в папку /mnt<span class="Apple-converted-space">&nbsp;</span><br /><b><code># umount /dev/fd0</code></b><span class="Apple-converted-space">&nbsp;</span>- размонтировать флопи</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># tar xzvf &lt;имя файла&gt;.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span>- разархивировать tar.gz<span class="Apple-converted-space">&nbsp;</span><br /><b><code># bunzip2 -x -f file.tar.bz2</code></b><span class="Apple-converted-space">&nbsp;</span>- разархивировать file.tar.bz2<span class="Apple-converted-space">&nbsp;</span><br /><b><code># gzip -d &lt;имя_файла&gt;.gz</code></b><span class="Apple-converted-space">&nbsp;</span>- разархивировать .gz</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># top</code></b><span class="Apple-converted-space">&nbsp;</span>- посмотреть работу процессов в реальном времени ( -9 &lt;номер&gt; убить процесс)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ps axu</code></b><span class="Apple-converted-space">&nbsp;</span>- посмотреть работающие процессы (в сочетании с |grep можно найти необходимый процесс - например<span class="Apple-converted-space">&nbsp;</span><code><b># ps axu | grep sshd</b></code><span class="Apple-converted-space">&nbsp;</span>)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># pwd_mkdb -p /etc/master.passwd</code></b><span class="Apple-converted-space">&nbsp;</span>- обновить базу пользователей (пользователей корректировать в файлах /etc/master.passwd и /etc/passwd)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># passwd &lt;имя пользователя&gt;</code></b><span class="Apple-converted-space">&nbsp;</span>- сменить пароль для пользователя</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>grep</code></b><span class="Apple-converted-space">&nbsp;</span>- наиболее часто используемая команда для фильтрации лишнего - оставляет в выходном потоке только строчки с совпадением с указаным ключем один из методов использования выше на пару строк, другой grep &lt;строка&gt; &lt;файл&gt; - например<span class="Apple-converted-space">&nbsp;</span><br /><code><b># grep root /usr/master.passwd</b></code><span class="Apple-converted-space">&nbsp;</span>- выведет две строки root, toor.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>less</code></b><span class="Apple-converted-space">&nbsp;</span>- вывод построчно. Для прокрутки использовать стрелки, для выхода - q. Пример<span class="Apple-converted-space">&nbsp;</span><code><b># less /etc/masster.passwd</b></code><span class="Apple-converted-space">&nbsp;</span>или<span class="Apple-converted-space">&nbsp;</span><code><b># ps axu | less</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>more</code></b><span class="Apple-converted-space">&nbsp;</span>- вывод по страницам например<span class="Apple-converted-space">&nbsp;</span><code><b># man ps | more</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ln -sf /usr/home /home</code></b><span class="Apple-converted-space">&nbsp;</span>создание символических ссылок (после создания ссылки команда<span class="Apple-converted-space">&nbsp;</span><code><b># cd /home</b></code><span class="Apple-converted-space">&nbsp;</span>осуществит переход в папку /usr/home)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># man natd | col -b &gt; /floppy/natd</code></b><span class="Apple-converted-space">&nbsp;</span>- вывод мана в файл без управляющих символов</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>Перезагрузка процессов:</b><span class="Apple-converted-space">&nbsp;</span><br />Очень часто необходимо перезапустить процесс после изменения каки то баз или изменения настроек. В общем случае это выглядит так - находим номер процесса (допустим<span class="Apple-converted-space">&nbsp;</span><b>sshd</b>)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># ps axu | grep sshd</code></b><span class="Apple-converted-space">&nbsp;</span><br />root 5614 0.0 0.7 2300 1844 ?? Is 12:12PM 0:00.20 /usr/local/sbin/sshd<span class="Apple-converted-space">&nbsp;</span><br />Номер процесса 5614<span class="Apple-converted-space">&nbsp;</span><br />Убиваем этот процесс и запускаем по новой (некоторые процессы автоматически запускаются снова)<span class="Apple-converted-space">&nbsp;</span><br /><b><code># kill 5614</code></b><span class="Apple-converted-space">&nbsp;</span><br />пожно убить процесс зная его pid файл. Например так<span class="Apple-converted-space">&nbsp;</span><br /><code><b># kill `cat /var/run/sshd.pid`</b></code>(кавычки обратные)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Некоторые процессы нельзя убивать непосредственно. Тогда можно осуществить &quot;мягкую&quot; перезагрузку -<span class="Apple-converted-space">&nbsp;</span><br /><b><code># init 1</code></b><span class="Apple-converted-space">&nbsp;</span>(<b><code># kill 1</code></b>)<span class="Apple-converted-space">&nbsp;</span><br />Система спросит вас про шелл по умолчанию, нажмите Enter. Когда вы увидите в качестве приглашения решетку (#), скажите<span class="Apple-converted-space">&nbsp;</span><br /><b><code># exit</code></b><span class="Apple-converted-space">&nbsp;</span><br />Система заново запустится.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">После изменений баз squidGuard необходимо выполнить две команды -<span class="Apple-converted-space">&nbsp;</span><br /><b><code># squidGuard -C all</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># squid -k reconfigure</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">После изменения /usr/local/etc/squid/squid.conf<span class="Apple-converted-space">&nbsp;</span><br />достаточно выполнить только последнюю команду.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># killall -HUP inetd</code></b><span class="Apple-converted-space">&nbsp;</span>- перезапустить inetd после изменений в inetd.conf<span class="Apple-converted-space">&nbsp;</span><br />создать пользователя<span class="Apple-converted-space">&nbsp;</span><br /><b><code># pw useradd -n user1 -u 1001 -g 1001 -m -s csh</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># pwd_mkdb /etc/master.passwd</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># passwd user1</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Перечитать изменения в myd.ru зоне для DNS<span class="Apple-converted-space">&nbsp;</span><br /><b><code># ndc reload myd.ru</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Чтобы изменить стандартное приглашение к вводу комманд необходимо в домашней директории пользователя в файл<span class="Apple-converted-space">&nbsp;</span><b>.profile</b><span class="Apple-converted-space">&nbsp;</span>добавить строчку PS1=&quot;# &quot;, в скобках указываем свою строку</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Перестроить базу доступа почты<span class="Apple-converted-space">&nbsp;</span><br />makemap hash /etc/mail/access &lt; /etc/mail/access</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Обновление FreeBSD и портов на несколько машин<span class="Apple-converted-space">&nbsp;</span><br />Обновить на одной машине с помощью cvsup затем<span class="Apple-converted-space">&nbsp;</span><br /><b><code># tar -cf /usr/src.tar /usr/src<span class="Apple-converted-space">&nbsp;</span><br /># gzip /usr/src.tar</code></b><span class="Apple-converted-space">&nbsp;</span><br />Подразумевает наличие свободного места на /usr<span class="Apple-converted-space">&nbsp;</span><br />Удаляем старые исходники на машине назначения:<span class="Apple-converted-space">&nbsp;</span><br /><b><code># rm -R /usr/ports<span class="Apple-converted-space">&nbsp;</span><br /># rm -R /usr/src</code></b><span class="Apple-converted-space">&nbsp;</span><br />Затем копируем получившийся архив на обновляемый FreeBSD в раздел со свободным местом около 100Мб (всегда было больше, так что возможно это не совсем верно)<span class="Apple-converted-space">&nbsp;</span><br /><b><code># cd /<span class="Apple-converted-space">&nbsp;</span><br /># tar xzvf /usr/src.tar.gz</code></b><span class="Apple-converted-space">&nbsp;</span><br />Дерево портов по аналогии с той только разницей, что место на диске може понадобится значительно больше, а находятся они в /usr/ports<span class="Apple-converted-space">&nbsp;</span><br />Одна маленькая хитрость - чтобы не перегонять временные папки (как правило они занимают много места) можно выполнить ряд действий по их удалению:<span class="Apple-converted-space">&nbsp;</span><br /><b><code># find /usr/ports -name &quot;work&quot; &gt; /tmp/del_port.sh</code></b><span class="Apple-converted-space">&nbsp;</span><br />Затем в любом продвинутом редакторе (мне нравится EditPlus) открываем полученный скрипт, делаем замену с использованием ругулярных выражений - ищем начало строки (^), меняем на rm -R (не забываем в конце пробел), потом запускаем скрипт и тем самым облегчаем будущий архив.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Мониторинг системы встроенными средствами FreeBSD<span class="Apple-converted-space">&nbsp;</span><br /><b><code># top -mio</code></b><span class="Apple-converted-space">&nbsp;</span>- показать I/O по процессам<span class="Apple-converted-space">&nbsp;</span><br /><b><code># top -S</code></b><span class="Apple-converted-space">&nbsp;</span>- показать системные процессы в топе (по дефолту они не показываются)<span class="Apple-converted-space">&nbsp;</span><br /><b><code># gstat</code></b><span class="Apple-converted-space">&nbsp;</span>- нагрузка на диски<span class="Apple-converted-space">&nbsp;</span><br /><b><code># iostat -d -w1 -c7</code></b><span class="Apple-converted-space">&nbsp;</span>- нагрузка на диски<span class="Apple-converted-space">&nbsp;</span><br /><b><code># systat -io start 1</code></b><span class="Apple-converted-space">&nbsp;</span><br /><b><code># diskinfo -t da0</code></b><span class="Apple-converted-space">&nbsp;</span>- тест на дисковую производительность<span class="Apple-converted-space">&nbsp;</span><br /><b><code># tunefs -p /var/</code></b><span class="Apple-converted-space">&nbsp;</span>- информация о настройках файловой системы<span class="Apple-converted-space">&nbsp;</span><br /><b><code># vmstat -z</code></b><span class="Apple-converted-space">&nbsp;</span>- чего не хватает<span class="Apple-converted-space">&nbsp;</span><br /><b><code># vmstat -i</code></b><span class="Apple-converted-space">&nbsp;</span>- прерывания по устройствам<span class="Apple-converted-space">&nbsp;</span><br /><b><code># netstat -i</code></b><span class="Apple-converted-space">&nbsp;</span>- ошибки на интерфейсах<span class="Apple-converted-space">&nbsp;</span><br /><b><code># systat -ifstat</code></b><span class="Apple-converted-space">&nbsp;</span>- интенсивность передачи трафика<span class="Apple-converted-space">&nbsp;</span><br /><b><code># netstat -inb</code></b><span class="Apple-converted-space">&nbsp;</span>- передано через интерфейс в байтах<span class="Apple-converted-space">&nbsp;</span><br /><b><code># netstat -w1</code></b><span class="Apple-converted-space">&nbsp;</span>- количество пакетов/ошибок/байт на интерфейсе<span class="Apple-converted-space">&nbsp;</span><br /><b><code># sysctl kern.ipc.numopensockets</code></b><span class="Apple-converted-space">&nbsp;</span>- количество открытых сокетов<span class="Apple-converted-space">&nbsp;</span><br /><b><code># df -H</code></b><span class="Apple-converted-space">&nbsp;</span>- количество свободного места<span class="Apple-converted-space">&nbsp;</span><br /><b><code># df -i</code></b><span class="Apple-converted-space">&nbsp;</span>- количество свободных инодов<span class="Apple-converted-space">&nbsp;</span><br /><b>freecolor</b><span class="Apple-converted-space">&nbsp;</span>- очень симпатичная утилита для мониторинга использования памяти (ставится из портов)</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:53:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Редактор vi</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Сам этим редактором не пользуюсь, но иногда система спонтанно :) запускает его для радактирования какого нибудь конфига - неплохо знать хотя бы как из него выйти :)</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Оригинал статьи взят у<span class="Apple-converted-space">&nbsp;</span><a href="http://l0ner.pp.ru/vi.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">L0ner</a></p><table align="center" border="0" cellpadding="0" cellspacing="0" width="90%"><tbody><tr><td><h3>Описание</h3><p>Редактор<span class="Apple-converted-space">&nbsp;</span><b>vi</b><span class="Apple-converted-space">&nbsp;</span>- один из первых редакторов, разработанных для операционных систем UNIX. Он и по сей день остается одним из самых мощных редакторо и стандартно поставляется практически с каждой операционной системой типа UNIX. К сожалению, среди новичков редактор<span class="Apple-converted-space">&nbsp;</span><b>vi</b><span class="Apple-converted-space">&nbsp;</span>пользуется репутацией программы, известной своей загадочностью и трудностью в изучении. В нем отсутствует меню, и все действия осуществляются с помощью клавиш и клавиатурных комбинаций. Понятно, что на их изучение требуется время.</p><p>Так зачем же изучать этот редактор? Есть, по меньшей мере, 2 причины. Во-первых, он имеется в любой операционной системе типа UNIX, с которой вам, может быть, придется работать. Как знать, он может оказаться единственным редактором.</p><p>Во-вторых, когда вы изучите различные комбинации клавиш и команды, окажется, что в вашем распоряжении очень мощное средство. Если вы хорошо печатаете, редактор<span class="Apple-converted-space">&nbsp;</span><b>vi</b><span class="Apple-converted-space">&nbsp;</span>обеспечит возможность очень быстрой работы, так как для набора большинства команд не потребуется убирать руки с базовых клавиш.</p><p>Редактор<span class="Apple-converted-space">&nbsp;</span><b>vi</b><span class="Apple-converted-space">&nbsp;</span>работает в двух режимах - командном и набора текстов. Сразу после запуска vi находится в командном режиме. В этом режиме нажатия клавиш интерпретируются как команды редактору, а не как текст, вводимый в документ.</p><p>Чтобы переключиться в режим ввода текста, необходимо нажать одну из клавиш:<span class="Apple-converted-space">&nbsp;</span><b>a</b>,<span class="Apple-converted-space">&nbsp;</span><b>i</b><span class="Apple-converted-space">&nbsp;</span>или<span class="Apple-converted-space">&nbsp;</span><b>o</b>.</p><p>Клавиша<span class="Apple-converted-space">&nbsp;</span><b>a</b><span class="Apple-converted-space">&nbsp;</span>означает<span class="Apple-converted-space">&nbsp;</span><b>append</b><span class="Apple-converted-space">&nbsp;</span>(присоединить). В этом режиме вводимый текст вставляется после символа, на котором находится курсор.</p><p>Клавиша<span class="Apple-converted-space">&nbsp;</span><b>i</b><span class="Apple-converted-space">&nbsp;</span>означает<span class="Apple-converted-space">&nbsp;</span><b>insert</b><span class="Apple-converted-space">&nbsp;</span>(вставить). В этом режиме вводимый текст вставляется перед символом, на котором находится курсор.</p><p>И, наконец, клавиша<span class="Apple-converted-space">&nbsp;</span><b>o</b><span class="Apple-converted-space">&nbsp;</span>означает<span class="Apple-converted-space">&nbsp;</span><b>open</b><span class="Apple-converted-space">&nbsp;</span>(открыть). Это приводит к тому, что после строки, на которой находится курсор, в текст вставляется новая строка. Затем курсор перемещается на новую строку, и редактор переходит в режим insert, разрешая ввод текста на новой строке.</p><p><br />Имеется также несколько других команд для установки режима ввода текста, которые применяются не так часто. Это команда<span class="Apple-converted-space">&nbsp;</span><b>O</b>, которая добавляет пустую строку над текущей строкой; и команда<span class="Apple-converted-space">&nbsp;</span><b>A</b>, которая начинает вставлять текст в конце текущей строки.</p><p>Из режима ввода текста в командный режим можно вернуться нажатием клавиши<span class="Apple-converted-space">&nbsp;</span><b>Esc</b>. При переходе в командный режим редактор<span class="Apple-converted-space">&nbsp;</span><b>vi</b><span class="Apple-converted-space">&nbsp;</span>по умолчанию выдает звуковой сигнал.</p><h3>Перемещение по тексту в редакторе vi</h3><p>Перемещаться по тексту в режиме ввода текста можно, как правило, с помощью курсорных клавиш или клавиш Page Up / Page Down. Однако на терминале это не всегда функционирует. Кроме того, на некоторых терминалах эти клавиши могут отсутствовать. На этот случай имеются другие клавиши, позволяющие перемещаться по документу в командном режиме.</p><p>Чтобы воспользоваться этими клавишами перемещения, нажмите клавишу Escape для перехода в командный режим. В этом режиме можно пользоваться клавишами<span class="Apple-converted-space">&nbsp;</span><b>h</b>,<span class="Apple-converted-space">&nbsp;</span><b>j</b>,<span class="Apple-converted-space">&nbsp;</span><b>k</b><span class="Apple-converted-space">&nbsp;</span>и<span class="Apple-converted-space">&nbsp;</span><b>l</b><span class="Apple-converted-space">&nbsp;</span>для перемещения курсора влево, вниз, вверх и вправо. Вот несколько советов, которые помогут запомнить их назначение:</p><p><b>l</b><span class="Apple-converted-space">&nbsp;</span>- крайняя справа и поэтому перемещает курсор вправо.<br /><b>h</b><span class="Apple-converted-space">&nbsp;</span>- крайняя слева и перемещает курсор влево<br /><b>j</b><span class="Apple-converted-space">&nbsp;</span>- немного похожа на стрелку, направленную вниз. Соответственно, она перемещает курсор вниз<br />С буквы<span class="Apple-converted-space">&nbsp;</span><b>k</b><span class="Apple-converted-space">&nbsp;</span>начинается слово<span class="Apple-converted-space">&nbsp;</span><b>kaif</b><span class="Apple-converted-space">&nbsp;</span>:), при котором душа улетает вверх - вместе с курсором.</p><p>В командном режиме имеется еще несколько клавиш перемещения. В таблице приведены различные клавиши и их функции.</p><table border="1" cellpadding="0" cellspacing="0" width="90%"><tbody><tr><td width="20%"><div align="center"><b>клавиша</b></div></td><td width="87%"><div align="center"><b>действие</b></div></td></tr><tr><td width="20%">&nbsp;h</td><td width="87%">&nbsp;перемещает курсор влево на 1 символ</td></tr><tr><td width="20%">&nbsp;j</td><td width="87%">&nbsp;перемещает курсор вниз на 1 символ</td></tr><tr><td width="20%">&nbsp;k</td><td width="87%">&nbsp;перемещает курсор вверх на 1 символ</td></tr><tr><td width="20%">&nbsp;i</td><td width="87%">&nbsp;перемещает курсор вправо на 1 символ</td></tr><tr><td width="20%">&nbsp;w</td><td width="87%">&nbsp;перемещает курсор вперед на 1 слово</td></tr><tr><td width="20%">&nbsp;b</td><td width="87%">&nbsp;перемещает курсор назад на 1 символ</td></tr><tr><td width="20%">&nbsp;e</td><td width="87%">&nbsp;перемещает курсор в конец следующего слова</td></tr><tr><td width="20%">&nbsp;0</td><td width="87%">&nbsp;перемещает курсор в начало строки</td></tr><tr><td width="20%">&nbsp;$</td><td width="87%">&nbsp;перемещает курсор в конец строки</td></tr><tr><td width="20%">&nbsp;)</td><td width="87%">&nbsp;перемещает курсор в начало следующего предложения</td></tr><tr><td width="20%">&nbsp;(</td><td width="87%">&nbsp;перемещает курсор в начало предыдущего предложения</td></tr><tr><td width="20%">&nbsp;}</td><td width="87%">&nbsp;перемещает курсор в начало следующего абзаца</td></tr><tr><td width="20%">&nbsp;{</td><td width="87%">&nbsp;перемещает курсор в начало предыдущего абзаца</td></tr><tr><td width="20%">&nbsp;G</td><td width="87%">&nbsp;перемещает курсор в конец текущего документа</td></tr><tr><td width="20%">&nbsp;^</td><td width="87%">&nbsp;перемещает курсор к первому символу строки, не являющемуся пробелом</td></tr><tr><td width="20%">&nbsp;H</td><td width="87%">&nbsp;перемещает курсор на первую строку на экране</td></tr><tr><td width="20%">&nbsp;L</td><td width="87%">&nbsp;перемещает курсор на последнюю строку на экране</td></tr></tbody></table><p>Обратите внимание, что с каждой командой этой таблицы по умолчанию используется число 1. Клавиша<span class="Apple-converted-space">&nbsp;</span><b>j</b><span class="Apple-converted-space">&nbsp;</span>перемещает вниз на 1 строку, клавиша<span class="Apple-converted-space">&nbsp;</span><b>k</b><span class="Apple-converted-space">&nbsp;</span>перемещает его вверх на 1 строку, и так далее. Все эти команды можно модифицировать, вводя перед ними число. Так, следующая команда перемещает вниз не на одну строку, а на пять:<br /><br /><b>5j</b><br /><br />Следующая команда перемещает курсор на 75-ю строку файла, редактируемого в данный момент:<br /><br /><b>75G</b><br /><br />А вот команда, которая перемещает курсор на пятую снизу строку экрана:<br /><br /><b>5L</b><br /><br />Данный синтаксис справедлив для всех команд из таблицы, за исключением команды<span class="Apple-converted-space">&nbsp;</span><b>^</b>, которая перемещает курсор к первому символу документа, не являющегося пробелом.</p><h3><br />Прочие клавиши перемещения</h3><p>Помимо описанных выше клавиш перемещения курсора, имеется еще несколько клавиатурных комбинаций, выполняющих прокрутку текста на экране (см. ниже):<br /></p><table border="1" cellpadding="0" cellspacing="0" width="90%"><tbody><tr><td width="20%"><div align="center"><b>комбинация клавиш</b></div></td><td width="73%"><div align="center"><b>действие</b></div></td></tr><tr><td width="20%">&nbsp;z, затем Enter</td><td width="73%">&nbsp;Перемещает строку, на которой находится курсор, вверх экрана</td></tr><tr><td width="20%">&nbsp;z, затем -</td><td width="73%">&nbsp;Перемещает строку, на которой находится курсор, вниз экрана</td></tr><tr><td width="20%">&nbsp;z, затем .</td><td width="73%">&nbsp;Перемещает строку, на которой находится курсор, в центр экрана</td></tr><tr><td width="20%">&nbsp;Ctrl+u</td><td width="73%">&nbsp;Прокручивает текст на пол-экрана вверх</td></tr><tr><td width="20%">&nbsp;Ctrl+d</td><td width="73%">&nbsp;Прокручивает текст на пол-экрана вниз</td></tr><tr><td width="20%">&nbsp;Ctrl+f</td><td width="73%">&nbsp;Прокручивает текст вперед на целый экран</td></tr><tr><td width="20%">&nbsp;Ctrl+b</td><td width="73%">&nbsp;Прокручивает текст назад на целый экран</td></tr><tr><td width="20%">&nbsp;Ctrl+e</td><td width="73%">&nbsp;Прокручивает текст вниз на 1 строку</td></tr><tr><td width="20%">&nbsp;Ctrl+y</td><td width="73%">&nbsp;Прокручивает текст вверх на 1 строку</td></tr></tbody></table><h3><br />Команды редактирования текста</h3><p><br />В редакторе vi клавиши Backspace и Delete не выполняют тех действий, которых от них можно ожидать. Для удаления текста и тому подобного придется воспользоваться различными клавишами в командном режиме редактора. В таблице перечислены различные команды редактирования текста, имеющиеся в редакторе vi.</p><table border="1" cellpadding="0" cellspacing="0" width="90%"><tbody><tr><td width="20%"><div align="center"><b>клавиша</b></div></td><td width="81%"><div align="center"><b>действие</b></div></td></tr><tr><td width="20%">&nbsp;D</td><td width="81%">&nbsp;Удаляет текст от позиции курсора до конца строки</td></tr><tr><td width="20%">&nbsp;dd</td><td width="81%">&nbsp;Удаляет всю строку целиком.</td></tr><tr><td width="20%">&nbsp;<i>n</i>dd</td><td width="81%">&nbsp;Здесь n - число удаляемых строк. Например, 5dd удаляет текущую строку и четыре следующие за ней</td></tr><tr><td width="20%">&nbsp;r<i>c</i></td><td width="81%">&nbsp;Здесь c - символ. Это команда заменяет символ в позиции курсора символом, который указан за r</td></tr><tr><td width="20%">&nbsp;R</td><td width="81%">&nbsp;Текст, вводимый после этой команды, замещает текущий текст, начиная с позиции курсора. Этот режим действует до тех пор, пока не будет нажата клавиша Escape, возвращающая редактор в командный режим.</td></tr><tr><td width="20%">&nbsp;S</td><td width="81%">&nbsp;Удаляет текущую строку и начинает ввод текста на новой строке.</td></tr><tr><td width="20%">&nbsp;x</td><td width="81%">&nbsp;Удаляет символ в позиции курсора и сдвигает следующие за ним символы влево.</td></tr><tr><td width="20%">&nbsp;X</td><td width="81%">&nbsp;&nbsp;Удаляет символ перед курсором и сдвигает следующие за ним символы влево.</td></tr><tr><td width="20%">&nbsp;~</td><td width="81%">&nbsp;Заменяет букву на позиции курсора той же буквой другого регистра.</td></tr><tr><td width="20%">&nbsp;J</td><td width="81%">&nbsp;Объединяет текущую строку с предыдущей.</td></tr></tbody></table><h3>Операции над файлами и выход из редактора vi</h3><p>Это операции загрузки и сохранения файлов в редакторе vi.</p><table border="1" cellpadding="0" cellspacing="0" width="90%"><tbody><tr><td width="20%"><div align="center"><b>Клавиша</b></div></td><td width="85%"><div align="center"><b>Действие</b></div></td></tr><tr><td width="20%">&nbsp;ZZ</td><td width="85%">&nbsp;Сохраняет изменения в текущем файле и осуществляет выход из программы</td></tr><tr><td width="20%">&nbsp;:wq</td><td width="85%">&nbsp;Аналогично ZZ</td></tr><tr><td width="20%">&nbsp;:w</td><td width="85%">&nbsp;Сохраняет изменения в текущем файле</td></tr><tr><td width="20%">&nbsp;:w!</td><td width="85%">&nbsp;Сохраняет изменения в текущем файле, замещая существующий файл с таким же именем</td></tr><tr><td width="20%">&nbsp;:q</td><td width="85%">&nbsp;Осуществляет выход из программы. Если имеются несохраненные изменения, редактор выдает сообщение об этом и программа не закрывается.</td></tr><tr><td width="20%">&nbsp;:q!</td><td width="85%">&nbsp;Осуществляет выход из редактора, даже если имеются несохраненные изменения, которые теряются.</td></tr><tr><td width="20%">&nbsp;:e<span class="Apple-converted-space">&nbsp;</span><i>filename</i></td><td width="85%">&nbsp;Загружает указанный файл в редактор для редактирования. Если заданный файл не существует, то создается новый файл.</td></tr><tr><td width="20%">&nbsp;:e!</td><td width="85%">&nbsp;Отбрасывает все изменения и перезагружает с диска старый фариант файла.</td></tr></tbody></table><h3>Поиск в тексте и замена текста в редакторе vi</h3><p>В редакторе vi имеются несколько команд для выполнения поиска и замены.</p><table border="1" cellpadding="0" cellspacing="0" width="90%"><tbody><tr><td width="25%"><div align="center"><b>Клавиша(и)</b></div></td><td width="75%"><div align="center"><b>Действие</b></div></td></tr><tr><td width="25%">&nbsp;/<i>шаблон</i></td><td width="75%">&nbsp;Здесь шаблон - это фрагмент текста (слово, словосочетание, фраза и т.п.), который требуется найти. Редактор осуществляет поиск в файле в прямом направлении до первого совпадения с заданным шаблоном.</td></tr><tr><td width="25%">&nbsp;/</td><td width="75%">&nbsp;Повторяет поиск заданного образца в прямомо направлении до обнаружения следующего совпадения.</td></tr><tr><td width="25%">&nbsp;?<i>шаблон</i></td><td width="75%">&nbsp;Здесь шаблон - это фрагмент текста, который требуется найти. Редактор осуществляет поиск в файле в обратном направлении до первого встреченного совпадения с заданным шаблоном.</td></tr><tr><td width="25%">&nbsp;?</td><td width="75%">&nbsp;Повторяет поиск шаблона в обратном направлении до обнаружения очередного совпадения.</td></tr><tr><td width="25%">&nbsp;%</td><td width="75%">&nbsp;Перемещает курсор на соответствующую парную скобку.</td></tr><tr><td width="25%">&nbsp;:s/<i>шаблон1</i><span class="Apple-converted-space">&nbsp;</span>/<i>шаблон2</i></td><td width="75%">&nbsp;Заменяет в текущей строке каждое совпадение<span class="Apple-converted-space">&nbsp;</span><i>шаблона1</i><span class="Apple-converted-space">&nbsp;</span>на<span class="Apple-converted-space">&nbsp;</span><i>шаблон2</i></td></tr><tr><td width="25%">&nbsp;:%s/<i>шаблон1</i><span class="Apple-converted-space">&nbsp;</span>/<i>шаблон2</i></td><td width="75%">&nbsp;Заменяет во всем файле каждое совпадение<span class="Apple-converted-space">&nbsp;</span><i>шаблона1</i><span class="Apple-converted-space">&nbsp;</span>на<span class="Apple-converted-space">&nbsp;</span><i>шаблон2</i></td></tr></tbody></table><h3>Копирование, вырезание и вставка текста в редакторе vi</h3><table border="1" cellpadding="0" cellspacing="0" width="90%"><tbody><tr><td width="20%"><div align="center"><b>Команда</b></div></td><td width="77%"><div align="center"><b>Действие</b></div></td></tr><tr><td width="20%">&nbsp;yw</td><td width="77%">&nbsp;Помещает в буфер слово, на котором в данный момент находится курсор.</td></tr><tr><td width="20%">&nbsp;y$</td><td width="77%">&nbsp;Помещает в буфер текст от текущей позиции курсора до конца данной строки.</td></tr><tr><td width="20%">&nbsp;yy</td><td width="77%">&nbsp;Помещает в буфер всю текущую строку</td></tr><tr><td width="20%">&nbsp;<i>n</i>yy</td><td width="77%">&nbsp;Здесь n - число строк, заносимых в буфер. Например, команда<span class="Apple-converted-space">&nbsp;</span><b>5yy</b><span class="Apple-converted-space">&nbsp;</span>помещает в буфер текущую строку, а также 4 строки, следующие за ней.</td></tr></tbody></table><p>Текст из буфера можно вставить на любое место документа, перемещая на требуемое место курсор и применяя команду<span class="Apple-converted-space">&nbsp;</span><b>р</b><span class="Apple-converted-space">&nbsp;</span>или<span class="Apple-converted-space">&nbsp;</span><b>Р</b>. Команда<span class="Apple-converted-space">&nbsp;</span><b>р</b><span class="Apple-converted-space">&nbsp;</span>вставляет текст в документ после курсора. Команда<span class="Apple-converted-space">&nbsp;</span><b>Р</b><span class="Apple-converted-space">&nbsp;</span>вставляет текст перед курсором. Текст продолжает оставаться в буфере и после того, как вы вставите его в документ. Поэтому можно снова использовать эти команды для вставки текста в документ в других местах.</p><h3>Предостережение</h3><p>Редактор<span class="Apple-converted-space">&nbsp;</span><b>vi</b><span class="Apple-converted-space">&nbsp;</span>хранит в буфере текст только самой последней операции копирования текста в буфер или удаления. Другими словами, если ты выполнил команду<span class="Apple-converted-space">&nbsp;</span><b>dd</b>, чтобы удалить строку текста, а потом выполнил команду<span class="Apple-converted-space">&nbsp;</span><b>yy</b>, чтобы скопировать строку текста, то в буфере текст, с которым оперировала команда<span class="Apple-converted-space">&nbsp;</span><b>dd</b>, будет замещен текстом операции<span class="Apple-converted-space">&nbsp;</span><b>yy</b>. Это означает, что текст из операции dd будет потерян, т.е. операцию удаления отменить будет невозможно...</p></td></tr></tbody></table>
												<p>
												   
												   <strong>Tags:</strong> 
													freebsd <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:53:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Настройка newsyslog.conf</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<h2 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Ротация журналов</h2><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Автор: Станислав Лапшанский,<span class="Apple-converted-space">&nbsp;</span></span><a href="mailto:slapsh@kos-obl.kmtn.ru" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">slapsh@kos-obl.kmtn.ru</a><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Статья является<span class="Apple-converted-space">&nbsp;</span><a href="http://www.onlamp.com/pub/a/bsd/2001/06/14/Big_Scary_Daemons.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">переводом текста Майкла Лукаса (Michael Lucas)</a>.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Файлы журналов растут. Собственно говоря для этого они и предназначены. Как системный администратор, вы должны иметь способ контролировать их рост. Для этого FreeBSD имеет стандартное средство - newsyslog.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Newsyslog позволяет вам осуществлять ротацию файлов журналов. Самые старые файлы удаляются, устаревшие последовательно переименовываются и, наконец, текущий лог замещается заново созданным. Утилита newsyslog может сжимать файлы журналов, перезапускать демонов и осуществлять всю необходимую поддержку выполнения рутинных операций по перетасовке файлов.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">По умолчанию система настроена на запуск newsyslog один раз в час, это делается при помощи демона cron. Newsyslog читает конфигурационный файл /etc/newsyslog.conf и проверяет каждый указанный там файл журнала. При совпадении указанного условия производится ротация соответствующего журнала.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">В файле /etc/newsyslog.conf каждая строка содержит конфигурацию ротации для одного файла журнала. В начале каждой строки указывается полное имя файла журнала, например /var/log/httpd-error.log.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Далее идет необязательное поле, которое, кстати не используется в поставляемом вместе с системой newsyslog.conf, это список из владельца и группы файла, разделенных двоеточием. Вот так: &quot;root:wheel&quot;. Newsyslog может изменять владельца и группу и старых файлов журналов. По умолчанию владельцем устаревших журналов является пользователь root, группы wheel. Эту возможность вы можете с успехом применять на многопользовательских машинах.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Вы можете указать изменение только владельца, или только группы. В этом случае вы должны будете использовать двоеточие с пустым местом там, где должен находиться неизменяемый параметр. Например &quot;:www&quot; сменит группу на &quot;www&quot;, а &quot;user827:&quot; заменит владельца на &quot;user827&quot;.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Третье поле содержит режим доступа к устаревшим файлам журналов в стандартном трехциферном Unix-формате.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Далее идет счетчик, указывающий newsyslog на количество хранимых устаревших журналов. Newsyslog начинает отсчет файлов с нуля. В то время как большинство программ начинают считать с нуля, newsyslog включает 0 &lt;по умолчанию&gt; и считает файлы не учитывая нулевой. По умолчанию для журнала /var/log/massages счетчик равен пяти, при этом /var/log содержит следующие файлы:</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">messages<span class="Apple-converted-space">&nbsp;</span><br />messages.0.gz<span class="Apple-converted-space">&nbsp;</span><br />messages.1.gz<span class="Apple-converted-space">&nbsp;</span><br />messages.2.gz<span class="Apple-converted-space">&nbsp;</span><br />messages.3.gz<span class="Apple-converted-space">&nbsp;</span><br />messages.4.gz<span class="Apple-converted-space">&nbsp;</span><br />messages.5.gz</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Те из вас, кто может сосчитать количество файлов, видят, что их шесть, а не пять, плюс еще и текущий файл журнала. Как правило, иметь большее количество журналов лучше, чем испытывать в них недостаток. В то же время, если вы испытываете недостаток свободного пространства на винчестере, то иногда вы будете испытывать искушение удалить один-два излишних журнала. Похожая ситуация возникает на некоторых веб-серверах, на которых размещены до нескольких сотен сайтов - несколько удаленных журналов каждого сайта в сумме могут составить достаточно большой объем свободного места.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Следующие два поля конфигурационной записи указывают newsyslog размер и время при наступлении которых указанный файл необходимо подвергнуть ротации. Можно осуществлять ротацию по достижении определенного объема файла, или при наступлении определенного времени, или в обоих случаях. Если указаны оба условия, то ротация будет происходить при выполнении любого из них.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Если размер или время не важны, например, если вы хотите проводить ротацию строго один раз в день, независимо от размера файла, то вместо указания размера необходимо поставить звездочку &quot;*&quot;.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Пятое поле используется для указания размера в килобайтах. Когда newsyslog запускается он сравнивает размер файла с указанным, если файл больше, то производится его ротация.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Пока все просто, правда?</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Шестое поле, указывающее время, заставляет плакать новичков в системном администрировании. Поле времени может содержать данные четырех типов: &lt;звездочку&gt;, число или два различных формата даты.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Если вы не хотите производить ротацию журналов в определенное время, просто поставьте в это поле &lt;звездочку&gt;.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Если в поле будет число, то newsyslog будет проводить ротацию по прошествии указанного количества часов. Например, если вы хотите, что бы ротация проводилась каждые 24 часа, и вам не важно в какое именно время, то просто поставьте в это поле число &lt;24&gt;.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Если поле начинается символом &lt;@&gt;, то считается что время представлено в формате ISO-8601, этот стандарт используется newsyslog в большинстве Unix-подобных операционных систем. Этот формат использовался первой версией newsyslog разработанной в MIT (Массачусетский Технологический Институт - прим. переводчика). На первый взгляд этот формат не совсем понятен. Но, поскольку это стандарт, FreeBSD его поддерживает.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Полная запись даты в формате ISO-8601 состоит из 16 цифр с буквой &lt;T&gt; в середине. Первые четыре цифры означают год, следующие две - месяц, и еще две - день месяца. Буква &lt;T&gt; идет после даты, отделяя ее от времени, как десятичная точка в вещественных числах отделяет дробную часть от целой. После буквы &lt;T&gt; идут две цифры часа, затем две цифры минут и наконец две цифры секунд. Например дата 2 февраля 2002 года, 21:15:08, в формате ISO-8601будет выглядеть следующим образом:</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">20020202T211508</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Вы обязательно должны ставить букву &lt;T&gt; в ISO-8601-дате.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Указание полных дат в формате ISO-8601 просто и очевидно. Путаница начинается, когда вы не пишете полную дату. Вы можете указать поля даты только рядом с буквой &lt;T&gt;, оставив остальное место незаполненным. Все неуказанные поля не будут учитываться при сравнении.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Например T23 значит - любой день в году, 23:00. Если вы напишете в newsyslog.conf @T23, то ротация этого журнала будет проводиться каждый день, ровно в 23:00. Запись 4T00 значит полночь 4 числа каждого месяца, таким образом @4T00 будет запускать ротацию в это время.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Так же как при работе с crontab вам следует уточнить часы ротации. Указание даты типа @7T будет запускать ротацию один раз в час, каждый час седьмого числа каждого месяца. Таким образом такая дата будет запускать ротацию раз в час на протяжении целого дня. Это может быть полезно для отладки, но вряд ли пригодится в реальной жизни.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Эта система имеет одну серьезную проблему - она не дает простого способа задавать ежедневно выполняемые задачи. Желание запустить ротацию журнала по понедельникам, не является чем-то необычным. Запустить ротацию журнала в последний день месяца таким образом вообще не удастся. Тут на помощь приходит второй формат времени.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Если запись времени начинается со знака доллара &quot;$&quot;, то считается, что время задается в специфическом FreeBSD-формате &lt;месяц-неделя-день&gt;. Это очень похоже на cron и позволяет вам установить конкретные дни недели для выполнения задачи.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Этот формат использует три буквенных идентификатора: M (день месяца), W (день недели), H (час дня). После каждого из них идет число, указывающее точное время запуска. Часы находятся в интервале от 0 до 23, дни недели от 0 (воскресенье), до 6 (суббота). Дни месяца: от 1 и до количества дней в конкретном месяце.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Например для запуска ротации каждое воскресение в 8 утра вам следует задать время как $W0H8. Если вы захотите ротировать журналы в полдень 5 числа каждого месяца, то напишите $M5H12.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Одна интересная функция этой системы позволяет вам автоматически задавать ротацию на последний день месяца используя специальный &lt;день месяца&gt; - &lt;L&gt; (от last - последний. Прим. переводчика). Без этого знака было бы очень трудно задать ротацию журнала в последний день месяца без написания скрипта, который бы вставлял количество дней в конкретном месяце. Если вы хотите запустить ротацию вашего журнала аккаунтов за два часа до начала нового месяца, вы должны использовать запись $MLH22.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">После того, как вам удалось точно указать время ротации, перейдем к полю флагов. Это поле необязательно для большинства журналов, однако для некоторых оно жизненно важно. Newsyslog вставляет сообщение &lt;logfile turned over&gt; в каждый вновь созданный файл журнала. Если журнал ведется в двоичном виде (как например /var/log/wtmp), то добавление такого сообщения обязательно его испортит. Флаг &lt;B&gt; запрещает newsyslog&#39;у вставлять это сообщение.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Большинство журналов ведется в текстовом формате. Сжатие таких файлов сохранит много пространства на вашем диске. Флаг<span class="Apple-converted-space">&nbsp;</span><z>укажет newsyslog, что старые журналы следует сжать gzip&#39;ом.</z></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Одновременно допускается использовать только один из этих флагов.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Следующее поле задает путь к &lt;pid-файлу&gt; процесса пишущего журнал. Использование pid-файлов является простым способом записи поля ID процесса в системе, так что бы другие программы могли его легко прочитать. Большинство программ хранят свои pid-файлы в каталоге /var/run - поглядите них у себя на машине. Если в этом поле вы укажете полный путь к pid-файлу, то newsyslog будет посылать сигнал этому процессу когда будет производиться ротация. Например веб-сервер Apache должен быть оповещен при ротации его журналов. Записав в этом поле полный путь к его pid-файлу вы заставите newsyslog посылать процессу Apache сигнал kill -1, что бы он запустил свою часть обработки ротации журналов.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Большинство программ поддерживают ротацию журналов сигналом kill -1 или SIGHUP. Некоторые программы требуют специального сигнала, когда их файлы ротируют. Если вы используйте программу такого типа, то укажите номер необходимого сигнала в последнем поле.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Давайте соберем все сказанное вместе, в самом худшем случае, в примере, в который трудно поверить. Итак у вас есть журнал базы данных, который вы хотите ротировать в 23 часа в последний день каждого месяца. В документации базы данных сказано, что вы должны послать процессу базы сигнал прерывания (SIGINT или сигнал номер 2) после ротации. Вы хотите, что бы архивные журналы принадлежали пользователю &quot;dbadmin&quot; и читать их мог только он. Более того, журналы - двоичные файлы и должны быть не тронуты newsyslog&#39;ом. Ваш newsyslog.conf должен выглядеть следующим образом:</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code>/var/log/database dbadmin: 600 30 * $MLH23 B /var/run/db.pid 2</code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Это крайний случай, в большинстве реальных ситуаций вам следует только собрать имя файла и условие ротации. Всего-то.</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:54:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Краткая помощь по MySQL</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Обнаружил, что те ресурсы, с которыми я сталкивался не дают ту сжатую информацию, которая необходима для повседневного использования. В данной статье приводится синтаксис наиболее используемых команд при каждодневной работе с MySQL. Повторюсь, что всё что написано не является подробным описанием и используется лично мной в повседневной работе.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Синтаксис: чёрным цветом обозначаются конструкции языка, синим - пользовательские данные, квадратные скобки указывают на необязательные элементы. Каждая команда (кроме первой) заканчивается символом точка с запятой</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; USE<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">database</font></code></b><span class="Apple-converted-space">&nbsp;</span>- выбор базы данных (символ точки с запятой в конце не обязателен).</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; CREATE TABLE [IF NOT EXISTS]<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">tbl_name</font><span class="Apple-converted-space">&nbsp;</span>(<font color="0000FF">id</font><span class="Apple-converted-space">&nbsp;</span>INT(11) NOT NULL PRIMARY KEY,<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">name</font><span class="Apple-converted-space">&nbsp;</span>VARCHAR(105),<font color="0000FF">prim</font><span class="Apple-converted-space">&nbsp;</span>CHAR(120),<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">kol</font><span class="Apple-converted-space">&nbsp;</span>INT(11))</code></b><br />- создаёт таблицу с описанием столбцов:<span class="Apple-converted-space">&nbsp;</span><br /><b><code>[IF NOT EXISTS]</code></b><span class="Apple-converted-space">&nbsp;</span>- создать только если не существует<span class="Apple-converted-space">&nbsp;</span><br /><b><code>NOT NULL</code></b><span class="Apple-converted-space">&nbsp;</span>- значение в столбце не может быть пустым (не путать с нулём и пробелом)<span class="Apple-converted-space">&nbsp;</span><br /><b><code>PRIMARY KEY</code></b><span class="Apple-converted-space">&nbsp;</span>- первичный индекс - может быть только один<span class="Apple-converted-space">&nbsp;</span><br />Возможные типы данных:<span class="Apple-converted-space">&nbsp;</span><br />Если указан атрибут<span class="Apple-converted-space">&nbsp;</span><b><code>UNSIGNED</code></b>, отрицательные значения для числовых величин недопустимы.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>TINYINT</code></b><span class="Apple-converted-space">&nbsp;</span>- Очень малое целое число. Диапазон со знаком от -128 до 127. Диапазон без знака от 0 до 255.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>SMALLINT</code></b><span class="Apple-converted-space">&nbsp;</span>- Малое целое число. Диапазон со знаком от -32768 до 32767. Диапазон без знака от 0 до 65535.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>MEDIUMINT</code></b><span class="Apple-converted-space">&nbsp;</span>- Целое число среднего размера. Диапазон со знаком от -8388608 до 8388607. Диапазон без знака от 0 до 16777215.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>INT</code></b><span class="Apple-converted-space">&nbsp;</span>- Целое число нормального размера. Диапазон со знаком от -2147483648 до 2147483647. Диапазон без знака от 0 до 4294967295.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>BIGINT</code></b><span class="Apple-converted-space">&nbsp;</span>- Большое целое число. Диапазон со знаком от -9223372036854775808 до 9223372036854775807. Диапазон без знака от 0 до 18446744073709551615.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>FLOAT[(M,D)]</code></b><span class="Apple-converted-space">&nbsp;</span>- Малое число с плавающей точкой обычной точности. Атрибут M указывает количество выводимых пользователю знаков, а атрибут D - количество разрядов, следующих за десятичной точкой.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>DOUBLE[(M,D)]</code></b><span class="Apple-converted-space">&nbsp;</span>- Число с плавающей точкой удвоенной точности нормального размера.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>DATE</code></b><span class="Apple-converted-space">&nbsp;</span>- Дата. Поддерживается интервал от &#39;1000-01-01&#39; до &#39;9999-12-31&#39;. MySQL выводит значения DATE в формате &#39;YYYY-MM-DD&#39;.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>DATETIME</code></b><span class="Apple-converted-space">&nbsp;</span>- Комбинация даты и времени. Поддерживается интервал от &#39;1000-01-01 00:00:00&#39; до &#39;9999-12-31 23:59:59&#39;. MySQL выводит значения DATETIME в формате &#39;YYYY-MM-DD HH:MM:SS&#39;.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>TIME</code></b><span class="Apple-converted-space">&nbsp;</span>- Время. Интервал от &#39;-838:59:59&#39; до &#39;838:59:59&#39;. MySQL выводит значения TIME в формате &#39;HH:MM:SS&#39;.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>YEAR[(2|4)]</code></b><span class="Apple-converted-space">&nbsp;</span>- Год в двухзначном или четырехзначном форматах (по умолчанию формат четырехзначный). Допустимы следующие значения: с 1901 по 2155, 0000 для четырехзначного формата года и 1970-2069 при использовании двухзначного формата (70-69).<span class="Apple-converted-space">&nbsp;</span><br /><b><code>CHAR(M) [BINARY]</code></b><span class="Apple-converted-space">&nbsp;</span>- Строка фиксированной длины. Диапазон аргумента M составляет от 0 до 255 символов. Если не задан атрибут чувствительности к регистру BINARY, то величины CHAR сортируются и сравниваются как независимые от регистра в соответствии с установленным по умолчанию алфавитом.<span class="Apple-converted-space">&nbsp;</span><br /><b><code>VARCHAR(M) [BINARY]</code></b><span class="Apple-converted-space">&nbsp;</span>- Строка переменной длины. Диапазон аргумента M составляет от 0 до 255 символов (от 1 до 255 в версиях, предшествующих MySQL Version 4.0.2). Если не задан атрибут чувствительности к регистру BINARY, то величины VARCHAR сортируются и сравниваются как независимые от регистра.<span class="Apple-converted-space">&nbsp;</span><br />Если нужны текстовые столбцы большей длины смотрите тут -<span class="Apple-converted-space">&nbsp;</span><a href="http://www.mysql.ru/docs/man/BLOB.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">Справочное руководство по MySQL</a></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; DESCRIBE<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">tbl_name</font></code></b><span class="Apple-converted-space">&nbsp;</span>- просмотр информации о столбцах таблицы.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; DROP TABLE [IF EXISTS]<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">tbl_name</font></code></b><span class="Apple-converted-space">&nbsp;</span>- уничтожить таблицу.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; DELETE FROM<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">tbl_name</font><span class="Apple-converted-space">&nbsp;</span>[WHERE where_definition]</code></b><span class="Apple-converted-space">&nbsp;</span>- удаление строк таблицы.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; DESCRIBE<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">tbl_name</font></code></b><span class="Apple-converted-space">&nbsp;</span>- просмотр информации о столбцах таблицы.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; INSERT [INTO]<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">tbl_name</font><span class="Apple-converted-space">&nbsp;</span>[(col_name,...)] SELECT ...</code></b><span class="Apple-converted-space">&nbsp;</span>- заполнение одной таблицы информацией из другой.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; mysqladmin processlist</code></b><span class="Apple-converted-space">&nbsp;</span>- если процесс mysqld заполняет 80% времени процессора, то можно узнать какие запросы (каких пользователей) загружают систему.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><br />Смена пароля root и создание пользователей с правами рута после установки:</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code># mysql</code></b><span class="Apple-converted-space">&nbsp;</span>- произойдёт запуск mysql под root без пароля. Чтобы исчключить возможность входа без пароля - проделываем слудующие команды:</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; USE mysql</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; UPDATE user SET Password=PASSWORD(&#39;<font color="0000FF">новый пароль</font>&#39;) WHERE User=&#39;root&#39;;</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; FLUSH PRIVILEGES;<span class="Apple-converted-space">&nbsp;</span></code></b>- это можно в конце один раз для применения изменений.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">имя_пользователя</font><span class="Apple-converted-space">&nbsp;</span>IDENTIFIED BY &#39;<font color="0000FF">пароль</font>&#39; WITH GRANT OPTION;</code></b><span class="Apple-converted-space">&nbsp;</span>- просмотр информации о столбцах таблицы.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO<span class="Apple-converted-space">&nbsp;</span><font color="0000FF">имя_пользователя</font>@localhost IDENTIFIED BY &#39;<font color="0000FF">пароль</font>&#39; WITH GRANT OPTION;</code></b><span class="Apple-converted-space">&nbsp;</span>- просмотр информации о столбцах таблицы.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b><code>mysql&gt; FLUSH PRIVILEGES;</code></b></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Раздел не закончен. Дополню когда появится время</p>
												<p>
												   
												   <strong>Tags:</strong> 
													mysql <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<table cellspacing="0" cellpadding="0" border="0">
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="entryHolderBg" width="100%"><b>Comments</b>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					</div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
						alt="" border="0" /></div>

					<a name="t5"></a>
					<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table1">
						<tr>
							<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="0" height="1"></td>
							<td width="100%">
								<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table2">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div style="background-color: #84b5d2; color: #232f6d; margin-top: 10px;">
												<table cellpadding="2" cellspacing="0" summary="0" width="100%" bgcolor="#a7c7e8" ID="Table3">
													<tr valign="top">
														<td rowspan="2" align="center"></td>
														<td align="left" style="white-space: nowrap"><strong>From:</strong>

															<span class='ljuser' style='white-space:nowrap;'>
																<a href='http://www.livejournal.com/userinfo.bml?user=ext_2622485'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
																		style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/ext_2622485/'><b>ext_2622485</b></a></span>


														</td>
														<td align="left" style="white-space: nowrap"><strong>Date:</strong> 06/17/2014 09:03:02</td>
														<td style='text-align: center;'>
														<td align="right">&nbsp;</strong></td>
													</tr>
													<tr valign="top">
														<td colspan="7" style="width: 95%"><p class="subject"> </p></td>
													</tr>
												</table>
											</div>
											<div style="margin-left: 5px" style="color: #000000">Согласен.
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<table cellspacing="0" cellpadding="0" border="0">
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="entryHolderBg" width="100%"><b> Comments</b>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:54:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Обновление PERL и добавление новых модулей c помощью CPAN</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Немного воды :) Кому не интересно - пропускаем :)<span class="Apple-converted-space">&nbsp;</span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Почему<span class="Apple-converted-space">&nbsp;</span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">PERL</b><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">? - это поставляемый с любой<span class="Apple-converted-space">&nbsp;</span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">UNIX</b><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; "><span class="Apple-converted-space">&nbsp;</span>системой по умолчанию язык програмирования, этому языку программирования 16 лет - в компьютерном мире это срок :), великое множество модулей, написанных для perl охватывает подавляющее большинство задач, решаемых путем программирования.<span class="Apple-converted-space">&nbsp;</span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); " /><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Для примера могу сказать, что для парсинга<span class="Apple-converted-space">&nbsp;</span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">XLS</b><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; "><span class="Apple-converted-space">&nbsp;</span>файлов в<span class="Apple-converted-space">&nbsp;</span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">PHP</b><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; "><span class="Apple-converted-space">&nbsp;</span>приходится делать обходной крюк влияющий на скорость работы скрипта - а для<span class="Apple-converted-space">&nbsp;</span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">PERL</b><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; "><span class="Apple-converted-space">&nbsp;</span>существует чудесная библиотека<span class="Apple-converted-space">&nbsp;</span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Spreadsheet::ParseExcel</b><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; "><span class="Apple-converted-space">&nbsp;</span>:)</span><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Вообщем я немного покривил душей написав в заголовке<span class="Apple-converted-space">&nbsp;</span><b>Установка - обновлени perl</b>. Собственно ничего сложного в этой процедуре нет. Просто при поиске в google<span class="Apple-converted-space">&nbsp;</span><b>&quot;Обновление perl&quot;</b><span class="Apple-converted-space">&nbsp;</span>нет ни чего дельного. И возникло желание восполнить этот пробел для тех кто запарится как я по невнимательности.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Вообщем то нет никаких проблем в установке новой версии<span class="Apple-converted-space">&nbsp;</span><b>PERL</b><span class="Apple-converted-space">&nbsp;</span>поверх старой. Надо просто соглашатся со всеми вопросами по умолчанию. Есть одно<span class="Apple-converted-space">&nbsp;</span><b>НО</b><span class="Apple-converted-space">&nbsp;</span>- по умолчанию перл не предлагает перезаписывать исполняемый файл<span class="Apple-converted-space">&nbsp;</span><b>/usr/bin/perl</b><span class="Apple-converted-space">&nbsp;</span>а помещает новую версию в<span class="Apple-converted-space">&nbsp;</span><b>/usr/local/bin/perl</b><span class="Apple-converted-space">&nbsp;</span>- это не очень удобно если вы привыкли работать со стандартным<span class="Apple-converted-space">&nbsp;</span><b>#!/usr/bin/perl</b><span class="Apple-converted-space">&nbsp;</span>или просто<span class="Apple-converted-space">&nbsp;</span><b>perl</b><span class="Apple-converted-space">&nbsp;</span>из командной строки.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><b>CPAN</b><span class="Apple-converted-space">&nbsp;</span>- Comprehensive Perl Archive Network (Всеобъемлющая Сеть Архивов Perl) -<span class="Apple-converted-space">&nbsp;</span><a href="http://www.perl.com/CPAN/CPAN.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">http://www.perl.com/CPAN/CPAN.html</a>.<span class="Apple-converted-space">&nbsp;</span><br />Чем она хороша? Допустим мы на свежепоставленной системе создали скрипт с<span class="Apple-converted-space">&nbsp;</span><b>use Spreadsheet::ParseExcel;</b><span class="Apple-converted-space">&nbsp;</span>при запуске скрипта мы почти наверняка получим примерно такое сообщение:<span class="Apple-converted-space">&nbsp;</span><br /><code><b>Can&#39;t locate Spreadsheet/ParseExcel.pm in @INC (@INC contains:<span class="Apple-converted-space">&nbsp;</span><br />/usr/local/lib/perl5/site_perl/5.6.1/mach /usr/local/lib/perl5/site_perl/5.6.1<span class="Apple-converted-space">&nbsp;</span><br />/usr/local/lib/perl5/site_perl /usr/local/lib/perl5/5.6.1/BSDPAN /usr/local/lib/perl5/5.6.1/mach<span class="Apple-converted-space">&nbsp;</span><br />/usr/local/lib/perl5/5.6.1 .) at mail1.pl line 3.<span class="Apple-converted-space">&nbsp;</span><br />BEGIN failed--compilation aborted at my_script.pl line 3.</b></code><span class="Apple-converted-space">&nbsp;</span><br />Это значит, что данная библиотека в нашей системе не установлена. Можно конечно воспользоватся ручным способом добавления ее в систему, но куда более разумно доверить всю грязную работу библиотеке<span class="Apple-converted-space">&nbsp;</span><b>Bundle::CPAN</b>.<span class="Apple-converted-space">&nbsp;</span><br />Запуск оболочки CPAN в perl осуществляется:</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b># perl -MCPAN -e shell</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">При первом запуске необходимо ответить на ряд вопросов, касаемых настройки файла<span class="Apple-converted-space">&nbsp;</span><b>Config.pm</b>. Рекомендую записать местоположение этого файла и местоположение базы, в которой<span class="Apple-converted-space">&nbsp;</span><b>CPAN</b><span class="Apple-converted-space">&nbsp;</span>будет хранить рабочие файлы. В остальном можно соглашатся с умолчанием. в дальнейшем возможно появится желание заменить сервер, с которого происходит закачка.<span class="Apple-converted-space">&nbsp;</span><br />По окончанию настройки вы должны получить приглашение вида</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b><u>cpan&gt;</u></b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">теперь можно решить проблему, возникшую в начале разговора:</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b><u>cpan&gt;</u><span class="Apple-converted-space">&nbsp;</span>install Spreadsheet::ParseExcel</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">причем CPAN сам разберется какие дополнительные библиотеки необходимы для работы данного модуля. Не правда ли - хорошая примочка?</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Еще одна полезная вещь - автоматическое обновление модулей - по желанию можно добавить в cron.</p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><code><b>perl -MCPAN -e &#39;CPAN::Shell-&gt;install(CPAN::Shell-&gt;r)&#39;</b></code></p><p style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">На этом повествование о CPAN и perl upgrade закончено. Для интересующихся можно почитать хорошую статью на<span class="Apple-converted-space">&nbsp;</span><a href="http://www.providerz.ru/articles/perl/cpan-modules-install.html" style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt; color: teal; ">http://www.providerz.ru/articles/perl/cpan-modules-install.html</a>.</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<table cellspacing="0" cellpadding="0" border="0">
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="entryHolderBg" width="100%"><b>Comments</b>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					</div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
						alt="" border="0" /></div>

					<a name="t4"></a>
					<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table1">
						<tr>
							<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="0" height="1"></td>
							<td width="100%">
								<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table2">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div style="background-color: #84b5d2; color: #232f6d; margin-top: 10px;">
												<table cellpadding="2" cellspacing="0" summary="0" width="100%" bgcolor="#a7c7e8" ID="Table3">
													<tr valign="top">
														<td rowspan="2" align="center"></td>
														<td align="left" style="white-space: nowrap"><strong>From:</strong>

															<span class='ljuser' style='white-space:nowrap;'>
																<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
																		style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>


														</td>
														<td align="left" style="white-space: nowrap"><strong>Date:</strong> 11/30/2012 18:50:53</td>
														<td style='text-align: center;'>
														<td align="right">&nbsp;</strong></td>
													</tr>
													<tr valign="top">
														<td colspan="7" style="width: 95%"><p class="subject"> </p></td>
													</tr>
												</table>
											</div>
											<div style="margin-left: 5px" style="color: #000000">Упрощеный вариант<br />
<br />
# cpan<br />
<br />
# cpan -i SOAP::Lite
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<table cellspacing="0" cellpadding="0" border="0">
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="entryHolderBg" width="100%"><b> Comments</b>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:55:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Скрипт на PERL для сохранения вложений входящей почты.</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Ниже приведен скрипт, задача которого состоит в сохранении прикрепленных к входящей почте <br />файлов и доступа к этим файлам пользователей WIndows. Причем новые версии файлов заменяют <br />старые. <br /><br />Применение - можно просить поставщиков отправлять свои прайс-листы на один ящик, главное, <br />чтобы имена файлов не пересекались, инче они будут заменены или получится каша.    <br /><br />ВНИМАНИЕ! ПУБЛИКАЦИЯ И ИСПОЛЬЗОВАНИЕ В КОММЕРЧЕСКИХ ЦЕЛЯХ ДАННОГО СКРИПТА РАЗРЕШАЕТСЯ ТОЛЬКО <br />С СОГЛАСИЯ АВТОРА! Использование в личных целях безвозмездно - тоесть даром :) <br /><br />#!/usr/bin/perl -w<br />use strict;<br /># Библиотека для коннекта с сервером POP3<br />use Net::POP3;<br /># С ее помошью получаем во временный каталог готовые вложения<br />use MIME::Parser;<br /># декодируем кашу типа =?Windows-1251?B? =?koi8-r?B? в читаемый вид<br />use MIME::Words qw(:all);<br /># декодируем непонятные для MIME::Parser заголовки. <br />use Convert::Cyrillic;<br /><br /># Здесь ИП почтовика, логин ящика, пароль, <br />my $server_name = &quot;192.168.0.1&quot;;<br />my $pop3 = Net::POP3-&gt;new($server_name, Timeout =&gt; 60) || <br />    &amp;errexit(&quot;Невозможно соединица с почтовым сервером&quot;);<br />my $user_name = &quot;svalka&quot;;<br />my $user_pass = &quot;Сюда свой пароль к ящику&quot;;<br />$pop3-&gt;login($user_name, $user_pass) or &amp;errexit(&quot;Ошибка авторизации&quot;);<br />my $pars = new MIME::Parser;<br /><br /># Создаем временную папку для парсинга вложений<br />system(&#39;mkdir /tmp/info.temp&#39;);<br /># И обьявляем ее в обьекте<br />$pars-&gt;output_dir(&quot;/tmp/info.temp&quot;);<br />my $msgs = $pop3-&gt;list;<br />foreach (keys %$msgs){<br /> # Получаем в массив @mail очередное письмо<br /> my @mail=$pop3-&gt;get($_);<br /> # Массив @mail двумерный, по этому соответствующий цикл перебора элементов<br /> # для замены проблемных кодировок<br /> # если закоментировать цикл, то рано или позно вы получите сообщение такого вида<br /> #ignoring text in character set `KOI8-R&#39;<br />    #at /usr/local/lib/perl5/site_perl/5.6.1/MIME/Parser/Filer.pm line 646<br />    #ignoring text in character set `WINDOWS-1251&#39;<br />    #at /usr/local/lib/perl5/site_perl/5.6.1/MIME/Parser/Filer.pm line 646<br /> # У меня так. Если кто то нашел другой способ пишите - буду рад<br />    for my $lin (0..$#mail) {<br />  for my $col (0..$#{$mail[$lin]}) {<br />   if ($mail[$lin][$col]=~ m/=\?koi8-r\?/i) {<br />    $mail[$lin][$col]=decode_mimewords($mail[$lin][$col]);<br />    $mail[$lin][$col] = Convert::Cyrillic::cstocs(&#39;koi8&#39;,&#39;dos&#39;,$mail[$lin][$col]);<br />   }<br />   if ($mail[$lin][$col]=~ m/=\?windows-1251\?/i) {<br />    $mail[$lin][$col]=decode_mimewords($mail[$lin][$col]);<br />    $mail[$lin][$col] = Convert::Cyrillic::cstocs(&#39;win&#39;,&#39;dos&#39;,$mail[$lin][$col]);<br />   }<br /><br />  }<br /> }<br /> # Натравливаем парсинг на очередное письмо<br /> my $entity=$pars-&gt;parse_data(@mail);<br />}<br /># Список ненужных файлов с расширениями можно продолжить и оставить только например xls<br /># Тут наверно целесообразнее применять unlink, но я сделал так :) <br />system(&#39;rm /tmp/info.temp/*.txt&#39;);<br />system(&#39;rm /tmp/info.temp/*.html&#39;);<br /># теперь в папочке Самбы для Windows клиентов лежат всегда свежые файлы - только не забываем про cron :)<br />system(&#39;cp /tmp/info.temp/* /samba/mail/svalka/&#39;);<br /># Временная папка нам уже не нужна.<br />system(&#39;rm -R /tmp/info.temp&#39;);</pre>
												<p>
												   
												   <strong>Tags:</strong> 
													perl <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/11/2012 12:55:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Скрипт на PERL для разбора писем в момент поступления в почтовый ящик</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<span style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none; ">Пока свежо в памяти напишу решение вопроса обработки почтовых ящиков &quot;налету&quot;. Поясню - получать доступ к ящику по расписанию - это конечно хорошо, но если вы админ сервака или особа приближенная к последнему, то почему бы не обрабатывать сообщения приходящие на почту в момент их приема? Ответ верный - это не только можно, но и нужно! Выигрыш в производительности и экономии ресурсов сервера очевиден.</span><h4 style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); ">Чтож. Разделим процесс на 3 этапа.</h4><lu style="color: rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); "><li>Настройка почтового ящика на перенаправление поступающей почты скрипту.</li><li>Собственно сам скрипт.</li><li>Обработка возможных ошибок в скрипте и направление их в журнал.<h3>Настройка почтового ящика на перенаправление поступающей почты скрипту.</h3>Возможно 2 варианта:</li><li>Посредством<span class="Apple-converted-space">&nbsp;</span><b>aliases</b><span class="Apple-converted-space">&nbsp;</span><br />
Добавляем в<span class="Apple-converted-space">&nbsp;</span><b>/etc/mail/aliases</b><span class="Apple-converted-space">&nbsp;</span>строчку, которая указывает почтовому серверу, что почту поступающую на адрес<span class="Apple-converted-space">&nbsp;</span><b>mymail@mydomain.ru</b><span class="Apple-converted-space">&nbsp;</span>нужно перенаправлять в программу и копию в<span class="Apple-converted-space">&nbsp;</span><b>mymail@mydomain.ru</b><span class="Apple-converted-space">&nbsp;</span><br />
<code><b>mymail: &quot;|/usr/script/myscript.pl&quot;, mymail</b></code><span class="Apple-converted-space">&nbsp;</span><br />
Перестраиваем базу псевдонимов<span class="Apple-converted-space">&nbsp;</span><br />
<code><b># makemap hash /etc/mail/aliases.db &lt; /etc/mail/aliases ; newaliases</b></code></li><li>Второй вариант - использовать /home/mymail/.<b>forward</b><span class="Apple-converted-space">&nbsp;</span>- синтаксис аналогичный, разберетесь.<p>Выставляем владельца и права на скрипт:<span class="Apple-converted-space">&nbsp;</span><br />
Скрипт запускается от имени пользователя ящика<span class="Apple-converted-space">&nbsp;</span><br />
<br />
<code><b># chown mymail:wheel /usr/script/myscript.pl<span class="Apple-converted-space">&nbsp;</span><br />
# chmod 700 /usr/script/myscript.pl</b></code><span class="Apple-converted-space">&nbsp;</span><br />
Создаем пустой файл для ведения логов (ошибки скрипта)<span class="Apple-converted-space">&nbsp;</span><br />
<br />
<code><b># echo &gt; /var/log/scripts<span class="Apple-converted-space">&nbsp;</span><br />
# chown mymail:wheel /var/log/scripts<span class="Apple-converted-space">&nbsp;</span><br />
# chmod 600 /var/log/scripts</b></code></p><h3>Собственно сам скрипт и Обработка возможных ошибок в скрипте и направление их в журнал</h3><pre><b>#!/usr/bin/perl</b><br />
<br />
<b>use strict;</b><br />
# Глушим сообщения об ошибках. Если этого не сделать - любая не синтаксическая ошибка будет <br />
# возвращатся отправителю письма - согласитесь - какая тут может быть безопасность...  <br />
<b>open(STDERR,&#39;&gt;/dev/null&#39;);</b><br />
# Сообщаем системе как реагировать на ошибки в программе. Тут все просто - сначала открываем<br />
# лог на запись, отправляем туда ошибку, закрываем лог и вываливаемся из скрипта.<br />
# Если не задать последний exit, скрипт завершится с ошибкой и отправитель письма получит <br />
# ответное письмо с сообщением о неизвесной ошибке &quot;мылера&quot;<br />
<b>$SIG{__WARN__}=sub { open(F, &#39;&gt;&gt;/var/log/scripts&#39;); print F shift; close F; exit; };<br />
$SIG{__DIE__}=sub { open(F, &#39;&gt;&gt;/var/log/scripts&#39;); print F shift; close F; exit; };</b><br />
<br />
# Обьявляем парсер, с помощью которого будем разбирать письмо на куски<br />
<b>use MIME::Parser;</b><br />
# Эта библиотека поможет вам, если парсер столкнется с koi-8 и windows-1251<br />
<b>use Convert::Cyrillic;</b><br />
# Будем использовать функции decode_mimewords<br />
<b>use MIME::Words qw(:all);</b><br />
# Обьявляем новый парсер<br />
<b>my $pars = new MIME::Parser;</b><br />
# Создаем временный каталог для парсера<br />
<b>mkdir(&#39;/tmp/work.mymail&#39;,0700);</b><br />
<b>$pars-&gt;output_dir(&#39;/tmp/work.mymail&#39;);<br />
my ($mail,$ent);</b><br />
# Читаем письмо из входного потока<br />
<b>my @mail=<stdin>;</stdin></b><br />
# Устанавливаем признак письма которое нам нужно<br />
<b>my $pismo_postavshik=0;</b><br />
# Цикл по письму<br />
<b>for my $lin (0..$#mail) {</b><br />
 # Если в письме встречаются koi-8 кодированные заголовки - парсер будет ругатся - <br />
 # декодируем и меняем на windows-1251<br />
 <b>if ($mail[$lin]=~m/=\?koi8-r\?/i) {<br />
  $mail[$lin]=decode_mimewords($mail[$lin]);<br />
  $mail[$lin] = Convert::Cyrillic::cstocs (&#39;koi8&#39;, &#39;win&#39;, $mail[$lin]);<br />
 }</b><br />
 # Если windows-1251 - только декодируем<br />
 <b>if ($mail[$lin]=~m/=\?windows-1251\?/i) {<br />
  $mail[$lin]=decode_mimewords($mail[$lin]);<br />
 }<br />
 if ($mail[$lin]=~m%Этот текст должен присутствовать в письме поставщика%i) {<br />
  $pismo_postavshik=1;<br />
 }<br />
 <br />
}</b><br />
# Если в письме не встретилась ключевая строка - это письмо нас не интересует - <br />
# вываливаемся <br />
<b>if ($pismo_postavshik==0) {<br />
 exit;<br />
}</b><br />
# Метод parse_data работает по ссылке - создаем. <br />
<b>my @mile=\@mail;</b><br />
<b>$ent = $pars-&gt;parse_data(@mile);</b><br />
</pre><p>Резюме - по окончанию работы в папке<span class="Apple-converted-space">&nbsp;</span><b>/tmp/work.mymail</b><span class="Apple-converted-space">&nbsp;</span>имеем разобранное по кускам письмо. Что делать с ним дальше - ваше дело.</p><p>Напоследок совет - если используете промежуточный каталог из которого потом происходит копирование - желательно задествовать<span class="Apple-converted-space">&nbsp;</span><b>File::Temp qw/ tempdir /</b><span class="Apple-converted-space">&nbsp;</span>примерно в таком контексте<span class="Apple-converted-space">&nbsp;</span><br />
<b>use File::Temp qw/ tempdir /;<span class="Apple-converted-space">&nbsp;</span><br />
my $dirr_nam = tempdir(CLEANUP =&gt; 1);</b><span class="Apple-converted-space">&nbsp;</span><br />
В переменную получаем скаляр что то типа<span class="Apple-converted-space">&nbsp;</span><b>/tmp/5f4tgfdv</b>. Данный каталог после выполнения метода<span class="Apple-converted-space">&nbsp;</span><b>tempdir</b><span class="Apple-converted-space">&nbsp;</span>создан. А по окончании работы скрипта каталог будет удален. Тогда скрипт работающий паралельно не вызовет ошибку, а такое возможно при одновремменом приходе нескольких писем.</p></li></lu>
												<p>
												   
												   <strong>Tags:</strong> 
													perl <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/15/2012 17:26:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        MySQL 5.5 и UTF-8</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<b>my.cnf&nbsp;</b><br />
<br />
[mysqld]<br />
skip-character-set-client-handshake<br />
collation_server=utf8_unicode_ci<br />
character_set_server=utf8
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<table cellspacing="0" cellpadding="0" border="0">
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="entryHolderBg" width="100%"><b>Comments</b>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					</div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
						alt="" border="0" /></div>

					<a name="t1"></a>
					<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table1">
						<tr>
							<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="0" height="1"></td>
							<td width="100%">
								<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table2">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div style="background-color: #84b5d2; color: #232f6d; margin-top: 10px;">
												<table cellpadding="2" cellspacing="0" summary="0" width="100%" bgcolor="#a7c7e8" ID="Table3">
													<tr valign="top">
														<td rowspan="2" align="center"></td>
														<td align="left" style="white-space: nowrap"><strong>From:</strong>

															<span class='ljuser' style='white-space:nowrap;'>
																<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
																		style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>


														</td>
														<td align="left" style="white-space: nowrap"><strong>Date:</strong> 10/15/2012 16:32:51</td>
														<td style='text-align: center;'>
														<td align="right">&nbsp;</strong></td>
													</tr>
													<tr valign="top">
														<td colspan="7" style="width: 95%"><p class="subject"> </p></td>
													</tr>
												</table>
											</div>
											<div style="margin-left: 5px" style="color: #000000">mysql> show variables like 'char%';
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<a name="t2"></a>
					<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table1">
						<tr>
							<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="25" height="1"></td>
							<td width="100%">
								<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table2">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div style="background-color: #84b5d2; color: #232f6d; margin-top: 10px;">
												<table cellpadding="2" cellspacing="0" summary="0" width="100%" bgcolor="#a7c7e8" ID="Table3">
													<tr valign="top">
														<td rowspan="2" align="center"></td>
														<td align="left" style="white-space: nowrap"><strong>From:</strong>

															<span class='ljuser' style='white-space:nowrap;'>
																<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
																		style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>


														</td>
														<td align="left" style="white-space: nowrap"><strong>Date:</strong> 10/15/2012 16:33:25</td>
														<td style='text-align: center;'>
														<td align="right">&nbsp;</strong></td>
													</tr>
													<tr valign="top">
														<td colspan="7" style="width: 95%"><p class="subject"> </p></td>
													</tr>
												</table>
											</div>
											<div style="margin-left: 5px" style="color: #000000">[mysqld]<br />
character-set-server=utf8<br />
character-set-client=utf8<br />
init-connect='SET NAMES utf8'
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<a name="t3"></a>
					<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table1">
						<tr>
							<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="50" height="1"></td>
							<td width="100%">
								<table cellspacing="0" cellpadding="0" border="0" width="100%" ID="Table2">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div style="background-color: #84b5d2; color: #232f6d; margin-top: 10px;">
												<table cellpadding="2" cellspacing="0" summary="0" width="100%" bgcolor="#a7c7e8" ID="Table3">
													<tr valign="top">
														<td rowspan="2" align="center"></td>
														<td align="left" style="white-space: nowrap"><strong>From:</strong>

															<span class='ljuser' style='white-space:nowrap;'>
																<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
																		style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>


														</td>
														<td align="left" style="white-space: nowrap"><strong>Date:</strong> 10/15/2012 16:34:32</td>
														<td style='text-align: center;'>
														<td align="right">&nbsp;</strong></td>
													</tr>
													<tr valign="top">
														<td colspan="7" style="width: 95%"><p class="subject"> </p></td>
													</tr>
												</table>
											</div>
											<div style="margin-left: 5px" style="color: #000000">http://phpclub.ru/talk/threads/utf-8-в-консоли-mysql-сервера.67596/<br />

											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<table cellspacing="0" cellpadding="0" border="0">
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="entryHolderBg" width="100%"><b> Comments</b>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="3" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/16/2012 13:11:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Нагрузка на систему FreeBSD</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												Просмотр загрузки многоядерных систем в разрезе каждого ядра:<br />
<br />
<b>top -CHP</b><br />
<br />
для того чтобы по умолчанию срабатывали ключи&nbsp;<br />
добавляем в&nbsp;<b>.cshrc</b><br />
<i>setenv TOP -CHP</i><br />
<br />
Посмотреть нагрузку на диски:<br />
<b>gstat</b>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									12/12/2012 09:55:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        свежие мысли</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												копирование больших файлов с сжатием между юникс машинами:<br />
<br />
<b> scp -r -C -P 23 /download/work/* user@192.168.0.28:/arhive/arc</b><br />
<br />
где r - с подкаталогами С - включить сжатие на лету, -P указать конкретный порт<br />
<br />
<br />
просмотр открытых портов:<br />
<br />
<b>netstat -na | grep LISTEN</b>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/05/2015 11:48:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        База данных NEW</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												Назрел момент систематизировать переход на новый сервер базы данных.<br />
<br />
Были изучены и оттестированы механизмы snapshot UFS FreeBSD<br />
Для новой базы решено использовать репликацию на основе механизмов mysql<br />
<br />
Основа FreeBSD 10.2<br />
Рейд на основе:<br />
Adaptec RAID Controller ASR-6805E<br />
Рейд 0 на двух SCSI винтах по 250Gb Seagate ST3300657SS<br />
<br />
Установка программ из портов.<br />
<pre class="screen"><br />
<strong class="userinput"><code>portsnap fetch<br />
<strong class="userinput"><code><strong class="userinput"><code>portsnap extract</code></strong></code></strong><br />
<br />
</code></strong></pre>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/05/2015 11:48:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Создание резервной компии MySQL посредством мгновенных снимков</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<pre class="screen"><br />
<strong class="userinput"><code>Ключевые слова для поиска в интернет:<br />
<br />
snapshot UFS MySQL FreeBSD<br />
<br />
http://lagman.su/2010/01/freebsd-snapshot<br />
http://www.truestep.com/free_code/BSD/mysql_ufs_snapshot<br />
<br />
Список активных снапшотов по разделам:<br />
snapshot list /dbase<br />
<br />
Создать снапшот раздела dbase с названием snap_file<br />
snapshot make -g4 /dbase:snap_file<br />
<br />
Смонтировать снапшот раздела dbase с названием snap_file.0 в раздел /mnt<br />
snapshot mount /dbase:snap_file.0 /mnt<br />
<br />
Размонтировать снапшот<br />
snapshot umount /mnt<br />
<br />
Удалить все снапшоты с именем snap_file<br />
snapshot make -g0 /dbase:snap_file<br />
<br />
<br />
<br />
<br />
Скрипт для автоматического монтирования снапшота MySQL с остановкой таблиц на момент снимка:<br />
mysql_ufs_snapshot.sh<br />
</code></strong><br />
</pre><br />
<br />
<br />
<pre class="screen"><br />
<strong class="userinput"><code>#!/bin/sh<br />
# Copyright (c) 2007 TrueStep<br />
# Name: mysql_ufs_snapshot.sh<br />
# Author: Rory Arms - http://www.TrueStep.com/<br />
# CDate: 2007-11-17<br />
# Description:<br />
# 1. Unmounts and deletes old snapshot if found.<br />
# 2. The mysql(1) monitor is used to flush &amp; lock the database<br />
# 3. Using MySQL&#39;s SYSTEM(), to generate new snapshot using mksnap_ffs(8)<br />
# 4. Mount resulting snapshot read-only to make it available for backup<br />
#<br />
# Installation:<br />
# 1. Make sure SNAP_MOUNT (see user knobs) directory exists.<br />
# 2. Put this file in a local path, /usr/local/sbin probably.<br />
# 3. Add a crontab(5) entry to execute this script as as often as desired.<br />
# Example crontab entry for daily execution at 2:30:<br />
# 30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; /usr/local/sbin/mysql_ufs_snapshot.sh 1&gt;/dev/null<br />
#<br />
# Tested with: FreeBSD 6.1, 6.2<br />
# Deps: mksnap_ffs(8), mount(8), mdconfig(8), mysql(1), rm(1), awk(1)<br />
# $Id: mysql_ufs_snapshot.sh,v 1.1.1.1 2007/11/26 21:35:12 rorya Exp $<br />
<br />
# user knobs<br />
SNAP_MOUNT=&quot;/snapshot/mysql&quot;&nbsp;&nbsp; &nbsp;# where to mount read-only snapshot<br />
MYSQL_ROOT=&quot;/dbase/mysql&quot; # mysql root directory, where the data lives<br />
MYSQL_PASSWORD=&quot;&quot; # mysql password for the root user<br />
<br />
<br />
AUTHOR=&quot;TrueStep&quot;<br />
NAME=&quot;mysql_ufs_snapshot&quot;<br />
VERSION=&quot;2&quot;<br />
SNAP_NAME=&quot;mysql_snap&quot; # only change if you want a different snapshot filename<br />
PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin<br />
<br />
print() {<br />
&nbsp;&nbsp; &nbsp;echo &quot;-&gt; $*&quot;<br />
}<br />
<br />
print_error() {<br />
&nbsp;&nbsp; &nbsp;echo &quot;Error: $*&quot; &gt; /dev/stderr<br />
}<br />
<br />
print_stderr() {<br />
&nbsp;&nbsp; &nbsp;echo &quot;$*&quot; &gt; /dev/stderr<br />
}<br />
<br />
banner() {<br />
&nbsp;&nbsp; &nbsp;print &quot;$NAME v$VERSION starting&quot;<br />
&nbsp;&nbsp; &nbsp;echo<br />
}<br />
<br />
prechecks() {<br />
&nbsp;&nbsp; &nbsp;# Check FreeBSD version<br />
&nbsp;&nbsp; &nbsp;if [ ! $(uname -r | awk -F. &#39;{ print $1 }&#39;) -ge 5 ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;FreeBSD 5 or higher required&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
<br />
&nbsp;&nbsp; &nbsp;# Make sure MySQL is installed<br />
&nbsp;&nbsp; &nbsp;if [ ! -x $(which mysql) ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;mysql(1) monitor not found&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
<br />
&nbsp;&nbsp; &nbsp;# Make sure this is the root user<br />
&nbsp;&nbsp; &nbsp;if [ ! $(id -u) -eq 0 ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;You are not a superuser&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
<br />
&nbsp;&nbsp; &nbsp;# Make sure mount point exists<br />
&nbsp;&nbsp; &nbsp;if [ ! -e $SNAP_MOUNT ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;mount point $SNAP_MOUNT does not exist, exiting&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
<br />
&nbsp;&nbsp; &nbsp;# Resolve partition mount and snapshot location from MYSQL_ROOT<br />
&nbsp;&nbsp; &nbsp;SNAP_FS=&quot;/$(echo $MYSQL_ROOT | awk -F/ &#39;{ print $2 }&#39;)&quot;<br />
&nbsp;&nbsp; &nbsp;SNAP_DIR=&quot;/$(echo $MYSQL_ROOT | awk -F/ &#39;{ print $2 }&#39;)/.snap&quot;<br />
&nbsp;&nbsp; &nbsp;SNAP_PATH=${SNAP_DIR}/${SNAP_NAME}<br />
<br />
&nbsp;&nbsp; &nbsp;# Make sure the .snap directory exists in the target filesystem<br />
&nbsp;&nbsp; &nbsp;if [ ! -d $SNAP_DIR ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;$SNAP_DIR doesn&#39;t exist, are you sure this is a UFS2 partition?&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
}<br />
<br />
delete_oldsnap() {<br />
&nbsp;&nbsp; &nbsp;# Check to see if there is an existing snapshot from the last time<br />
&nbsp;&nbsp; &nbsp;# this was used<br />
&nbsp;&nbsp; &nbsp;if [ -e $SNAP_PATH ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print &quot;Old snapshot found&quot;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# unmount the snapshot<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;umount $SNAP_MOUNT<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# Detach memory disk<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print &quot;Detaching memory disk&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;mdconfig -d -u 4<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# Delete snapshot<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print &quot;Deleting old snapshot&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;rm -f $SNAP_PATH<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;# Check to make sure the memory disk detached successfully<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if [ ! $? = 0 ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;memory disk did not detach, exiting&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;fi<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print &quot;Old snapshot deleted, continuing.. &quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp; &nbsp;fi<br />
}<br />
<br />
create_snap() {<br />
&nbsp;&nbsp; &nbsp;# Check to see if there is a MySQL password<br />
&nbsp;&nbsp; &nbsp;if [ -z $MYSQL_PASSWORD ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;MYSQL_OPTIONS=&quot;&quot;<br />
&nbsp;&nbsp; &nbsp;else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;MYSQL_OPTIONS=&quot;-p$MYSQL_PASSWORD&quot;<br />
&nbsp;&nbsp; &nbsp;fi<br />
&nbsp;&nbsp; &nbsp;# Flush mysql and use SYSTEM() to call mksnap_ffs(8) to create a<br />
&nbsp;&nbsp; &nbsp;# UFS2 snapshot<br />
&nbsp;&nbsp; &nbsp;# This is done because the MySQL read lock is only held while the<br />
&nbsp;&nbsp; &nbsp;# mysql(1) session is open.<br />
&nbsp;&nbsp; &nbsp;print &quot;Launching mysql(1) monitor to lock tables and generate snapshot... &quot;<br />
&nbsp;&nbsp; &nbsp;mysql $MYSQL_OPTIONS &lt;&lt; SQL_MONITOR<br />
FLUSH TABLES WITH READ LOCK;<br />
SYSTEM mksnap_ffs /var &#39;$SNAP_PATH&#39;;<br />
UNLOCK TABLES;<br />
EXIT<br />
SQL_MONITOR<br />
print &quot;done&quot;<br />
<br />
&nbsp;&nbsp; &nbsp;# Check mysql(1) status code<br />
&nbsp;&nbsp; &nbsp;if [ ! $? = 0 ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;mysql(1) failed to create snapshot, exiting&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
}<br />
<br />
mount_snap() {<br />
&nbsp;&nbsp; &nbsp;# Attach snapshot file to a memory disk<br />
&nbsp;&nbsp; &nbsp;print &quot;Attaching snapshot to memory disk&quot;<br />
&nbsp;&nbsp; &nbsp;mdconfig -a -t vnode -o readonly -f $SNAP_PATH -u 4<br />
&nbsp;&nbsp; &nbsp;# Check to make sure the snapshot attached<br />
&nbsp;&nbsp; &nbsp;if [ ! $? = 0 ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;mdconfig(8) failed to attach snapshot $SNAP_PATH, exiting&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
<br />
&nbsp;&nbsp; &nbsp;# Mount memory disk<br />
&nbsp;&nbsp; &nbsp;mount -r /dev/md4 $SNAP_MOUNT<br />
&nbsp;&nbsp; &nbsp;# Check to make sure the mount succeeded<br />
&nbsp;&nbsp; &nbsp;if [ ! $? = 0 ]; then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_error &quot;mount(8) failed to mount snapshot, exiting&quot;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;exit 255<br />
&nbsp;&nbsp; &nbsp;fi<br />
&nbsp;&nbsp; &nbsp;print &quot;Snapshot mounted at $SNAP_MOUNT&quot;<br />
}<br />
<br />
print_usage() {<br />
&nbsp;&nbsp; &nbsp;print_stderr &quot;usage: $NAME [-h]&quot;<br />
&nbsp;&nbsp; &nbsp;print_stderr &quot;Description: Creates UFS2 snapshot of MySQL data directory&quot;<br />
&nbsp;&nbsp; &nbsp;print_stderr &quot;Then mounts the snapshot for further backup operations&quot;<br />
&nbsp;&nbsp; &nbsp;print_stderr &quot;Dependencies:&quot;<br />
&nbsp;&nbsp; &nbsp;print_stderr &quot;Deps: mksnap_ffs(8), mount(8), mdconfig(8), mysql(1), rm(1), awk(1)&quot;<br />
}<br />
<br />
print_version() {<br />
&nbsp;&nbsp; &nbsp;print_stderr &quot;$NAME version $VERSION&quot;<br />
}<br />
<br />
# main<br />
<br />
# print usage if -h is specified<br />
if [ ! -z $1 ]; then<br />
&nbsp;&nbsp; &nbsp;case $1 in<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;-h|--help)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_usage<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;;;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;-v|-V|--version)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;print_version<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;;;<br />
&nbsp;&nbsp; &nbsp;esac<br />
&nbsp;&nbsp; &nbsp;exit 1<br />
fi<br />
<br />
banner<br />
prechecks<br />
delete_oldsnap<br />
create_snap<br />
mount_snap</code></strong></pre><br />
<br />
</lj-spoiler><br />
<pre class="screen"><br />
</pre>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/05/2015 11:53:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Перенос флешкой USB больших файлов</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												Перенос данных на большую флешку:<br />
<br />
mount_msdosfs -L ru_RU.UTF-8 -o large /dev/da0s1 /media/usb/<br />
<br />
Команда split<br />
<br />
$ split -a 1 -d -b 4000M sample.iso sample.iso.part<br />
<br />
$ cat sample.iso.part* &gt; sample.iso
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									10/05/2015 11:58:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        MySQL 5.6</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												При установке но новую ОС MySQL 5.6 в старой базе были обнвружены ошибки на которые ранее mysql не ругалась<br />
<br />
Размер поля не соответствует указанной величине, нет значения по умолчанию и т.п.<br />
<br />
Откат на Mysql 5.5&nbsp; не принёс изменений. Дело оказалось в переменной mysql&nbsp; - sql-mode<br />
Добавил в my.cnf<br />
<br />
[mysqld]<br />
sql-mode=&quot;&quot;
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									12/14/2015 13:19:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        FreeBSD загрузка канала</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												Смотреть загрузку канала<br />
<b>systat -ifstat n<br />
iftop -i vr0</b><br />
Если последнее не работает - установить:<br />
<blockquote><p><strong>cd /usr/ports/net-mgmt/iftop</strong></p><p><strong>make install clean</strong></p><p><strong>rehash</strong></p></blockquote>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									02/07/2018 16:09:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        pkg </div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p>Итак, при первом запуске pkg без параметров вы скорее всего увидите такое сообщение:</p><div class="codecolorer-container text default" style="overflow:auto;white-space:nowrap;"><div class="text codecolorer"><b>The package management tool is not yet installed on your system.<br />
Do you want to fetch and install it now? [y/N]:</b></div></div><p>Отвечаем утвердительно, и ждем, пока pkg установится.</p><p>Затем читаем справку:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg <span class="kw3">help</span></b></div></div><p><br />
Посмотреть справку по конкретной команде можно так:<br />
<b>pkg <span class="kw3">help</span> update</b></p><p>Обновляем информацию о доступных пакетах:<br />
<b>pkg update</b></p><p>Смотрим список установленных пакетов:<br />
<b>pkg info</b></p><p>Обновляем установленные пакеты:<br />
<b>pkg upgrade</b></p><p>Ищем пакет по названию:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg search xorg</b></div></div><p>Установка пакета/пактетов и всех его/их зависимостей:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg <span class="kw2">install</span> xorg<br />
pkg <span class="kw2">install</span> git-lite vim-lite <span class="kw2">sudo</span></b></div></div><p>Удаляем пакет:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg delete xorg</b></div></div><p>Удаляем пакеты, которые больше не нужны:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg autoremove</b></div></div><p>Смотрим, к какому пакету относится файл:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg <span class="kw2">which</span> <span class="sy0">/</span>usr<span class="sy0">/</span>local<span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw2">git</span></b></div></div><p>Посмотреть полный список файлов в пакете можно так:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg info <span class="re5">-l</span> mesa-demos</b></div></div><p>Загружаем базу известных уязвимостей:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg audit <span class="re5">-F</span></b></div></div><p>Проверяем установленные пакеты на предмет наличия известных уязвимостей, с&nbsp;ссылками на подробные отчеты:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg audit</b></div></div><p>Проверяем все установленные пакеты на предмет валидности контрольных сумм входящих в пакеты файлов:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg check <span class="re5">-s</span> <span class="re5">-a</span></b></div></div><p>Проверяем все установленные пакеты на предмет отсутствия требуемых зависимостей:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg check <span class="re5">-d</span> <span class="re5">-a</span></b></div></div><p>Удаляем из кэша старые пакеты:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg clean</b></div></div><p>Смотрим статистику:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg stats</b></div></div><p>Запрещаем/разрешаем обновление конкретного пакета:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg lock syncthing<br />
pkg unlock syncthing</b></div></div><p>Посмотреть список &laquo;залоченых&raquo; пакетов:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b>pkg lock <span class="re5">-l</span></b></div></div><p>Откатиться к более старой версии пакета:</p><div class="codecolorer-container bash default" style="overflow:auto;white-space:nowrap;"><div class="bash codecolorer"><b><span class="kw2">sudo</span> pkg remove chromium<br />
<span class="kw2">sudo</span> pkg <span class="kw2">install</span> <span class="sy0">/</span>var<span class="sy0">/</span>cache<span class="sy0">/</span>pkg<span class="sy0">/</span>chromium-51.0.2704.106_2.txz</b></div></div>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									11/28/2018 10:09:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Архивация, восстановление таблиц mysql</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p><strong>Сохранить</strong></p><br />
<p>mysqldump db_name table_name | gzip &gt; table_name.sql.gz &nbsp;</p><br />
<p><strong>Восстановить</strong></p><br />
<p>gunzip &lt; table_name.sql.gz | mysql -u username -p db_name&nbsp;</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									12/14/2018 10:22:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        FreeBSD 11.2 MySQL UFS snapshot</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p>Определить в MySQL расположение баз данных на отдельном томе.</p><br />
<p>/dbases</p><br />
<p>Для получения мгновенного снимка тома (snapshot) необходимо отключить журналирование файловой системы UFS. Если добавляем новый диск смотрим ниже.</p><br />
<p>Проверяем:</p><br />
<p><strong>mount</strong></p><br />
<p>/dev/ada0p2 on /dbases (ufs, local, journaled soft-updates)</p><br />
<p>Отключить журналирование можно только у размонтированной системы&nbsp;</p><br />
<p><strong>umount /dev/ada0p2</strong></p><br />
<p><strong>tunefs -n disable /filesystem</strong></p><br />
<p><br></p><br />
<p>Попробовать не ставить эту мотьню</p><br />
<p><del><em>Ставим из портов:</em></del></p><br />
<p><del><em><strong>cd /usr/ports/sysutils/freebsd-snapshot</strong></em></del></p><br />
<p><del><em><strong>make install clean</strong></em></del></p><br />
<h2><br></h2><br />
<p>Подготавливаем раздел на новом диске:</p><br />
<p>После каждого действия <strong>gpart show</strong>, чтобы наблюдать за результатом. &nbsp;Последовательность действий:</p><br />
<p>Удалить существующую разметку:<br><strong>gpart destroy -F ada1</strong>&nbsp;</p><br />
<p>Создать новую разметку:<br> <strong>gpart create -s gpt /dev/ada1</strong>&nbsp;</p><br />
<p>Создать два раздела: подкачка (5Гб) и данные:</p><br />
<p><br><strong>gpart add -t freebsd-swap -s 10485760 /dev/ada1</strong></p><br />
<p><strong>gpart add -t freebsd-ufs /dev/ada1</strong>&nbsp;</p><br />
<p>Создать файловую систему <strong>UFSv2</strong> на втором разделе:<br><strong> newfs -U /dev/ada1p2</strong>&nbsp;</p><br />
<p>Отключаем журналирование:</p><br />
<p><strong>tunefs -n disable /dev/ada1p2</strong></p><br />
<p>Добавить в файл /etc/fstab строки для автомонтирования при загрузке:</p><br />
<p><br><strong> /dev/ada1p1 &nbsp;&nbsp;&nbsp;&nbsp;none &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swap &nbsp;&nbsp;&nbsp;&nbsp;sw &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;</strong></p><br />
<p><strong>/dev/ada1p2 &nbsp;&nbsp;&nbsp;&nbsp;/dbases &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ufs &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rw &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;</strong></p><br />
<p>Смонтировать новый раздел (команда монтирует все разделы из файла /etc/fstab):<br><strong> mount -a&nbsp;</strong></p><br />
<p>Включить в работу новый раздел swap командой:<br><strong> swapon /dev/ada1p1</strong></p><br />
<p><br></p><br />
<p>Создадим папку snapshot</p><br />
<p><strong>mkdir /snapshot</strong></p><br />
<p><br></p><br />
<p>mysql_snap — файл снапшота, название может быть любым</p><br />
<p>/snapshot — папка в которую будет смонтирован снапшот.</p><br />
<p>Для создания и монтирования:</p><br />
<p><strong>mksnap_ffs /var /dbases/.snap/mysql_snap</strong></p><br />
<p><strong>mdconfig -a -t vnode -o readonly -f /dbases/.snap/mysql_snap -u 4</strong></p><br />
<p><strong>mount -r /dev/md4 /snapshot</strong></p><br />
<p>Для размонтирования и удаления снапшота:</p><br />
<p><strong>umount /snapshot</strong></p><br />
<p><strong>mdconfig -d -u 4</strong></p><br />
<p><strong>rm -f /dbases/.snap/mysql_snap</strong></p><br />
<p><br></p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									12/17/2018 15:36:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Восстановление Mysql из физической копии.</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p>Дано: архив созданный посредством снимков системы FreeBSD на базе UFSv2.</p><br />
<p>Файловый архив разворачиваем в свободную директорию:</p><br />
<p><strong>tar -xzvf mysql_all_01.tar.gz</strong></p><br />
<p>останавливаем сервер:</p><br />
<p><strong>/usr/local/etc/rc.d/mysql-server stop</strong></p><br />
<p>копируем на место восстанавливаемой базы, проверяем права на файлы.</p><br />
<p>запускаем сервер:</p><br />
<p><strong>/usr/local/etc/rc.d/mysql-server start</strong></p><br />
<p>проверяем все базы:</p><br />
<p>&nbsp;<strong>mysqlcheck --databases test</strong></p><br />
<p>далее находим файл:</p><br />
<p><strong>SHOW_MASTER_STATUS</strong></p><br />
<p><em>File	Position	Binlog_Do_DB	Binlog_Ignore_DB	Executed_Gtid_Set</em></p><br />
<p><em>mysql-bin.007457	373128893			</em></p><br />
<p>Используем все бинарные логи начиная с mysql-bin.007457 с позиции 373128893</p><br />
<p>(создать бат файл для удобства востановления)</p><br />
<p><strong>mysqlbinlog --start-position=373128893 -d sklad_log -t /usr/arc/mysql-bin.007457 | mysql -uroot</strong></p><br />
<p><strong>mysqlbinlog -d sklad_log /usr/arc/mysql-bin.007459 | mysql -uroot</strong></p><br />
<p><strong>mysqlbinlog -d sklad_log /usr/arc/mysql-bin.007460 | mysql -uroot</strong></p><br />
<p><strong>mysqlbinlog -d sklad_log /usr/arc/mysql-bin.007461 | mysql -uroot</strong></p><br />
<p><strong>mysqlbinlog -d sklad_log /usr/arc/mysql-bin.007462 | mysql -uroot</strong></p><br />
<p><br></p><br />
<p>Все остальные базы так же.</p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									12/24/2018 11:13:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        FreeBSD 12.0 and ZFS and RaidZ</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p>Добавить в rc.conf</p><br />
<p><em>zfs_enable="YES"</em></p><br />
<p><br></p><br />
<p><em>Если аппаратных SATA дисков 2 </em>— делаем заркало, если есть 3 диска — RAID-Z, если 4 и больше RAID-Z2.</p><br />
<p><strong>-------------------------------------------------------------------------------------------------</strong></p><br />
<p>Mirror:</p><br />
<p><strong>zpool create storage mirror ada1 ada2</strong></p><br />
<p>RAID-10:</p><br />
<p><strong>zpool create storage mirror ada1 ada2</strong></p><br />
<p><strong>zpool add storage mirror ada3 ada4</strong></p><br />
<p>RADI-Z:</p><br />
<p><strong>zpool create storage raidz ada1 ada2 ada3</strong></p><br />
<p>RAID-Z2:</p><br />
<p><strong>zpool create storage raidz2 ada1 ada2 ada3 ada4</strong></p><br />
<p><strong>-------------------------------------------------------------------------------------------------</strong></p><br />
<p><strong>zpool status storage</strong></p><br />
<p><strong>Добавляем SSD кэш (если есть)</strong></p><br />
<p><strong>zpool add -f storage cache ada4</strong></p><br />
<p>Создаём файловую систему</p><br />
<p><strong>zfs create storage/dbase</strong></p><br />
<p>Указываем количество копий для хранения информации (повышает надёжность)</p><br />
<p><strong>zfs set copies=2 storage/dbase</strong></p><br />
<p>Монтируем на путь /dbase&nbsp;</p><br />
<p><strong>zfs set mountpoint=/dbase &nbsp;storage/dbase</strong></p><br />
<p>Проверяем</p><br />
<p><strong>df -h</strong></p><br />
<p>Для загрузки при старте ничего в fstab записывать не надо</p><br />
<p>Снапшоты:</p><br />
<p>создать снапшот с именем mysql_snap</p><br />
<p><strong>zfs snapshot storage/dbase@mysql_snap</strong></p><br />
<p>Просмотр активных снапшотов</p><br />
<p><strong>ls /dbase/.zfs/snapshot</strong></p><br />
<p>Монтирование снапшота по пути /snapshot/mysql</p><br />
<p><strong>mount -t zfs storage/dbase@mysql_snap /snapshot/mysql</strong></p><br />
<p>Удаление снапшота</p><br />
<p><strong>zfs destroy storage/dbase@mysql_snap</strong></p><br />
<p><br></p><br />
<p>Если необходимо перенести рабочий рэйд на новый компьютер</p><br />
<p>переносим ada1 ada2 ada3 на те же порты в новую машину</p><br />
<p>в rc.conf поднимаем <em>zfs_enable="YES"</em></p><br />
<p><strong>zpool import</strong></p><br />
<p>Смотрим что есть</p><br />
<p><strong>zpool import -f storage</strong></p><br />
<p><strong>zpool status -v</strong></p><br />
<p><strong>df -h&nbsp;</strong></p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									12/25/2018 11:52:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Смена прав отдельно на файлы и каталоги</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p>find /dbase/111 -type d -exec chmod 770 {} \;</p><br />
<p>find /dbase/111 -type f -exec chmod 660 {} \;</p><br />
<p><br></p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									02/07/2019 11:20:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Нагрузочный тест для Mysql</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p>mysqlslap --auto-generate-sql --concurrency 100 --number-of-queries=100000</p><br />
<p><br></p><br />
<p>Benchmark</p><br />
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Average number of seconds to run all queries: 339.538 seconds</p><br />
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Minimum number of seconds to run all queries: 339.538 seconds</p><br />
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Maximum number of seconds to run all queries: 339.538 seconds</p><br />
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Number of clients running queries: 100</p><br />
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Average number of queries per client: 1000</p><br />
<p><br></p><br />
<p><br></p>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									02/07/2019 12:35:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        ZFS и ошибка "vdev state changed"</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												<p>оставлю тут, может пригодится кому (все сообщения по данному вопросу в англоязычном сегменте).</p><p>Для начала источник:</p><p><a href="https://lists.freebsd.org/pipermail/freebsd-fs/2017-April/024679.html">https://lists.freebsd.org/pipermail/freebsd-fs/2017-April/024679.html</a></p><p>Теперь вкратце:</p><p>Сообщение сваливается в message и на главный экран:</p><p></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:14:46 test ZFS[1091]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$5915737032670303033</span></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:14:46 test ZFS[1092]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$14596347961052093486</span></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:14:46 test ZFS[1093]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$2773246564615133916</span></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:14:55 test ZFS[1095]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$16896512774368472378</span></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:15:02 test ZFS[1098]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$16896512774368472378</span></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:22:28 test ZFS[1126]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$5915737032670303033</span></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:22:28 test ZFS[1127]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$14596347961052093486</span></p><p><span style="font-size:0.9em;">Feb &nbsp;7 12:22:28 test ZFS[1128]: vdev state changed, pool_guid=$10938605259487978707 vdev_guid=$2773246564615133916</span></p></lj-cut><p>Возникает при запуске очистки командой<br />
<b>zpool scrub storage</b><br />
<br />
Как пояснил компетентный чел - раньше сообщений вообще не было, а теперь вот при любых действиях - сообщает.</p><p>Тем кто не любит лишних сообщений и болезнено реагирует на незнакомые ошибки способ борьбы:<br />
в файлике /etc/devd/zfs.conf - закоментировать блок данного сообщения:</p><p># $FreeBSD: releng/12.0/sbin/devd/zfs.conf 338144 2018-08-21 16:51:45Z brd $<br />
#<br />
# Sample ZFS problem reports handling.<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.checksum&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.warn -t ZFS &#39;checksum mismatch, zpool=$pool path=$vdev_path offset=$zio_offset size=$zio_size&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.io&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.warn -t ZFS &#39;vdev I/O failure, zpool=$pool path=$vdev_path offset=$zio_offset size=$zio_size error=$zio_err&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.data&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.warn -t ZFS &#39;pool I/O failure, zpool=$pool error=$zio_err&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.zpool&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.err -t ZFS &#39;failed to load zpool $pool&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.vdev\..*&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.err -t ZFS &#39;vdev problem, zpool=$pool path=$vdev_path type=$type&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.io_failure&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.alert -t ZFS &#39;catastrophic pool I/O failure, zpool=$pool&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.probe_failure&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.err -t ZFS &#39;vdev probe failure, zpool=$pool path=$vdev_path&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.log_replay&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.err -t ZFS &#39;pool log replay failure, zpool=$pool&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;fs.zfs.config_cache_write&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.warn -t ZFS &#39;failed to write zpool.cache, zpool=$pool&#39;&quot;;<br />
};<br />
<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;resource.fs.zfs.removed&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.notice -t ZFS &#39;vdev is removed, pool_guid=$pool_guid vdev_guid=$vdev_guid&#39;&quot;;<br />
};<br />
<br />
notify 10 {<br />
&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;resource.fs.zfs.autoreplace&quot;;<br />
&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.info -t ZFS &#39;autoreplace is configured for vdev, pool_guid=$pool_guid vdev_guid=$vdev_guid&#39;&quot;;<br />
};<br />
<br />
#notify 10 {<br />
#&nbsp;&nbsp; &nbsp;match &quot;system&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;ZFS&quot;;<br />
#&nbsp;&nbsp; &nbsp;match &quot;type&quot;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&quot;resource.fs.zfs.statechange&quot;;<br />
#&nbsp;&nbsp; &nbsp;action &quot;logger -p local7.notice -t ZFS &#39;vdev state changed, pool_guid=$pool_guid vdev_guid=$vdev_guid&#39;&quot;;<br />
#};</p></lj-cut><p></p>
												<p>
												   
												   <strong>Tags:</strong> 
													#notify <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									02/28/2019 09:34:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Перезапуск сервисов </div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												имя <b>mysql-server</b> взято из <i>/usr/local/etc/rc.d/</i><br />
<br />
<b>service mysql-server restart</b>
												<p>
												   
												   
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="4"
							alt="" border="0" /></div>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><!--HERE --><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td></tr>
						<tr>
							<td class="tabBg" colspan="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><!-- HEADER CONTENT -->
								<div class="entryDate">
									03/13/2019 09:56:00
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<table cellspacing="0" cellpadding="0" border="0" width="100%">
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" class="entryHolderBg">
								<span class='ljuser' style='white-space:nowrap;'>
									<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
											style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span>
							</td>
							<td class="entryHolderBg" width="100%" valign="top">
								<table cellspacing="0" cellpadding="0" border="0" width="100%">
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div class="entryHeader">

                                                                                        Подготовка сервера DBASE</div>
											<div class="entryDash"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
													alt="" border="0" /></div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="entry">
											<div>
												Актуально для FreeBSD 12<br />
<br />
Обновляем до актуального состояния и ставим текущее дерево портов.<br />
<br />
<pre class="screen"><br />
<strong class="userinput"><code>freebsd-update fetch<br />
<strong class="userinput"><code>freebsd-update install<br />
<br />
</code></strong></code></strong><code>Перезагрузка</code></pre><br />
<br />
<br />
<pre class="screen"><br />
<strong class="userinput"><code>portsnap fetch<br />
<strong class="userinput"><code>portsnap extract</code></strong></code></strong></pre><br />
<br />
<br />
Установка mc<br />
<br />
<code><b>cd /usr/ports/misc/mc</b></code><br />
<span style="font-size:0.9em;"><b>make install BATCH=YES clean</b></span><br />
<br />
файл /root/.cshrc<br />
<br />
alias h&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;history 25<br />
alias j&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;jobs -l<br />
alias la&nbsp;&nbsp; &nbsp;ls -aF<br />
alias lf&nbsp;&nbsp; &nbsp;ls -FA<br />
alias ll&nbsp;&nbsp; &nbsp;ls -lAF<br />
<br />
# A righteous umask<br />
umask 22<br />
<br />
set path = (/sbin /bin /usr/sbin /usr/bin /usr/games /usr/local/sbin /usr/local/bin $HOME/bin)<br />
<br />
setenv&nbsp;&nbsp; &nbsp;EDITOR&nbsp;&nbsp; &nbsp;ee<br />
setenv&nbsp;&nbsp; &nbsp;PAGER&nbsp;&nbsp; &nbsp;more<br />
setenv&nbsp;&nbsp; &nbsp;BLOCKSIZE&nbsp;&nbsp; &nbsp;K<br />
setenv&nbsp;&nbsp; &nbsp;LANG ru_RU.UTF-8<br />
setenv&nbsp;&nbsp; &nbsp;LC_ALL ru_RU.UTF-8<br />
setenv&nbsp;&nbsp; &nbsp;TOP -CHP<br />
<br />
if ($?prompt) then<br />
&nbsp;&nbsp; &nbsp;# An interactive shell -- set some stuff up<br />
&nbsp;&nbsp; &nbsp;set prompt = &quot;%N@%m:%~ %# &quot;<br />
&nbsp;&nbsp; &nbsp;set promptchars = &quot;%#&quot;<br />
<br />
&nbsp;&nbsp; &nbsp;set filec<br />
&nbsp;&nbsp; &nbsp;set history = 1000<br />
&nbsp;&nbsp; &nbsp;set savehist = (1000 merge)<br />
&nbsp;&nbsp; &nbsp;set autolist = ambiguous<br />
&nbsp;&nbsp; &nbsp;# Use history to aid expansion<br />
&nbsp;&nbsp; &nbsp;set autoexpand<br />
&nbsp;&nbsp; &nbsp;set autorehash<br />
&nbsp;&nbsp; &nbsp;set mail = (/var/mail/$USER)<br />
&nbsp;&nbsp; &nbsp;if ( $?tcsh ) then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;bindkey &quot;^W&quot; backward-delete-word<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;bindkey -k up history-search-backward<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;bindkey -k down history-search-forward<br />
&nbsp;&nbsp; &nbsp;endif<br />
<br />
endif<br />
</lj-spoiler><br />
<br />
<b>cd /usr/ports/net/samba48<br />
make install BATCH=YES clean<br />
<br />
echo &#39;samba_server_enable=&quot;YES&quot;&#39; &gt;&gt; /etc/rc.conf</b><br />
<b>service samba_server start</b><br />
<i><b>cd /usr/ports/databases/mysql56-server</b></i><br />
<b>make install BATCH=YES clean</b><br />
<br />
в rc.conf<br />
mysql_enable=&quot;YES&quot;<br />
mysql_args=&quot;--skip-name-resolve --key_buffer_size=1G&quot;<br />
mysql_dbdir=&quot;/dbase/mysql&quot;<br />
<br />
<b>service mysql-server start</b><br />
<br />
[mysqld]<br />
default-storage-engine = MYISAM<br />
character_set_server = utf8<br />
collation-server = utf8_unicode_ci<br />
key_buffer_size=1G<br />
sql-mode=&quot;&quot;<br />
<br />
server_id = 29<br />
#log_bin = /dbase/mysql_log/mysql-bin<br />
#binlog-format = MIXED<br />
#expire_logs_days = 5<br />
</lj-spoiler>
												<p>
												   
												   <strong>Tags:</strong> 
													#binlog, #log_bin, #expire_logs_days <br />
												</p>
											</div>
										</td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
									<tr>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
										<td width="1" class="medLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
												alt="" border="0" /></td>
									</tr>
								</table>
								<div class="entryComments">&nbsp;
								</div>
							</td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td colspan="5" class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
					</table>
					<div><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
							alt="" border="0" /></div>

				</td>
				<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="3" height="1"
						alt="" border="0" /></td>
				<td valign="top" width="184">
					<table cellspacing="0" cellpadding="0" border="0" width="184">
						<tr>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-left.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
							<td class="dkLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td valign="top" rowspan="3" colspan="3" width="5"><img src="http://www.livejournal.com/palimg/component/curve-top-right.gif/p0bbbbbb1666666200545c"
									width="5" height="5" alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="ltLine"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="tabBg"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="tabBg" width="100%"><div class="sideHeader">
									profile
								</div>
							</td>
							<td class="tabBg" width="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="ltLine" width="1" rowspan="2"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="dkLine" width="1" rowspan="3"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="medLine" colspan="4"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="5"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
							<td class="compBg" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="compBg" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="compBg"><div class="compFont">
									<table cellspacing="0" cellpadding="0" border="0">

										<tr>
											<td colspan="3" class="compContent">


												<div><b>User:</b>
													<span class='ljuser' style='white-space:nowrap;'>
														<a href='http://www.livejournal.com/userinfo.bml?user=kmamail'><img src='http://www.livejournal.com/img/userinfo.gif' alt='[info]' width='17' height='17'
																style='vertical-align:bottom;border:0;' /></a><a href='http://www.livejournal.com/users/kmamail/'><b>kmamail</b></a></span></div>
												<div><b>Name:</b> kmamail</div>
<% /!!UseJournal %>
											</td>
										</tr>
									</table>
								</div>
							</td>
							<td class="compBg" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="compBg" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
							<td class="dkLine" width="1"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td class="dkLine" colspan="8"><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="1"
									alt="" border="0" /></td>
						</tr>
						<tr>
							<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="1" height="3"
									alt="" border="0" /></td>
						</tr>
					</table>
				</td>
				<td><img src="http://www.livejournal.com/palimg/component/clear.gif" width="3" height="1"
						alt="" border="0" /></td>
			</tr>
		</table>
	</body>
</html>
